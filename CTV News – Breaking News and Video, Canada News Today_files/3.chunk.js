(this.webpackJsonp=this.webpackJsonp||[]).push([[3],{347:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={Denied:"denied",Granted:"granted"},r=["ad_storage","ad_user_data","ad_personalization","analytics_storage"];function i(e){this.common=e||{}}i.prototype.getUserConsentState=function(){var e={};if(mParticle.Identity&&mParticle.Identity.getCurrentUser){if(!mParticle.Identity.getCurrentUser())return{};var t=mParticle.Identity.getCurrentUser().getConsentState();t&&t.getGDPRConsentState&&(e=t.getGDPRConsentState())}return e},i.prototype.getConsentSettings=function(){var e={},t={ad_user_data:"defaultAdUserDataConsentWeb",ad_personalization:"defaultAdPersonalizationConsentWeb",ad_storage:"defaultAdStorageConsentWeb",analytics_storage:"defaultAnalyticsStorageConsentWeb"},n=this.common.settings;return Object.keys(t).forEach((function(r){var i=t[r],a=n[i];a&&i&&(e[r]=o[a])})),e},i.prototype.generateConsentStatePayloadFromMappings=function(e,t){if(!t)return{};for(var n=this.common.cloneObject(this.common.consentPayloadDefaults),i=0;i<=t.length-1;i++){var a=t[i],s=a.map.toLowerCase(),c=a.value;e[s]&&-1!==r.indexOf(c)&&(n[c]=e[s].Consented?o.Granted:o.Denied)}return n};var a=i;function s(){this.customDataLayerName=null,this.consentMappings=[],this.consentPayloadDefaults={},this.consentPayloadAsString="",this.consentHandler=new a(this)}s.prototype.buildMPID=function(e,t){var n="";return e&&e.hasOwnProperty("MPID")?n=e.MPID:t&&t.hasOwnProperty("getMPID")&&(n=t.getMPID()),n},s.prototype.buildUserAttributes=function(e,t){var n={};return e&&e.hasOwnProperty("UserAttributes")?n=e.UserAttributes:t&&t.hasOwnProperty("getAllUserAttributes")&&(n=t.getAllUserAttributes()),n},s.prototype.buildUserIdentities=function(e,t){var n={};return e.hasOwnProperty("UserIdentities")?e.UserIdentities.forEach((function(e){var t=mParticle.IdentityType.getIdentityName(e.Type);n[t]=e.Identity})):t.hasOwnProperty("getUserIdentities")&&t.getUserIdentities().userIdentities&&(n=t.getUserIdentities().userIdentities),n},s.prototype.buildConsentObject=function(e){var t={},n=e.ConsentState||mParticle.Identity.getCurrentUser().getConsentState();return n&&n.getGDPRConsentState&&n.getGDPRConsentState()&&(t=n.getGDPRConsentState()),{gdpr:t}},s.prototype.send=function(e){var t,n={},o=e||{},r=o.event||{},i=o.user||{},a=r.EventName||"Custom Event",s={mpid:this.buildMPID(r,i),consent_state:this.buildConsentObject(r),attributes:this.buildUserAttributes(r,i),identities:this.buildUserIdentities(r,i)},c={name:a,type:o.eventType||"custom_event",attributes:r.EventAttributes||{}};if(n.event=a,t={device_application_stamp:r.DeviceId||mParticle.getDeviceId()||"",user:s,event:c},n.mp_data=t,o.eventPayload)for(var u in o.eventPayload)o.eventPayload.hasOwnProperty(u)&&(n[u]=o.eventPayload[u]);window[this.customDataLayerName].push(n)},s.prototype.sendConsent=function(e,t){var n=this.customDataLayerName;!function(){window[n].push(arguments)}("consent",e,t)},s.prototype.getEventConsentState=function(e){return e&&e.getGDPRConsentState?e.getGDPRConsentState():{}},s.prototype.maybeSendConsentUpdateToGoogle=function(e){if(this.consentPayloadAsString&&this.consentMappings&&!this.isEmpty(e)){var t=this.consentHandler.generateConsentStatePayloadFromMappings(e,this.consentMappings),n=JSON.stringify(t);n!==this.consentPayloadAsString&&(this.sendConsent("update",t),this.consentPayloadAsString=n)}},s.prototype.sendDefaultConsentPayloadToGoogle=function(e){this.consentPayloadAsString=JSON.stringify(e),this.sendConsent("default",e)},s.prototype.cloneObject=function(e){return JSON.parse(JSON.stringify(e))},s.prototype.isEmpty=function(e){return null==e||!(Object.keys(e)||e).length};var c=s,u=10,d=14,l=12,m=13,p=22,f=16,y=17,v=11,g=15,h=19,C=18;function P(e){this.common=e||{}}function w(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()}function b(e){var t=[];return e.forEach((function(e){t.push(function(e){var t={};for(var n in e)"Sku"===n?t.id=e.Sku:t[w(n)]=e[n];return t}(e))})),t}function S(e){var t=[];return e.forEach((function(e){t.push(function(e){var t={};for(var n in e)t[w(n)]=e[n];return t}(e))})),t}P.prototype.buildAddToCart=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{currencyCode:e.CurrencyCode||"USD",add:{products:b(e.ProductAction.ProductList)}}}}},P.prototype.buildCheckout=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{checkout:{actionField:{step:e.ProductAction.CheckoutStep,option:e.ProductAction.CheckoutOptions},products:b(e.ProductAction.ProductList)}}}}},P.prototype.buildCheckoutOption=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{checkout_option:{actionField:{step:e.ProductAction.CheckoutStep,option:e.ProductAction.CheckoutOptions},products:b(e.ProductAction.ProductList)}}}}},P.prototype.buildRemoveFromCart=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{currencyCode:e.CurrencyCode||"USD",remove:{products:b(e.ProductAction.ProductList)}}}}},P.prototype.buildImpression=function(e,t){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{currencyCode:e.CurrencyCode||"USD",impressions:b(t.ProductList)}}}},P.prototype.buildProductClick=function(e){var t={};return e.EventAttributes&&e.EventAttributes.hasOwnProperty("list")&&(t.list=e.EventAttributes.list),{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{click:{actionField:t,products:b(e.ProductAction.ProductList)}}}}},P.prototype.buildProductViewDetail=function(e){var t={};return e.EventAttributes&&e.EventAttributes.hasOwnProperty("list")&&(t.list=e.EventAttributes.list),{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{detail:{actionField:t,products:b(e.ProductAction.ProductList)}}}}},P.prototype.buildPromoClick=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{promoClick:{promotions:S(e.PromotionAction.PromotionList)}}}}},P.prototype.buildPromoView=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{promoView:{promotions:S(e.PromotionAction.PromotionList)}}}}},P.prototype.buildPurchase=function(e){var t=e.ProductAction;return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{purchase:{actionField:{id:t.TransactionId||"",affiliation:t.Affiliation||"",revenue:t.TotalAmount||"",tax:t.TaxAmount||"",shipping:t.ShippingAmount||"",coupon:t.CouponCode||""},products:b(t.ProductList)}}}}},P.prototype.buildRefund=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{refund:{actionField:{id:e.ProductAction.TransactionId||""},products:b(e.ProductAction.ProductList)}}}}},P.prototype.logCommerceEvent=function(e){var t=this;switch(e.EventCategory){case u:e=t.buildAddToCart(e);break;case l:e=t.buildCheckout(e);break;case m:e=t.buildCheckoutOption(e);break;case d:e=t.buildProductClick(e);break;case p:try{e.ProductImpressions.forEach((function(n){var o=t.buildImpression(e,n);t.common.send(o)}))}catch(e){return console.log("error logging impressions",e),!1}return!0;case f:e=t.buildPurchase(e);break;case y:e=t.buildRefund(e);break;case v:e=t.buildRemoveFromCart(e);break;case g:e=t.buildProductViewDetail(e);break;case h:e=t.buildPromoClick(e);break;case C:e=t.buildPromoView(e);break;default:return console.error("Unknown Commerce Type",e),!1}return t.common.send(e),!0};var E=P;function A(e){this.common=e||{}}A.prototype.logEvent=function(e){var t=this.common.getEventConsentState(e.ConsentState);return this.common.maybeSendConsentUpdateToGoogle(t),this.common.send({event:e}),!0},A.prototype.logError=function(){},A.prototype.logPageView=function(e){var t=this.common.getEventConsentState(e.ConsentState);return this.common.maybeSendConsentUpdateToGoogle(t),this.common.send({event:e,eventType:"screen_view"}),!0};var I=A;function U(e){this.common=e||{}}U.prototype.onUserIdentified=function(e){this.common.send({event:{EventName:"User Identified"},user:e})},U.prototype.onIdentifyComplete=function(e,t){this.common.send({event:{EventName:"Identify Complete"},user:e})},U.prototype.onLoginComplete=function(e,t){this.common.send({event:{EventName:"Login Complete"},user:e})},U.prototype.onLogoutComplete=function(e,t){this.common.send({event:{EventName:"Logout Complete"},user:e})},U.prototype.onModifyComplete=function(e,t){this.common.send({event:{EventName:"Modify Complete"},user:e})},U.prototype.onSetUserIdentity=function(e,t,n){};var D=U,T={name:"GoogleTagManager",moduleId:140,initForwarder:function(e,t,n,o,r,i,a,s){var c;s.settings=e,s.settings.consentMappingWeb?s.consentMappings=(c=s.settings.consentMappingWeb,JSON.parse(c.replace(/&quot;/g,'"'))):(s.consentMappings=[],s.consentPayloadDefaults={},s.consentPayloadAsString="");var u=function(e){var t=e||"";return t.trim().match(/^[a-zA-Z0-9-_]+$/)?t.trim():""}(e.containerId);if(!u)return console.error("Container ID is not valid and is required for Google Tag Manager Integration"),!1,!1;var d="True"===e.includeContainer,l=function(e){var t=e||"";return t.trim().match(/^[a-zA-Z0-9-_]+$/)?t.trim():""}(e.dataLayerName);if(!l)return console.error("DataLayer Name is not valid. Please check that you have entered it correctly."),!1,!1;var m=function(e){var t=e||"",n=/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/gm;return t.trim().match(n)?t.trim():""}(e.previewUrl);!m&&e.previewUrl&&console.warn("Invalid previewUrl detected. Please check that you have entered it correctly."),s.customDataLayerName=l,window[s.customDataLayerName]=window[s.customDataLayerName]||[],!(!t&&d)||function(e,t,n,o){var r="https://www.googletagmanager.com/gtm.js",i=function(e){var t=e||"",n={},o=t.split("?");if(!o[1]||o.length>2)return{};return o[1].split("&").forEach((function(e){var t=e.split("=");n[t[0]]=t[1]})),n}(n);n&&i.id===e?r+="?"+function(e){var t=e||"";return t.split("?")[1]}(n)+"&l="+t:r+="?id="+e;r+="&l="+t,function(e,t,n){window[t].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=e,"True"===n&&o.setAttributeNode(window.document.createAttribute("data-ot-ignore"));(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(o)}(r,t,o)}(u,s.customDataLayerName,m,s.settings.preventAutoBlock),s.consentPayloadDefaults=s.consentHandler.getConsentSettings();var p=s.cloneObject(s.consentPayloadDefaults),f=s.consentHandler.getUserConsentState(),y=s.consentHandler.generateConsentStatePayloadFromMappings(f,s.consentMappings);s.isEmpty(p)?s.isEmpty(y)||s.sendDefaultConsentPayloadToGoogle(y):s.sendDefaultConsentPayloadToGoogle(p),s.maybeSendConsentUpdateToGoogle(f)}};var k=T,O={onSessionStart:function(e){},onSessionEnd:function(e){}};function L(e){this.common={}}L.prototype.onRemoveUserAttribute=function(e,t){this.common.send({event:{EventName:"Remove User Attribute"},options:{key:e}})},L.prototype.onSetUserAttribute=function(e,t,n){this.common.send({event:{EventName:"Set User Attribute"},options:{key:e,value:t}})},L.prototype.onConsentStateUpdated=function(e,t,n){this.common.send({event:{EventName:"Consent State Update"},options:{old_state:e,new_state:t}})};var _=L,M=k.name,N=k.moduleId,H=1,G=2,z=3,F=4,j=5,R=16,J=20,V=function(){var e,t,n=this,o=!1,r=[];function i(e){var i=!1;if(!o)return r.push(e),"Can't send to forwarder "+M+", not initialized. Event added to queue.";try{return e.EventDataType===H?i=function(e){try{return O.onSessionStart(e)}catch(e){return{error:"Error starting session on forwarder "+M+"; "+e}}}(e):e.EventDataType===G?i=function(e){try{return O.onSessionEnd(e)}catch(e){return{error:"Error ending session on forwarder "+M+"; "+e}}}(e):e.EventDataType===j?i=function(e){try{return n.eventHandler.logError(e)}catch(e){return{error:"Error logging error on forwarder "+M+"; "+e}}}(e):e.EventDataType===z?i=function(e){try{return n.eventHandler.logPageView(e)}catch(e){return{error:"Error logging page view on forwarder "+M+"; "+e}}}(e):e.EventDataType===R?i=function(e){try{return n.commerceHandler.logCommerceEvent(e)}catch(e){return{error:"Error logging purchase event on forwarder "+M+"; "+e}}}(e):(e.EventDataType===F||e.EventDataType===J)&&(i=a(e)),!0===i&&t?(t(n,e),"Successfully sent to "+M):"Error logging event or event type not supported on forwarder "+M}catch(e){return"Failed to send to "+M+" "+e}}function a(e){try{return n.eventHandler.logEvent(e)}catch(e){return{error:"Error logging event on forwarder "+M+"; "+e}}}n.name=k.name,n.moduleId=k.moduleId,n.common=new c,this.init=function(a,s,c,u,d,l,m,p,f,y){e=a,t="undefined"!=typeof window&&window.mParticle.isTestEnvironment?function(){}:s;try{k.initForwarder(a,c,d,l,i,r,o,n.common,m,p,f,y),n.eventHandler=new I(n.common),n.identityHandler=new D(n.common),n.userAttributeHandler=new _(n.common),n.commerceHandler=new E(n.common),o=!0}catch(e){console.log("Failed to initialize "+M+" - "+e)}},this.process=i,this.setUserAttribute=function(t,r){if(!o)return"Can't set user attribute on forwarder "+M+", not initialized";try{return n.userAttributeHandler.onSetUserAttribute(t,r,e),"Successfully set user attribute on forwarder "+M}catch(e){return"Error setting user attribute on forwarder "+M+"; "+e}},this.removeUserAttribute=function(t){if(!o)return"Can't remove user attribute on forwarder "+M+", not initialized";try{return n.userAttributeHandler.onRemoveUserAttribute(t,e),"Successfully removed user attribute on forwarder "+M}catch(e){return"Error removing user attribute on forwarder "+M+"; "+e}},this.onUserIdentified=function(e){if(!o)return"Can't set new user identities on forwader  "+M+", not initialized";try{return n.identityHandler.onUserIdentified(e),"Successfully called onUserIdentified on forwarder "+M}catch(e){return{error:"Error calling onUserIdentified on forwarder "+M+"; "+e}}},this.setUserIdentity=function(t,r){if(!o)return"Can't call setUserIdentity on forwarder "+M+", not initialized";try{return n.identityHandler.onSetUserIdentity(e,t,r),"Successfully set user Identity on forwarder "+M}catch(e){return"Error removing user attribute on forwarder "+M+"; "+e}},this.onIdentifyComplete=function(e,t){if(!o)return"Can't call onIdentifyCompleted on forwader  "+M+", not initialized";try{return n.identityHandler.onIdentifyComplete(e,t),"Successfully called onIdentifyComplete on forwarder "+M}catch(e){return{error:"Error calling onIdentifyComplete on forwarder "+M+"; "+e}}},this.onLoginComplete=function(e,t){if(!o)return"Can't call onLoginComplete on forwader  "+M+", not initialized";try{return n.identityHandler.onLoginComplete(e,t),"Successfully called onLoginComplete on forwarder "+M}catch(e){return{error:"Error calling onLoginComplete on forwarder "+M+"; "+e}}},this.onLogoutComplete=function(e,t){if(!o)return"Can't call onLogoutComplete on forwader  "+M+", not initialized";try{return n.identityHandler.onLogoutComplete(e,t),"Successfully called onLogoutComplete on forwarder "+M}catch(e){return{error:"Error calling onLogoutComplete on forwarder "+M+"; "+e}}},this.onModifyComplete=function(e,t){if(!o)return"Can't call onModifyComplete on forwader  "+M+", not initialized";try{return n.identityHandler.onModifyComplete(e,t),"Successfully called onModifyComplete on forwarder "+M}catch(e){return{error:"Error calling onModifyComplete on forwarder "+M+"; "+e}}},this.setOptOut=function(e){if(!o)return"Can't call setOptOut on forwader  "+M+", not initialized";try{return n.initialization.setOptOut(e),"Successfully called setOptOut on forwarder "+M}catch(e){return{error:"Error calling setOptOut on forwarder "+M+"; "+e}}}};function W(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}"undefined"!=typeof window&&window&&window.mParticle&&window.mParticle.addForwarder&&window.mParticle.addForwarder({name:M,constructor:V,getId:function(){return N}});var x={register:function(e){e?W(e)?(W(e.kits)||(e.kits={}),e.kits[M]={constructor:V},console.log("Successfully registered "+M+" to your mParticle configuration")):console.log("'config' must be an object. You passed in a "+typeof e):console.log("You must pass a config object to register the kit "+M)}},$=x.register;t.default=x,t.register=$}}]);