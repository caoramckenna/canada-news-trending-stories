(this.webpackJsonp=this.webpackJsonp||[]).push([[4],{346:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return Xr})),"undefined"!=typeof globalThis&&(globalThis.regeneratorRuntime=void 0);var n,o,i,s,a={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){try{if(window.btoa&&window.atob)return window.btoa(unescape(encodeURIComponent(e)))}catch(e){console.error("Error encoding cookie values into Base64:"+e)}return this._encode(e)},_encode:function(e){var t,r,n,o,i,s,u,d="",l=0;for(e=c.encode(e);l<e.length;)o=(t=e.charCodeAt(l++))>>2,i=(3&t)<<4|(r=e.charCodeAt(l++))>>4,s=(15&r)<<2|(n=e.charCodeAt(l++))>>6,u=63&n,isNaN(r)?s=u=64:isNaN(n)&&(u=64),d=d+a._keyStr.charAt(o)+a._keyStr.charAt(i)+a._keyStr.charAt(s)+a._keyStr.charAt(u);return d},decode:function(e){try{if(window.btoa&&window.atob)return decodeURIComponent(escape(window.atob(e)))}catch(e){}return a._decode(e)},_decode:function(e){var t,r,n,o,i,s,u="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)t=a._keyStr.indexOf(e.charAt(d++))<<2|(o=a._keyStr.indexOf(e.charAt(d++)))>>4,r=(15&o)<<4|(i=a._keyStr.indexOf(e.charAt(d++)))>>2,n=(3&i)<<6|(s=a._keyStr.indexOf(e.charAt(d++))),u+=String.fromCharCode(t),64!==i&&(u+=String.fromCharCode(r)),64!==s&&(u+=String.fromCharCode(n));return u=c.decode(u)}},c={encode:function(e){for(var t,r="",n=0;n<e.length;n++)128>(t=e.charCodeAt(n))?r+=String.fromCharCode(t):127<t&&2048>t?(r+=String.fromCharCode(192|t>>6),r+=String.fromCharCode(128|63&t)):(r+=String.fromCharCode(224|t>>12),r+=String.fromCharCode(128|63&t>>6),r+=String.fromCharCode(128|63&t));return r},decode:function(e){for(var t="",r=0,n=0,o=0,i=0;r<e.length;)128>(n=e.charCodeAt(r))?(t+=String.fromCharCode(n),r++):191<n&&224>n?(o=e.charCodeAt(r+1),t+=String.fromCharCode((31&n)<<6|63&o),r+=2):(o=e.charCodeAt(r+1),i=e.charCodeAt(r+2),t+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&i),r+=3);return t}},u={forEach:function(e,t){var r,n;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(r=t),n=0;n<i;){var s;n in o&&(s=o[n],e.call(r,s,n,o)),n++}},map:function(e,t){var r,n,o;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(r=t),n=Array(s),o=0;o<s;){var a,c;o in i&&(a=i[o],c=e.call(r,a,o,i),n[o]=c),o++}return n},filter:function(e){if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],o=2<=arguments.length?arguments[1]:void 0,i=0;i<r;i++)if(i in t){var s=t[i];e.call(o,s,i,t)&&n.push(s)}return n},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},Base64:a};function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function l(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===d(t)?t:String(t)}function g(e,t,r){return(t=l(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(o=n||(n={}))[o.Unknown=0]="Unknown",o[o.Navigation=1]="Navigation",o[o.Location=2]="Location",o[o.Search=3]="Search",o[o.Transaction=4]="Transaction",o[o.UserContent=5]="UserContent",o[o.UserPreference=6]="UserPreference",o[o.Social=7]="Social",o[o.Other=8]="Other",o[o.Media=9]="Media",function(e){e[e.SessionStart=1]="SessionStart",e[e.SessionEnd=2]="SessionEnd",e[e.PageView=3]="PageView",e[e.PageEvent=4]="PageEvent",e[e.CrashReport=5]="CrashReport",e[e.OptOut=6]="OptOut",e[e.AppStateTransition=10]="AppStateTransition",e[e.Profile=14]="Profile",e[e.Commerce=16]="Commerce",e[e.UserAttributeChange=17]="UserAttributeChange",e[e.UserIdentityChange=18]="UserIdentityChange",e[e.Media=20]="Media"}(i||(i={})),function(e){e[e.Other=0]="Other",e[e.CustomerId=1]="CustomerId",e[e.Facebook=2]="Facebook",e[e.Twitter=3]="Twitter",e[e.Google=4]="Google",e[e.Microsoft=5]="Microsoft",e[e.Yahoo=6]="Yahoo",e[e.Email=7]="Email",e[e.FacebookCustomAudienceId=9]="FacebookCustomAudienceId",e[e.Other2=10]="Other2",e[e.Other3=11]="Other3",e[e.Other4=12]="Other4",e[e.Other5=13]="Other5",e[e.Other6=14]="Other6",e[e.Other7=15]="Other7",e[e.Other8=16]="Other8",e[e.Other9=17]="Other9",e[e.Other10=18]="Other10",e[e.MobileNumber=19]="MobileNumber",e[e.PhoneNumber2=20]="PhoneNumber2",e[e.PhoneNumber3=21]="PhoneNumber3"}(s||(s={}));var p=function(e,t){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},p(e,t)};function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var f=function(){return f=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},f.apply(this,arguments)};function m(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function h(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function y(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var S={sdkVersion:"2.32.0",sdkVendor:"mparticle",platform:"web",Messages:{DeprecationMessages:{MethodIsDeprecatedPostfix:"is a deprecated method and will be removed in future releases",AlternativeMethodPrefix:"Please use the alternate method:"},ErrorMessages:{NoToken:"A token must be specified.",EventNameInvalidType:"Event name must be a valid string value.",EventDataInvalidType:"Event data must be a valid object hash.",LoggingDisabled:"Event logging is currently disabled.",CookieParseError:"Could not parse cookie",EventEmpty:"Event object is null or undefined, cancelling send",APIRequestEmpty:"APIRequest is null or undefined, cancelling send",NoEventType:"Event type must be specified.",TransactionIdRequired:"Transaction ID is required",TransactionRequired:"A transaction attributes object is required",PromotionIdRequired:"Promotion ID is required",BadAttribute:"Attribute value cannot be object or array",BadKey:"Key value cannot be object or array",BadLogPurchase:"Transaction attributes and a product are both required to log a purchase, https://docs.mparticle.com/?javascript#measuring-transactions",AudienceAPINotEnabled:"Your workspace is not enabled to retrieve user audiences."},InformationMessages:{CookieSearch:"Searching for cookie",CookieFound:"Cookie found, parsing values",CookieNotFound:"Cookies not found",CookieSet:"Setting cookie",CookieSync:"Performing cookie sync",SendBegin:"Starting to send event",SendIdentityBegin:"Starting to send event to identity server",SendWindowsPhone:"Sending event to Windows Phone container",SendIOS:"Calling iOS path: ",SendAndroid:"Calling Android JS interface method: ",SendHttp:"Sending event to mParticle HTTP service",SendAliasHttp:"Sending alias request to mParticle HTTP service",SendIdentityHttp:"Sending event to mParticle HTTP service",StartingNewSession:"Starting new Session",StartingLogEvent:"Starting to log event",StartingLogOptOut:"Starting to log user opt in/out",StartingEndSession:"Starting to end session",StartingInitialization:"Starting to initialize",StartingLogCommerceEvent:"Starting to log commerce event",StartingAliasRequest:"Starting to Alias MPIDs",LoadingConfig:"Loading configuration options",AbandonLogEvent:"Cannot log event, logging disabled or developer token not set",AbandonAliasUsers:"Cannot Alias Users, logging disabled or developer token not set",AbandonStartSession:"Cannot start session, logging disabled or developer token not set",AbandonEndSession:"Cannot end session, logging disabled or developer token not set",NoSessionToEnd:"Cannot end session, no active session found"},ValidationMessages:{ModifyIdentityRequestUserIdentitiesPresent:"identityRequests to modify require userIdentities to be present. Request not sent to server. Please fix and try again",IdentityRequesetInvalidKey:"There is an invalid key on your identityRequest object. It can only contain a `userIdentities` object and a `onUserAlias` function. Request not sent to server. Please fix and try again.",OnUserAliasType:"The onUserAlias value must be a function.",UserIdentities:"The userIdentities key must be an object with keys of identityTypes and values of strings. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidKey:"There is an invalid identity key on your `userIdentities` object within the identityRequest. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidValues:"All user identity values must be strings or null. Request not sent to server. Please fix and try again.",AliasMissingMpid:"Alias Request must contain both a destinationMpid and a sourceMpid",AliasNonUniqueMpid:"Alias Request's destinationMpid and sourceMpid must be unique",AliasMissingTime:"Alias Request must have both a startTime and an endTime",AliasStartBeforeEndTime:"Alias Request's endTime must be later than its startTime"}},NativeSdkPaths:{LogEvent:"logEvent",SetUserTag:"setUserTag",RemoveUserTag:"removeUserTag",SetUserAttribute:"setUserAttribute",RemoveUserAttribute:"removeUserAttribute",SetSessionAttribute:"setSessionAttribute",AddToCart:"addToCart",RemoveFromCart:"removeFromCart",ClearCart:"clearCart",LogOut:"logOut",SetUserAttributeList:"setUserAttributeList",RemoveAllUserAttributes:"removeAllUserAttributes",GetUserAttributesLists:"getUserAttributesLists",GetAllUserAttributes:"getAllUserAttributes",Identify:"identify",Logout:"logout",Login:"login",Modify:"modify",Alias:"aliasUsers",Upload:"upload"},StorageNames:{localStorageName:"mprtcl-api",localStorageNameV3:"mprtcl-v3",cookieName:"mprtcl-api",cookieNameV2:"mprtcl-v2",cookieNameV3:"mprtcl-v3",localStorageNameV4:"mprtcl-v4",localStorageProductsV4:"mprtcl-prodv4",cookieNameV4:"mprtcl-v4",currentStorageName:"mprtcl-v4",currentStorageProductsName:"mprtcl-prodv4"},DefaultConfig:{cookieDomain:null,cookieExpiration:365,logLevel:null,timeout:300,sessionTimeout:30,maxProducts:20,forwarderStatsTimeout:5e3,integrationDelayTimeout:5e3,maxCookieSize:3e3,aliasMaxWindow:90,uploadInterval:0},DefaultBaseUrls:{v1SecureServiceUrl:"jssdks.mparticle.com/v1/JS/",v2SecureServiceUrl:"jssdks.mparticle.com/v2/JS/",v3SecureServiceUrl:"jssdks.mparticle.com/v3/JS/",configUrl:"jssdkcdns.mparticle.com/JS/v2/",identityUrl:"identity.mparticle.com/v1/",aliasUrl:"jssdks.mparticle.com/v1/identity/",userAudienceUrl:"nativesdks.mparticle.com/v1/"},Base64CookieKeys:{csm:1,sa:1,ss:1,ua:1,ui:1,csd:1,ia:1,con:1},SDKv2NonMPIDCookieKeys:{gs:1,cu:1,l:1,globalSettings:1,currentUserMPID:1},HTTPCodes:{noHttpCoverage:-1,activeIdentityRequest:-2,activeSession:-3,validationIssue:-4,nativeIdentityRequest:-5,loggingDisabledOrMissingAPIKey:-6,tooManyRequests:429},FeatureFlags:{ReportBatching:"reportBatching",EventBatchingIntervalMillis:"eventBatchingIntervalMillis",OfflineStorage:"offlineStorage",DirectUrlRouting:"directURLRouting",CacheIdentity:"cacheIdentity",AudienceAPI:"audienceAPI",CaptureIntegrationSpecificIds:"captureIntegrationSpecificIds"},DefaultInstance:"default_instance",CCPAPurpose:"data_sale_opt_out",IdentityMethods:{Modify:"modify",Logout:"logout",Login:"login",Identify:"identify"}},b=200,_=202,I=S.Messages,P=function(e){return M(R(e))},C=function(e){return F(N(e))},w=function(e,t){var r=0;if(Array.prototype.indexOf)return 0<=e.indexOf(t,0);for(var n=e.length;r<n;r++)if(r in e&&e[r]===t)return!0;return!1},A=function(e,t){if(t&&e)for(var r in e)if(e.hasOwnProperty(r)&&r.toLowerCase()===t.toLowerCase())return r;return null},E=function(e,t){var r=[e,I.DeprecationMessages.MethodIsDeprecatedPostfix];return t&&(r.push(t),r.push(I.DeprecationMessages.MethodIsDeprecatedPostfix)),r.join(" ")};function T(e){var t=0;if(null==e)return 0;if(e=e.toString().toLowerCase(),Array.prototype.reduce)return e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0);if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t}var k,D=function(e){return void 0===e&&(e=""),e?function(){var e,t;return window.crypto&&window.crypto.getRandomValues&&(e=window.crypto.getRandomValues(new Uint8Array(1))),e?(t^e[0]%16>>NaN).toString(16):(t^16*Math.random()>>NaN).toString(16)}():"".concat(1e7,"-").concat(1e3,"-").concat(4e3,"-").concat(8e3,"-").concat(1e11).replace(/[018]/g,D)},O=function(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t||"[object Error]"===t},U=function(e){if(isNaN(e)||!isFinite(e))return 0;var t=parseFloat(e);return isNaN(t)?0:t},L=function(e){return z(e)?e:null},M=function(e){return e.replace(/,/g,"|")},F=function(e){return e.replace(/\|/g,",")},N=function(e){return e.replace(/\'/g,'"')},R=function(e){return e.replace(/\"/g,"'")},x=function(e){return"false"!==e&&"0"!==e&&!!e},V=function(e){return decodeURIComponent(e.replace(/\+/g," "))},H=function(e){return 0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),e},K=function(e){return"string"==typeof e},j=function(e){return"number"==typeof e},q=function(e){return"function"==typeof e},B=function(e){return j(e)||K(e)||function(e){return"boolean"==typeof e}(e)},W=function(e){return e===function(e){return z(e)?e.toString().toLowerCase().replace(/[^0-9a-zA-Z]+/g,"_"):""}(e)},z=function(e){return K(e)||j(e)},J=function(e){return null==e||!(Object.keys(e)||e).length},Q=function(e,t){return e.slice(0,t).concat(e.slice(t+1),e[t])},G=function(e){var t={};return(e.split("?")[1]||"").split("&").forEach((function(e){var r=e.split("="),n=r[0],o=r[1];n&&o&&(t[n]=decodeURIComponent(o||""))})),{get:function(e){return t[e]},forEach:function(e){for(var r in t)t.hasOwnProperty(r)&&e(t[r],r)}}},Y=function(){return"undefined"!=typeof window&&window.location?window.location.href:""};function X(e){return e===s.Other?"other":e===s.CustomerId?"customerid":e===s.Facebook?"facebook":e===s.Twitter?"twitter":e===s.Google?"google":e===s.Microsoft?"microsoft":e===s.Yahoo?"yahoo":e===s.Email?"email":e===s.FacebookCustomAudienceId?"facebookcustomaudienceid":e===s.Other2?"other2":e===s.Other3?"other3":e===s.Other4?"other4":e===s.Other5?"other5":e===s.Other6?"other6":e===s.Other7?"other7":e===s.Other8?"other8":e===s.Other9?"other9":e===s.Other10?"other10":e===s.MobileNumber?"mobile_number":e===s.PhoneNumber2?"phone_number_2":e===s.PhoneNumber3?"phone_number_3":null}var $,Z={SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,AppStateTransition:10,Profile:14,Commerce:16,Media:20,UserAttributeChange:17,UserIdentityChange:18},ee=(g(k={},Z.Commerce,1),g(k,Z.UserIdentityChange,1),k),te={Unknown:0,Navigation:1,Location:2,Search:3,Transaction:4,UserContent:5,UserPreference:6,Social:7,Other:8,Media:9,getName:function(e){return e===te.Unknown?"Unknown":e===te.Navigation?"Navigation":e===te.Location?"Location":e===te.Search?"Search":e===te.Transaction?"Transaction":e===te.UserContent?"User Content":e===te.UserPreference?"User Preference":e===te.Social?"Social":e===re.ProductAddToCart?"Product Added to Cart":e===re.ProductAddToWishlist?"Product Added to Wishlist":e===re.ProductCheckout?"Product Checkout":e===re.ProductCheckoutOption?"Product Checkout Options":e===re.ProductClick?"Product Click":e===re.ProductImpression?"Product Impression":e===re.ProductPurchase?"Product Purchased":e===re.ProductRefund?"Product Refunded":e===re.ProductRemoveFromCart?"Product Removed From Cart":e===re.ProductRemoveFromWishlist?"Product Removed from Wishlist":e===re.ProductViewDetail?"Product View Details":e===re.PromotionClick?"Promotion Click":e===re.PromotionView?"Promotion View":"Other"}},re={ProductAddToCart:10,ProductRemoveFromCart:11,ProductCheckout:12,ProductCheckoutOption:13,ProductClick:14,ProductViewDetail:15,ProductPurchase:16,ProductRefund:17,PromotionView:18,PromotionClick:19,ProductAddToWishlist:20,ProductRemoveFromWishlist:21,ProductImpression:22},ne={Other:0,CustomerId:1,Facebook:2,Twitter:3,Google:4,Microsoft:5,Yahoo:6,Email:7,FacebookCustomAudienceId:9,Other2:10,Other3:11,Other4:12,Other5:13,Other6:14,Other7:15,Other8:16,Other9:17,Other10:18,MobileNumber:19,PhoneNumber2:20,PhoneNumber3:21,isValid:function(e){if("number"==typeof e)for(var t in ne)if(ne.hasOwnProperty(t)&&ne[t]===e)return!0;return!1},getName:function(e){return e===window.mParticle.IdentityType.CustomerId?"Customer ID":e===window.mParticle.IdentityType.Facebook?"Facebook ID":e===window.mParticle.IdentityType.Twitter?"Twitter ID":e===window.mParticle.IdentityType.Google?"Google ID":e===window.mParticle.IdentityType.Microsoft?"Microsoft ID":e===window.mParticle.IdentityType.Yahoo?"Yahoo ID":e===window.mParticle.IdentityType.Email?"Email":e===window.mParticle.IdentityType.FacebookCustomAudienceId?"Facebook App User ID":"Other ID"},getIdentityType:function(e){return"other"===e?ne.Other:"customerid"===e?ne.CustomerId:"facebook"===e?ne.Facebook:"twitter"===e?ne.Twitter:"google"===e?ne.Google:"microsoft"===e?ne.Microsoft:"yahoo"===e?ne.Yahoo:"email"===e?ne.Email:"facebookcustomaudienceid"===e?ne.FacebookCustomAudienceId:"other2"===e?ne.Other2:"other3"===e?ne.Other3:"other4"===e?ne.Other4:"other5"===e?ne.Other5:"other6"===e?ne.Other6:"other7"===e?ne.Other7:"other8"===e?ne.Other8:"other9"===e?ne.Other9:"other10"===e?ne.Other10:"mobile_number"===e?ne.MobileNumber:"phone_number_2"===e?ne.PhoneNumber2:!("phone_number_3"!=e)&&ne.PhoneNumber3},getIdentityName:function(e){return X(e)}},oe={Unknown:0,AddToCart:1,RemoveFromCart:2,Checkout:3,CheckoutOption:4,Click:5,ViewDetail:6,Purchase:7,Refund:8,AddToWishlist:9,RemoveFromWishlist:10,getName:function(e){return e===oe.AddToCart?"Add to Cart":e===oe.RemoveFromCart?"Remove from Cart":e===oe.Checkout?"Checkout":e===oe.CheckoutOption?"Checkout Option":e===oe.Click?"Click":e===oe.ViewDetail?"View Detail":e===oe.Purchase?"Purchase":e===oe.Refund?"Refund":e===oe.AddToWishlist?"Add to Wishlist":e===oe.RemoveFromWishlist?"Remove from Wishlist":"Unknown"},getExpansionName:function(e){return e===oe.AddToCart?"add_to_cart":e===oe.RemoveFromCart?"remove_from_cart":e===oe.Checkout?"checkout":e===oe.CheckoutOption?"checkout_option":e===oe.Click?"click":e===oe.ViewDetail?"view_detail":e===oe.Purchase?"purchase":e===oe.Refund?"refund":e===oe.AddToWishlist?"add_to_wishlist":e===oe.RemoveFromWishlist?"remove_from_wishlist":"unknown"}},ie={Unknown:0,PromotionView:1,PromotionClick:2,getName:function(e){return e===ie.PromotionView?"view":e===ie.PromotionClick?"click":"unknown"},getExpansionName:function(e){return e===ie.PromotionView?"view":e===ie.PromotionClick?"click":"unknown"}},se={MessageType:Z,EventType:te,CommerceEventType:re,IdentityType:ne,ProfileMessageType:{Logout:3},ApplicationTransitionType:{AppInit:1},ProductActionType:oe,PromotionActionType:ie,TriggerUploadType:ee,Environment:{Production:"production",Development:"development"}};function ae(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}!function(e){e[e.Unknown=0]="Unknown",e[e.AddToCart=1]="AddToCart",e[e.RemoveFromCart=2]="RemoveFromCart",e[e.Checkout=3]="Checkout",e[e.CheckoutOption=4]="CheckoutOption",e[e.Click=5]="Click",e[e.ViewDetail=6]="ViewDetail",e[e.Purchase=7]="Purchase",e[e.Refund=8]="Refund",e[e.AddToWishlist=9]="AddToWishlist",e[e.RemoveFromWishlist=10]="RemoveFromWishlist"}($||($={}));var ce,ue,de,le,ge,pe,ve,fe,me,he,ye,Se,be,_e,Ie,Pe,Ce,we,Ae={};ce=Ae,Object.defineProperty(ce,"__esModule",{value:!0}),(ue=ce.ApplicationInformationOsEnum||(ce.ApplicationInformationOsEnum={})).unknown="Unknown",ue.iOS="IOS",ue.android="Android",ue.windowsPhone="WindowsPhone",ue.mobileWeb="MobileWeb",ue.unityIOS="UnityIOS",ue.unityAndroid="UnityAndroid",ue.desktop="Desktop",ue.tvOS="TVOS",ue.roku="Roku",ue.outOfBand="OutOfBand",ue.alexa="Alexa",ue.smartTV="SmartTV",ue.fireTV="FireTV",ue.xbox="Xbox",(ce.ApplicationStateTransitionEventEventTypeEnum||(ce.ApplicationStateTransitionEventEventTypeEnum={})).applicationStateTransition="application_state_transition",(de=ce.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum||(ce.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum={})).applicationInitialized="application_initialized",de.applicationExit="application_exit",de.applicationBackground="application_background",de.applicationForeground="application_foreground",(le=ce.BatchEnvironmentEnum||(ce.BatchEnvironmentEnum={})).unknown="unknown",le.development="development",le.production="production",(ce.BreadcrumbEventEventTypeEnum||(ce.BreadcrumbEventEventTypeEnum={})).breadcrumb="breadcrumb",(ce.CommerceEventEventTypeEnum||(ce.CommerceEventEventTypeEnum={})).commerceEvent="commerce_event",(ge=ce.CommerceEventDataCustomEventTypeEnum||(ce.CommerceEventDataCustomEventTypeEnum={})).addToCart="add_to_cart",ge.removeFromCart="remove_from_cart",ge.checkout="checkout",ge.checkoutOption="checkout_option",ge.click="click",ge.viewDetail="view_detail",ge.purchase="purchase",ge.refund="refund",ge.promotionView="promotion_view",ge.promotionClick="promotion_click",ge.addToWishlist="add_to_wishlist",ge.removeFromWishlist="remove_from_wishlist",ge.impression="impression",(ce.CrashReportEventEventTypeEnum||(ce.CrashReportEventEventTypeEnum={})).crashReport="crash_report",(ce.CustomEventEventTypeEnum||(ce.CustomEventEventTypeEnum={})).customEvent="custom_event",(pe=ce.CustomEventDataCustomEventTypeEnum||(ce.CustomEventDataCustomEventTypeEnum={})).navigation="navigation",pe.location="location",pe.search="search",pe.transaction="transaction",pe.userContent="user_content",pe.userPreference="user_preference",pe.social="social",pe.media="media",pe.other="other",pe.unknown="unknown",(ve=ce.DeviceCurrentStateDeviceOrientationEnum||(ce.DeviceCurrentStateDeviceOrientationEnum={})).portrait="portrait",ve.portraitUpsideDown="portrait_upside_down",ve.landscape="landscape",ve.landscapeLeft="LandscapeLeft",ve.landscapeRight="LandscapeRight",ve.faceUp="FaceUp",ve.faceDown="FaceDown",ve.square="Square",(fe=ce.DeviceCurrentStateStatusBarOrientationEnum||(ce.DeviceCurrentStateStatusBarOrientationEnum={})).portrait="portrait",fe.portraitUpsideDown="portrait_upside_down",fe.landscape="landscape",fe.landscapeLeft="LandscapeLeft",fe.landscapeRight="LandscapeRight",fe.faceUp="FaceUp",fe.faceDown="FaceDown",fe.square="Square",(me=ce.DeviceInformationPlatformEnum||(ce.DeviceInformationPlatformEnum={})).iOS="iOS",me.android="Android",me.web="web",me.desktop="desktop",me.tvOS="tvOS",me.roku="roku",me.outOfBand="out_of_band",me.smartTV="smart_tv",me.xbox="xbox",function(e){e.unknown="unknown",e.sessionStart="session_start",e.sessionEnd="session_end",e.screenView="screen_view",e.customEvent="custom_event",e.crashReport="crash_report",e.optOut="opt_out",e.firstRun="first_run",e.preAttribution="pre_attribution",e.pushRegistration="push_registration",e.applicationStateTransition="application_state_transition",e.pushMessage="push_message",e.networkPerformance="network_performance",e.breadcrumb="breadcrumb",e.profile="profile",e.pushReaction="push_reaction",e.commerceEvent="commerce_event",e.userAttributeChange="user_attribute_change",e.userIdentityChange="user_identity_change",e.uninstall="uninstall",e.validationResult="validation_result"}(ce.EventTypeEnum||(ce.EventTypeEnum={})),(he=ce.IdentityTypeEnum||(ce.IdentityTypeEnum={})).other="other",he.customerId="customer_id",he.facebook="facebook",he.twitter="twitter",he.google="google",he.microsoft="microsoft",he.yahoo="yahoo",he.email="email",he.alias="alias",he.facebookCustomAudienceId="facebook_custom_audience_id",he.otherId2="other_id_2",he.otherId3="other_id_3",he.otherId4="other_id_4",he.otherId5="other_id_5",he.otherId6="other_id_6",he.otherId7="other_id_7",he.otherId8="other_id_8",he.otherId9="other_id_9",he.otherId10="other_id_10",he.mobileNumber="mobile_number",he.phoneNumber2="phone_number_2",he.phoneNumber3="phone_number_3",(ce.NetworkPerformanceEventEventTypeEnum||(ce.NetworkPerformanceEventEventTypeEnum={})).networkPerformance="network_performance",(ce.OptOutEventEnum||(ce.OptOutEventEnum={})).optOut="opt_out",(ye=ce.ProductActionActionEnum||(ce.ProductActionActionEnum={})).unknown="unknown",ye.addToCart="add_to_cart",ye.removeFromCart="remove_from_cart",ye.checkout="checkout",ye.checkoutOption="checkout_option",ye.click="click",ye.viewDetail="view_detail",ye.purchase="purchase",ye.refund="refund",ye.addToWishlist="add_to_wishlist",ye.removeFromWishlist="remove_from_wish_list",(ce.ProfileEventEventTypeEnum||(ce.ProfileEventEventTypeEnum={})).profile="profile",(Se=ce.ProfileEventDataProfileEventTypeEnum||(ce.ProfileEventDataProfileEventTypeEnum={})).signup="signup",Se.login="login",Se.logout="logout",Se.update="update",Se.delete="delete",(be=ce.PromotionActionActionEnum||(ce.PromotionActionActionEnum={})).view="view",be.click="click",(ce.PushMessageEventEventTypeEnum||(ce.PushMessageEventEventTypeEnum={})).pushMessage="push_message",(_e=ce.PushMessageEventDataPushMessageTypeEnum||(ce.PushMessageEventDataPushMessageTypeEnum={})).sent="sent",_e.received="received",_e.action="action",(Ie=ce.PushMessageEventDataApplicationStateEnum||(ce.PushMessageEventDataApplicationStateEnum={})).notRunning="not_running",Ie.background="background",Ie.foreground="foreground",(Pe=ce.PushMessageEventDataPushMessageBehaviorEnum||(ce.PushMessageEventDataPushMessageBehaviorEnum={})).received="Received",Pe.directOpen="DirectOpen",Pe.read="Read",Pe.influencedOpen="InfluencedOpen",Pe.displayed="Displayed",(ce.PushRegistrationEventEventTypeEnum||(ce.PushRegistrationEventEventTypeEnum={})).pushRegistration="push_registration",(ce.SessionEndEventEventTypeEnum||(ce.SessionEndEventEventTypeEnum={})).sessionEnd="session_end",(ce.SessionStartEventEventTypeEnum||(ce.SessionStartEventEventTypeEnum={})).sessionStart="session_start",(Ce=ce.SourceInformationChannelEnum||(ce.SourceInformationChannelEnum={})).native="native",Ce.javascript="javascript",Ce.pixel="pixel",Ce.desktop="desktop",Ce.partner="partner",Ce.serverToServer="server_to_server",(ce.UserAttributeChangeEventEventTypeEnum||(ce.UserAttributeChangeEventEventTypeEnum={})).userAttributeChange="user_attribute_change",(ce.UserIdentityChangeEventEventTypeEnum||(ce.UserIdentityChangeEventEventTypeEnum={})).userIdentityChange="user_identity_change",function(e){e.other="other",e.customerId="customerid",e.facebook="facebook",e.twitter="twitter",e.google="google",e.microsoft="microsoft",e.yahoo="yahoo",e.email="email",e.alias="alias",e.facebookCustomAudienceId="facebookcustomaudienceid",e.otherId2="other2",e.otherId3="other3",e.otherId4="other4",e.otherId5="other5",e.otherId6="other6",e.otherId7="other7",e.otherId8="other8",e.otherId9="other9",e.otherId10="other10",e.mobileNumber="mobile_number",e.phoneNumber2="phone_number_2",e.phoneNumber3="phone_number_3"}(we||(we={}));var Ee=S.FeatureFlags.CaptureIntegrationSpecificIds;function Te(e,t,r){if(!e)return null;if(!t||1>t.length)return null;for(var n,o=r._IntegrationCapture,i=r._Helpers.getFeatureFlag,s=r.Identity.getCurrentUser(),a=[],c=null,u=0,d=t;u<d.length;u++)if(n=d[u]){c=n;var l=Le(n);l&&a.push(l)}if(!c)return null;var g=null;J(c.ConsentState)?!J(s)&&(g=s.getConsentState()):g=c.ConsentState;var p={source_request_id:r._Helpers.generateUniqueId(),mpid:e,timestamp_unixtime_ms:(new Date).getTime(),environment:c.Debug?Ae.BatchEnvironmentEnum.development:Ae.BatchEnvironmentEnum.production,events:a,mp_deviceid:c.DeviceId,sdk_version:c.SDKVersion,application_info:{application_version:c.AppVersion,application_name:c.AppName,package:c.Package,sideloaded_kits_count:r._Store.sideloadedKitsCount},device_info:{platform:Ae.DeviceInformationPlatformEnum.web,screen_width:"undefined"!=typeof window&&void 0!==window.screen?window.screen.width:0,screen_height:"undefined"!=typeof window&&void 0!==window.screen?window.screen.height:0},user_attributes:c.UserAttributes,user_identities:Ue(c.UserIdentities),consent_state:ke(g),integration_attributes:c.IntegrationAttributes};if(c.DataPlan&&c.DataPlan.PlanId&&(p.context={data_plan:{plan_id:c.DataPlan.PlanId,plan_version:c.DataPlan.PlanVersion||void 0}}),i&&!!i(Ee)){var v=null==o?void 0:o.getClickIdsAsPartnerIdentities();J(v)||(p.partner_identities=v)}return p}function ke(e){return J(e)?null:{gdpr:De(e.getGDPRConsentState()),ccpa:Oe(e.getCCPAConsentState())}}function De(e){if(!e)return null;var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]={consented:e[r].Consented,hardware_id:e[r].HardwareId,document:e[r].ConsentDocument,timestamp_unixtime_ms:e[r].Timestamp,location:e[r].Location});return t}function Oe(e){return e?{data_sale_opt_out:{consented:e.Consented,hardware_id:e.HardwareId,document:e.ConsentDocument,timestamp_unixtime_ms:e.Timestamp,location:e.Location}}:null}function Ue(e){if(!e||!e.length)return null;for(var t,r={},n=0,o=e;n<o.length;n++)switch(t=o[n],t.Type){case se.IdentityType.CustomerId:r.customer_id=t.Identity;break;case se.IdentityType.Email:r.email=t.Identity;break;case se.IdentityType.Facebook:r.facebook=t.Identity;break;case se.IdentityType.FacebookCustomAudienceId:r.facebook_custom_audience_id=t.Identity;break;case se.IdentityType.Google:r.google=t.Identity;break;case se.IdentityType.Microsoft:r.microsoft=t.Identity;break;case se.IdentityType.Other:r.other=t.Identity;break;case se.IdentityType.Other2:r.other_id_2=t.Identity;break;case se.IdentityType.Other3:r.other_id_3=t.Identity;break;case se.IdentityType.Other4:r.other_id_4=t.Identity;break;case se.IdentityType.Other5:r.other_id_5=t.Identity;break;case se.IdentityType.Other6:r.other_id_6=t.Identity;break;case se.IdentityType.Other7:r.other_id_7=t.Identity;break;case se.IdentityType.Other8:r.other_id_8=t.Identity;break;case se.IdentityType.Other9:r.other_id_9=t.Identity;break;case se.IdentityType.Other10:r.other_id_10=t.Identity;break;case se.IdentityType.MobileNumber:r.mobile_number=t.Identity;break;case se.IdentityType.PhoneNumber2:r.phone_number_2=t.Identity;break;case se.IdentityType.PhoneNumber3:r.phone_number_3=t.Identity}return r}function Le(e){if(!e)return null;switch(e.EventDataType){case se.MessageType.AppStateTransition:return function(e){var t=je(e),r={application_transition_type:Ae.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum.applicationInitialized,is_first_run:e.IsFirstRun,is_upgrade:!1,launch_referral:e.LaunchReferral};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.applicationStateTransition,data:r}}(e);case se.MessageType.Commerce:return function(e){var t=je(e),r={custom_flags:e.CustomFlags,product_action:Fe(e),promotion_action:Re(e),product_impressions:Ve(e),shopping_cart:He(e),currency_code:e.CurrencyCode};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.commerceEvent,data:r}}(e);case se.MessageType.CrashReport:return function(e){var t=je(e),r={message:e.EventName};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.crashReport,data:r}}(e);case se.MessageType.OptOut:return function(e){var t=je(e),r={is_opted_out:e.OptOut};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.optOut,data:r}}(e);case se.MessageType.PageEvent:return function(e){var t=je(e),r={custom_event_type:Ke(e.EventCategory),custom_flags:e.CustomFlags,event_name:e.EventName};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.customEvent,data:r}}(e);case se.MessageType.PageView:return function(e){var t=je(e),r={custom_flags:e.CustomFlags,screen_name:e.EventName};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.screenView,data:r}}(e);case se.MessageType.Profile:return null;case se.MessageType.SessionEnd:return function(e){var t=je(e),r={session_duration_ms:e.SessionLength};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.sessionEnd,data:r}}(e);case se.MessageType.SessionStart:return function(e){var t=je(e),r={};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.sessionStart,data:r}}(e);case se.MessageType.UserAttributeChange:return function(e){var t=je(e),r={user_attribute_name:e.UserAttributeChanges.UserAttributeName,new:e.UserAttributeChanges.New,old:e.UserAttributeChanges.Old,deleted:e.UserAttributeChanges.Deleted,is_new_attribute:e.UserAttributeChanges.IsNewAttribute};return r=f(f({},r),t),{event_type:Ae.EventTypeEnum.userAttributeChange,data:r}}(e);case se.MessageType.UserIdentityChange:return function(e){var t=je(e),r={new:{identity_type:Be(e.UserIdentityChanges.New.IdentityType),identity:e.UserIdentityChanges.New.Identity||null,timestamp_unixtime_ms:e.Timestamp,created_this_batch:e.UserIdentityChanges.New.CreatedThisBatch},old:{identity_type:Be(e.UserIdentityChanges.Old.IdentityType),identity:e.UserIdentityChanges.Old.Identity||null,timestamp_unixtime_ms:e.Timestamp,created_this_batch:e.UserIdentityChanges.Old.CreatedThisBatch}};return r=Object.assign(r,t),{event_type:Ae.EventTypeEnum.userIdentityChange,data:r}}(e)}return null}function Me(e){return e?e===$.AddToCart?Ae.ProductActionActionEnum.addToCart:e===$.AddToWishlist?Ae.ProductActionActionEnum.addToWishlist:e===$.Checkout?Ae.ProductActionActionEnum.checkout:e===$.CheckoutOption?Ae.ProductActionActionEnum.checkoutOption:e===$.Click?Ae.ProductActionActionEnum.click:e===$.Purchase?Ae.ProductActionActionEnum.purchase:e===$.Refund?Ae.ProductActionActionEnum.refund:e===$.RemoveFromCart?Ae.ProductActionActionEnum.removeFromCart:e===$.RemoveFromWishlist?Ae.ProductActionActionEnum.removeFromWishlist:e===$.ViewDetail?Ae.ProductActionActionEnum.viewDetail:Ae.ProductActionActionEnum.unknown:Ae.ProductActionActionEnum.unknown}function Fe(e){return e.ProductAction?{action:Me(e.ProductAction.ProductActionType),checkout_step:e.ProductAction.CheckoutStep,checkout_options:e.ProductAction.CheckoutOptions,transaction_id:e.ProductAction.TransactionId,affiliation:e.ProductAction.Affiliation,total_amount:e.ProductAction.TotalAmount,tax_amount:e.ProductAction.TaxAmount,shipping_amount:e.ProductAction.ShippingAmount,coupon_code:e.ProductAction.CouponCode,products:Ne(e.ProductAction.ProductList)}:null}function Ne(e){if(!e||!e.length)return null;for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r],i={id:o.Sku,name:o.Name,brand:o.Brand,category:o.Category,variant:o.Variant,total_product_amount:o.TotalAmount,position:o.Position,price:o.Price,quantity:o.Quantity,coupon_code:o.CouponCode,custom_attributes:o.Attributes};t.push(i)}return t}function Re(e){return e.PromotionAction?{action:e.PromotionAction.PromotionActionType,promotions:xe(e.PromotionAction.PromotionList)}:null}function xe(e){if(!e||!e.length)return null;for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r],i={id:o.Id,name:o.Name,creative:o.Creative,position:o.Position};t.push(i)}return t}function Ve(e){if(!e.ProductImpressions)return null;for(var t=[],r=0,n=e.ProductImpressions;r<n.length;r++){var o=n[r],i={product_impression_list:o.ProductImpressionList,products:Ne(o.ProductList)};t.push(i)}return t}function He(e){return e.ShoppingCart&&e.ShoppingCart.ProductList&&e.ShoppingCart.ProductList.length?{products:Ne(e.ShoppingCart.ProductList)}:null}function Ke(e){return e===se.EventType.Other?Ae.CustomEventDataCustomEventTypeEnum.other:e===se.EventType.Location?Ae.CustomEventDataCustomEventTypeEnum.location:e===se.EventType.Navigation?Ae.CustomEventDataCustomEventTypeEnum.navigation:e===se.EventType.Search?Ae.CustomEventDataCustomEventTypeEnum.search:e===se.EventType.Social?Ae.CustomEventDataCustomEventTypeEnum.social:e===se.EventType.Transaction?Ae.CustomEventDataCustomEventTypeEnum.transaction:e===se.EventType.UserContent?Ae.CustomEventDataCustomEventTypeEnum.userContent:e===se.EventType.UserPreference?Ae.CustomEventDataCustomEventTypeEnum.userPreference:e===se.EventType.Media?Ae.CustomEventDataCustomEventTypeEnum.media:e===se.CommerceEventType.ProductAddToCart?Ae.CommerceEventDataCustomEventTypeEnum.addToCart:e===se.CommerceEventType.ProductAddToWishlist?Ae.CommerceEventDataCustomEventTypeEnum.addToWishlist:e===se.CommerceEventType.ProductCheckout?Ae.CommerceEventDataCustomEventTypeEnum.checkout:e===se.CommerceEventType.ProductCheckoutOption?Ae.CommerceEventDataCustomEventTypeEnum.checkoutOption:e===se.CommerceEventType.ProductClick?Ae.CommerceEventDataCustomEventTypeEnum.click:e===se.CommerceEventType.ProductImpression?Ae.CommerceEventDataCustomEventTypeEnum.impression:e===se.CommerceEventType.ProductPurchase?Ae.CommerceEventDataCustomEventTypeEnum.purchase:e===se.CommerceEventType.ProductRefund?Ae.CommerceEventDataCustomEventTypeEnum.refund:e===se.CommerceEventType.ProductRemoveFromCart?Ae.CommerceEventDataCustomEventTypeEnum.removeFromCart:e===se.CommerceEventType.ProductRemoveFromWishlist?Ae.CommerceEventDataCustomEventTypeEnum.removeFromWishlist:e===se.CommerceEventType.ProductViewDetail?Ae.CommerceEventDataCustomEventTypeEnum.viewDetail:e===se.CommerceEventType.PromotionClick?Ae.CommerceEventDataCustomEventTypeEnum.promotionClick:e===se.CommerceEventType.PromotionView?Ae.CommerceEventDataCustomEventTypeEnum.promotionView:Ae.CustomEventDataCustomEventTypeEnum.unknown}function je(e){return{timestamp_unixtime_ms:e.Timestamp,session_uuid:e.SessionId,session_start_unixtime_ms:e.SessionStartDate,custom_attributes:e.EventAttributes,location:qe(e.Location),source_message_id:e.SourceMessageId}}function qe(e){return e&&Object.keys(e).length?{latitude:e.lat,longitude:e.lng}:null}function Be(e){return e===we.other?Ae.IdentityTypeEnum.other:e===we.customerId?Ae.IdentityTypeEnum.customerId:e===we.facebook?Ae.IdentityTypeEnum.facebook:e===we.twitter?Ae.IdentityTypeEnum.twitter:e===we.google?Ae.IdentityTypeEnum.google:e===we.microsoft?Ae.IdentityTypeEnum.microsoft:e===we.yahoo?Ae.IdentityTypeEnum.yahoo:e===we.email?Ae.IdentityTypeEnum.email:e===we.alias?Ae.IdentityTypeEnum.alias:e===we.facebookCustomAudienceId?Ae.IdentityTypeEnum.facebookCustomAudienceId:e===we.otherId2?Ae.IdentityTypeEnum.otherId2:e===we.otherId3?Ae.IdentityTypeEnum.otherId3:e===we.otherId4?Ae.IdentityTypeEnum.otherId4:e===we.otherId5?Ae.IdentityTypeEnum.otherId5:e===we.otherId6?Ae.IdentityTypeEnum.otherId6:e===we.otherId7?Ae.IdentityTypeEnum.otherId7:e===we.otherId8?Ae.IdentityTypeEnum.otherId8:e===we.otherId9?Ae.IdentityTypeEnum.otherId9:e===we.otherId10?Ae.IdentityTypeEnum.otherId10:e===we.mobileNumber?Ae.IdentityTypeEnum.mobileNumber:e===we.phoneNumber2?Ae.IdentityTypeEnum.phoneNumber2:e===we.phoneNumber3?Ae.IdentityTypeEnum.phoneNumber3:void 0}var We=function(){function e(e,t,r){this._storageKey=e,this.storageObject=t,this.logger=(null==r?void 0:r.logger)||{verbose:function(){},warning:function(){},error:function(){}},this.contents=this.retrieve()}return e.prototype.store=function(e){this.contents=e;var t=J(e)?"":JSON.stringify(e);try{this.storageObject.setItem(this._storageKey,t),this.logger.verbose("Saving item to Storage: ".concat(t))}catch(e){this.logger.error("Cannot Save items to Storage: ".concat(t)),this.logger.error(e)}},e.prototype.retrieve=function(){var e=this.storageObject.getItem(this._storageKey);return this.contents=e?JSON.parse(e):null,this.logger.verbose("Retrieving item from Storage: ".concat(e)),this.contents},e.prototype.purge=function(){this.logger.verbose("Purging Storage"),this.contents=null,this.storageObject.removeItem(this._storageKey)},e}(),ze=function(e){function t(t,r){return e.call(this,t,window.localStorage,r)||this}return v(t,e),t}(We),Je=function(e){function t(t,r){return e.call(this,t,window.sessionStorage,r)||this}return v(t,e),t}(We),Qe=function(e){this.url=e},Ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return v(t,e),t.prototype.upload=function(e,t){return m(this,void 0,void 0,(function(){var r;return h(this,(function(n){switch(n.label){case 0:return r=t||this.url,[4,fetch(r,e)];case 1:return[2,n.sent()]}}))}))},t}(Qe),Ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return v(t,e),t.prototype.upload=function(e){return m(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this.makeRequest(this.url,e.body,e.method,e.headers)];case 1:return[2,t.sent()]}}))}))},t.prototype.makeRequest=function(e,t,r,n){return void 0===r&&(r="post"),void 0===n&&(n={}),m(this,void 0,void 0,(function(){var o;return h(this,(function(){return o=new XMLHttpRequest,[2,new Promise((function(i,s){o.onreadystatechange=function(){4!==o.readyState||i(o)},o.onerror=function(){s(o)},o.open(r,e),Object.entries(n).forEach((function(e){var t=e[0],r=e[1];o.setRequestHeader(t,r)})),o.send(t)}))]}))}))},t}(Qe),Xe=function(){function e(t,r){var n;this.offlineStorageEnabled=!1,this.mpInstance=t,this.uploadIntervalMillis=r,this.batchingEnabled=r>=e.MINIMUM_INTERVAL_MILLIS,this.uploadIntervalMillis<e.MINIMUM_INTERVAL_MILLIS&&(this.uploadIntervalMillis=e.MINIMUM_INTERVAL_MILLIS),this.eventsQueuedForProcessing=[],this.batchesQueuedForProcessing=[],this.offlineStorageEnabled=this.isOfflineStorageAvailable(),this.offlineStorageEnabled&&(this.eventVault=new Je("".concat(t._Store.storageName,"-events"),{logger:t.Logger}),this.batchVault=new ze("".concat(t._Store.storageName,"-batches"),{logger:t.Logger}),(n=this.eventsQueuedForProcessing).push.apply(n,this.eventVault.retrieve()));var o=this.mpInstance._Store,i=o.SDKConfig,s=o.devToken,a=this.mpInstance._Helpers.createServiceUrl(i.v3SecureServiceUrl,s);this.uploadUrl="".concat(a,"/events"),this.uploader=window.fetch?new Ge(this.uploadUrl):new Ye(this.uploadUrl),this.triggerUploadInterval(!0,!1),this.addEventListeners()}return e.prototype.isOfflineStorageAvailable=function(){var e=this.mpInstance,t=e._Helpers.getFeatureFlag,r=e._Store.deviceId,n=t(S.FeatureFlags.OfflineStorage),o=parseInt(n,10),i=function(e){if(!e)return 100;var t=T(e);return Math.abs(t%100)+1}(r);return o>=i},e.prototype.addEventListeners=function(){var e=this;document.addEventListener("visibilitychange",(function(){e.prepareAndUpload(!1,e.isBeaconAvailable())})),window.addEventListener("beforeunload",(function(){e.prepareAndUpload(!1,e.isBeaconAvailable())})),window.addEventListener("pagehide",(function(){e.prepareAndUpload(!1,e.isBeaconAvailable())}))},e.prototype.isBeaconAvailable=function(){return!!navigator.sendBeacon},e.prototype.triggerUploadInterval=function(e,t){var r=this;void 0===e&&(e=!1),void 0===t&&(t=!1),setTimeout((function(){r.prepareAndUpload(e,t)}),this.uploadIntervalMillis)},e.prototype.queueEvent=function(e){J(e)||(this.eventsQueuedForProcessing.push(e),this.offlineStorageEnabled&&this.eventVault&&this.eventVault.store(this.eventsQueuedForProcessing),this.mpInstance.Logger.verbose("Queuing event: ".concat(JSON.stringify(e))),this.mpInstance.Logger.verbose("Queued event count: ".concat(this.eventsQueuedForProcessing.length)),(!this.batchingEnabled||se.TriggerUploadType[e.EventDataType])&&this.prepareAndUpload(!1,!1))},e.createNewBatches=function(e,t,r){if(!t||!e||!e.length)return null;for(var n=[],o=new Map,i=0,s=e;i<s.length;i++){if(!(m=s[i]).MPID){var a=t.getMPID();m.MPID=a}(f=o.get(m.MPID))||(f=[]),f.push(m),o.set(m.MPID,f)}for(var c=0,u=Array.from(o.entries());c<u.length;c++){for(var d=u[c],l=(a=d[0],d[1]),g=new Map,p=0,v=l;p<v.length;p++){var f,m=v[p];(f=g.get(m.SessionId))||(f=[]),f.push(m),g.set(m.SessionId,f)}for(var h=0,y=Array.from(g.entries());h<y.length;h++){var S=Te(a,y[h][1],r),b=r._Store.SDKConfig.onCreateBatch;b&&((S=b(S))?S.modified=!0:r.Logger.warning("Skiping batch upload because no batch was returned from onCreateBatch callback")),S&&n.push(S)}}return n},e.prototype.prepareAndUpload=function(t,r){return m(this,void 0,void 0,(function(){var n,o,i,s,a,c,u,d;return h(this,(function(l){switch(l.label){case 0:return n=this.mpInstance.Identity.getCurrentUser(),o=this.eventsQueuedForProcessing,this.eventsQueuedForProcessing=[],this.offlineStorageEnabled&&this.eventVault&&this.eventVault.store([]),i=[],J(o)||(i=e.createNewBatches(o,n,this.mpInstance)),this.offlineStorageEnabled&&this.batchVault&&((c=this.batchesQueuedForProcessing).unshift.apply(c,this.batchVault.retrieve()),this.batchVault.purge()),J(i)||(u=this.batchesQueuedForProcessing).push.apply(u,i),s=this.batchesQueuedForProcessing,this.batchesQueuedForProcessing=[],[4,this.uploadBatches(this.mpInstance.Logger,s,r)];case 1:return a=l.sent(),J(a)||(d=this.batchesQueuedForProcessing).unshift.apply(d,a),!r&&this.offlineStorageEnabled&&this.batchVault&&(this.batchVault.store(this.batchesQueuedForProcessing),this.batchesQueuedForProcessing=[]),t&&this.triggerUploadInterval(t,!1),[2]}}))}))},e.prototype.uploadBatches=function(t,r,n){return m(this,void 0,void 0,(function(){var o,i,s,a,c,u;return h(this,(function(d){switch(d.label){case 0:if(o=r.filter((function(e){return!J(e.events)})),J(o))return[2,null];t.verbose("Uploading batches: ".concat(JSON.stringify(o))),t.verbose("Batch count: ".concat(o.length)),i=0,d.label=1;case 1:return i<o.length?(s={method:"POST",headers:{Accept:e.CONTENT_TYPE,"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(o[i])},n&&this.isBeaconAvailable()?(a=new Blob([s.body],{type:"text/plain;charset=UTF-8"}),navigator.sendBeacon(this.uploadUrl,a),[3,5]):[3,2]):[3,6];case 2:return d.trys.push([2,4,,5]),[4,this.uploader.upload(s)];case 3:if(!(200<=(c=d.sent()).status&&300>c.status)){if(500<=c.status||429===c.status)return t.error("HTTP error status ".concat(c.status," received")),[2,o.slice(i,o.length)];if(401<=c.status)return t.error("HTTP error status ".concat(c.status," while uploading - please verify your API key.")),[2,null];throw console.error("HTTP error status ".concat(c.status," while uploading events."),c),new Error("Uncaught HTTP Error ".concat(c.status,".  Batch upload will be re-attempted."))}return t.verbose("Upload success for request ID: ".concat(o[i].source_request_id)),[3,5];case 4:return u=d.sent(),t.error("Error sending event to mParticle servers. ".concat(u)),[2,o.slice(i,o.length)];case 5:return i++,[3,1];case 6:return[2,null]}}))}))},e.CONTENT_TYPE="text/plain;charset=UTF-8",e.MINIMUM_INTERVAL_MILLIS=500,e}();function $e(e,t){this.uploader=null;var r=this;this.queueEventForBatchUpload=function(t){if(!this.uploader){var r=U(e._Helpers.getFeatureFlag(S.FeatureFlags.EventBatchingIntervalMillis));this.uploader=new Xe(e,r)}this.uploader.queueEvent(t),e._Persistence.update()},this.processQueuedEvents=function(){var t,n=e.Identity.getCurrentUser();if(n&&(t=n.getMPID()),e._Store.eventQueue.length&&t){var o=e._Store.eventQueue;e._Store.eventQueue=[],this.appendUserInfoToEvents(n,o),o.forEach((function(e){r.sendEventToServer(e)}))}},this.appendUserInfoToEvents=function(t,r){r.forEach((function(r){r.MPID||e._ServerModel.appendUserInfo(t,r)}))},this.sendEventToServer=function(r,n){var o=e._Helpers.extend({shouldUploadEvent:!0},n);if(!e._Store.webviewBridgeEnabled){var i,s=e.Identity.getCurrentUser();return s&&(i=s.getMPID()),e._Store.requireDelay=e._Helpers.isDelayedByIntegration(e._preInit.integrationDelays,e._Store.integrationDelayTimeoutStart,Date.now()),i&&!e._Store.requireDelay&&e._Store.configurationLoaded?(this.processQueuedEvents(),void(J(r)||(o.shouldUploadEvent&&this.queueEventForBatchUpload(r),r.EventName!==se.MessageType.AppStateTransition&&(t&&t.kitBlockingEnabled&&(r=t.createBlockedEvent(r)),r&&e._Forwarders.sendEventToForwarders(r))))):(e.Logger.verbose("Event was added to eventQueue. eventQueue will be processed once a valid MPID is returned or there is no more integration imposed delay."),void e._Store.eventQueue.push(r))}e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.LogEvent,JSON.stringify(r))},this.sendBatchForwardingStatsToServer=function(t,r){var n,o;try{n=e._Helpers.createServiceUrl(e._Store.SDKConfig.v2SecureServiceUrl,e._Store.devToken),o={uuid:e._Helpers.generateUniqueId(),data:t},r&&(r.open("post",n+"/Forwarding"),r.send(JSON.stringify(o)))}catch(t){e.Logger.error("Error sending forwarding stats to mParticle servers.")}},this.initializeForwarderStatsUploader=function(){var t=e._Store.SDKConfig.v1SecureServiceUrl,r=e._Store.devToken,n="https://".concat(t).concat(r,"/Forwarding");return window.fetch?new Ge(n):new Ye(n)},this.prepareForwardingStats=function(t,r){var n,o=e._Forwarders.getForwarderStatsQueue();if(t&&t.isVisible){n={mid:t.id,esid:t.eventSubscriptionId,n:r.EventName,attrs:r.EventAttributes,sdk:r.SDKVersion,dt:r.EventDataType,et:r.EventCategory,dbg:r.Debug,ct:r.Timestamp,eec:r.ExpandedEventCount,dp:r.DataPlan};var i=e._Forwarders,s=i.sendSingleForwardingStatsToServer,a=i.setForwarderStatsQueue;e._Helpers.getFeatureFlag(S.FeatureFlags.ReportBatching)?(o.push(n),a(o)):s(n)}}}var Ze=S.IdentityMethods.Modify,et={isNumber:j,isFunction:q,isStringOrNumber:z,isValidAttributeValue:function(e){return void 0!==e&&!O(e)&&!Array.isArray(e)},isValidKeyValue:function(e){return!(!e||O(e)||Array.isArray(e)||this.isFunction(e))},validateIdentities:function(e,t){var r={userIdentities:1,onUserAlias:1,copyUserAttributes:1};if(e){if(t===Ze&&(O(e.userIdentities)&&!Object.keys(e.userIdentities).length||!O(e.userIdentities)))return{valid:!1,error:S.Messages.ValidationMessages.ModifyIdentityRequestUserIdentitiesPresent};for(var n in e)if(e.hasOwnProperty(n)){if(!r[n])return{valid:!1,error:S.Messages.ValidationMessages.IdentityRequesetInvalidKey};if("onUserAlias"===n&&!et.isFunction(e[n]))return{valid:!1,error:S.Messages.ValidationMessages.OnUserAliasType}}if(0===Object.keys(e).length)return{valid:!0};if(void 0===e.userIdentities)return{valid:!1,error:S.Messages.ValidationMessages.UserIdentities};if(null!==e.userIdentities&&!O(e.userIdentities))return{valid:!1,error:S.Messages.ValidationMessages.UserIdentities};if(O(e.userIdentities)&&Object.keys(e.userIdentities).length)for(var o in e.userIdentities)if(e.userIdentities.hasOwnProperty(o)){if(!1===se.IdentityType.getIdentityType(o))return{valid:!1,error:S.Messages.ValidationMessages.UserIdentitiesInvalidKey};if("string"!=typeof e.userIdentities[o]&&null!==e.userIdentities[o])return{valid:!1,error:S.Messages.ValidationMessages.UserIdentitiesInvalidValues}}}return{valid:!0}}},tt=function(){function e(){}return e.hashEventType=function(e){return T(e)},e.hashEventName=function(e,t){return T(t+e)},e.hashEventAttributeKey=function(e,t,r){return T(e+t+r)},e.hashUserAttribute=function(e){return T(e)},e.hashUserIdentity=function(e){return e},e.hashConsentPurpose=function(e,t){return T(e+t)},e.hashAttributeConditionalForwarding=function(e){return T(e).toString()},e.hashConsentPurposeConditionalForwarding=function(e,t){return this.hashConsentPurpose(e,t).toString()},e}(),rt=S.StorageNames;function nt(e){var t=this;this.canLog=function(){return!(!e._Store.isEnabled||!e._Store.devToken&&!e._Store.webviewBridgeEnabled)},this.getFeatureFlag=function(t){return e._Store.SDKConfig.flags.hasOwnProperty(t)?e._Store.SDKConfig.flags[t]:null},this.invokeCallback=function(r,n,o,i,s){r||e.Logger.warning("There is no callback provided");try{t.Validators.isFunction(r)&&r({httpCode:n,body:o,getUser:function(){return i||e.Identity.getCurrentUser()},getPreviousUser:function(){if(!s){var t=e.Identity.getUsers(),r=t.shift(),n=i||e.Identity.getCurrentUser();return r&&n&&r.getMPID()===n.getMPID()&&(r=t.shift()),r||null}return e.Identity.getUser(s)}})}catch(t){e.Logger.error("There was an error with your callback: "+t)}},this.invokeAliasCallback=function(r,n,o){r||e.Logger.warning("There is no callback provided");try{if(t.Validators.isFunction(r)){var i={httpCode:n};o&&(i.message=o),r(i)}}catch(t){e.Logger.error("There was an error with your callback: "+t)}},this.extend=function(){var e,r,n,o,i,s,a=arguments[0]||{},c=1,u=arguments.length,l=!1,g={hasOwn:Object.prototype.hasOwnProperty,class2type:{},type:function(e){return null==e?e+"":g.class2type[Object.prototype.toString.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==g.type(e)||e.nodeType||g.isWindow(e))return!1;try{if(e.constructor&&!g.hasOwn.call(e,"constructor")&&!g.hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(var t in e);return void 0===t||g.hasOwn.call(e,t)},isArray:Array.isArray||function(e){return"array"===g.type(e)},isFunction:function(e){return"function"===g.type(e)},isWindow:function(e){return null!=e&&e==e.window}};for("boolean"==typeof a&&(l=a,a=arguments[1]||{},c=2),"object"===d(a)||g.isFunction(a)||(a={}),u===c&&(a=this,--c);c<u;c++)if(null!=(e=arguments[c]))for(r in e)n=a[r],a!==(o=e[r])&&(l&&o&&(g.isPlainObject(o)||(i=g.isArray(o)))?(i?(i=!1,s=n&&g.isArray(n)?n:[]):s=n&&g.isPlainObject(n)?n:{},a[r]=t.extend(l,s,o)):void 0!==o&&(a[r]=o));return a},this.createServiceUrl=function(t,r){var n,o=window.mParticle&&e._Store.SDKConfig.forceHttps?"https://":window.location.protocol+"//";return n=e._Store.SDKConfig.forceHttps?"https://"+t:o+t,r&&(n+=r),n},this.createXHR=function(t){var r;try{r=new window.XMLHttpRequest}catch(t){e.Logger.error("Error creating XMLHttpRequest object.")}if(r&&t&&"withCredentials"in r)r.onreadystatechange=t;else if(void 0!==window.XDomainRequest){e.Logger.verbose("Creating XDomainRequest object");try{(r=new window.XDomainRequest).onload=t}catch(t){e.Logger.error("Error creating XDomainRequest object")}}return r},this.filterUserIdentities=function(e,r){var n=[];if(e&&Object.keys(e).length)for(var o in e)if(e.hasOwnProperty(o)){var i=se.IdentityType.getIdentityType(o);if(!t.inArray(r,i)){var s={Type:i,Identity:e[o]};i===se.IdentityType.CustomerId?n.unshift(s):n.push(s)}}return n},this.filterUserIdentitiesForForwarders=function(e,r){var n={};if(e&&Object.keys(e).length)for(var o in e)if(e.hasOwnProperty(o)){var i=tt.hashUserIdentity(se.IdentityType.getIdentityType(o));t.inArray(r,i)||(n[o]=e[o])}return n},this.filterUserAttributes=function(e,r){var n={};if(e&&Object.keys(e).length)for(var o in e)if(e.hasOwnProperty(o)){var i=tt.hashUserAttribute(o);t.inArray(r,i)||(n[o]=e[o])}return n},this.isFilteredUserAttribute=function(e,r){var n=tt.hashUserAttribute(e);return r&&t.inArray(r,n)},this.isEventType=function(e){for(var t in se.EventType)if(se.EventType.hasOwnProperty(t)&&se.EventType[t]===e)return!0;return!1},this.sanitizeAttributes=function(r,n){if(!r||!t.isObject(r))return null;var o={};for(var i in r)r.hasOwnProperty(i)&&t.Validators.isValidAttributeValue(r[i])?o[i]=r[i]:e.Logger.warning("For '"+n+"', the corresponding attribute value of '"+i+"' must be a string, number, boolean, or null.");return o},this.isDelayedByIntegration=function(t,r,n){if(n-r>e._Store.SDKConfig.integrationDelayTimeout)return!1;for(var o in t)if(!0===t[o])return!0;return!1},this.createMainStorageName=function(e){return e?rt.currentStorageName+"_"+e:rt.currentStorageName},this.createProductStorageName=function(e){return e?rt.currentStorageProductsName+"_"+e:rt.currentStorageProductsName},this.converted=H,this.findKeyInObject=A,this.parseNumber=U,this.inArray=w,this.isObject=O,this.decoded=V,this.parseStringOrNumber=L,this.generateHash=T,this.generateUniqueId=D,this.Validators=et}var ot=S.Messages,it="mParticleAndroid",st="mParticle";function at(e){var t=this;this.initializeSessionAttributes=function(e){var r=S.NativeSdkPaths.SetSessionAttribute,n=JSON.stringify({key:"$src_env",value:"webview"}),o=JSON.stringify({key:"$src_key",value:e});t.sendToNative(r,n),e&&t.sendToNative(r,o)},this.isBridgeV2Available=function(e){if(!e)return!1;var t=st+"_"+e+"_v2";return!!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.hasOwnProperty(t))||!(!window.mParticle||!window.mParticle.uiwebviewBridgeName||window.mParticle.uiwebviewBridgeName!==t)||!!window.hasOwnProperty(it+"_"+e+"_v2")},this.isWebviewEnabled=function(r,n){return e._Store.bridgeV2Available=t.isBridgeV2Available(r),e._Store.bridgeV1Available=t.isBridgeV1Available(),2===n?e._Store.bridgeV2Available:!(window.mParticle&&window.mParticle.uiwebviewBridgeName&&window.mParticle.uiwebviewBridgeName!==st+"_"+r+"_v2")&&!!(2>n)&&(e._Store.bridgeV2Available||e._Store.bridgeV1Available)},this.isBridgeV1Available=function(){return!!(e._Store.SDKConfig.useNativeSdk||window.mParticleAndroid||e._Store.SDKConfig.isIOS)},this.sendToNative=function(r,n){return e._Store.bridgeV2Available&&2===e._Store.SDKConfig.minWebviewBridgeVersion||e._Store.bridgeV2Available&&2>e._Store.SDKConfig.minWebviewBridgeVersion?void t.sendViaBridgeV2(r,n,e._Store.SDKConfig.requiredWebviewBridgeName):e._Store.bridgeV1Available&&2>e._Store.SDKConfig.minWebviewBridgeVersion?void t.sendViaBridgeV1(r,n):void 0},this.sendViaBridgeV1=function(r,n){window.mParticleAndroid&&window.mParticleAndroid.hasOwnProperty(r)?(e.Logger.verbose(ot.InformationMessages.SendAndroid+r),window.mParticleAndroid[r](n)):e._Store.SDKConfig.isIOS&&(e.Logger.verbose(ot.InformationMessages.SendIOS+r),t.sendViaIframeToIOS(r,n))},this.sendViaIframeToIOS=function(e,t){var r=document.createElement("IFRAME");r.setAttribute("src","mp-sdk://"+e+"/"+encodeURIComponent(t)),document.documentElement.appendChild(r),r.parentNode.removeChild(r)},this.sendViaBridgeV2=function(r,n,o){if(o){var i,s,a=window[it+"_"+o+"_v2"],c=st+"_"+o+"_v2";return window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers[c]&&(i=window.webkit.messageHandlers[c]),e.uiwebviewBridgeName===c&&(s=e[c]),a&&a.hasOwnProperty(r)?(e.Logger.verbose(ot.InformationMessages.SendAndroid+r),void a[r](n)):void(i?(e.Logger.verbose(ot.InformationMessages.SendIOS+r),i.postMessage(JSON.stringify({path:r,value:n?JSON.parse(n):null}))):s&&(e.Logger.verbose(ot.InformationMessages.SendIOS+r),t.sendViaIframeToIOS(r,n)))}}}var ct=S.Messages;function ut(e){var t=this;this.attemptCookieSync=function(r,n,o){var i,s,a,c,u,d;n&&!e._Store.webviewBridgeEnabled&&e._Store.pixelConfigurations.forEach((function(l){d=!1,l.filteringConsentRuleValues&&l.filteringConsentRuleValues.values&&l.filteringConsentRuleValues.values.length&&(d=!0),i={moduleId:l.moduleId,frequencyCap:l.frequencyCap,pixelUrl:t.replaceAmp(l.pixelUrl),redirectUrl:l.redirectUrl?t.replaceAmp(l.redirectUrl):null,filteringConsentRuleValues:l.filteringConsentRuleValues},a=t.replaceMPID(i.pixelUrl,n),c=i.redirectUrl?t.replaceMPID(i.redirectUrl,n):"",u=a+encodeURIComponent(c);var g=e._Persistence.getPersistence();return r&&r!==n?void(g&&g[n]&&(!g[n].csd&&(g[n].csd={}),t.performCookieSync(u,i.moduleId,n,g[n].csd,i.filteringConsentRuleValues,o,d))):void(g[n]&&(!g[n].csd&&(g[n].csd={}),s=g[n].csd[i.moduleId.toString()]?g[n].csd[i.moduleId.toString()]:null,s?(new Date).getTime()>new Date(s).getTime()+60*i.frequencyCap*1e3*60*24&&t.performCookieSync(u,i.moduleId,n,g[n].csd,i.filteringConsentRuleValues,o,d):t.performCookieSync(u,i.moduleId,n,g[n].csd,i.filteringConsentRuleValues,o,d)))}))},this.replaceMPID=function(e,t){return e.replace("%%mpid%%",t)},this.replaceAmp=function(e){return e.replace(/&amp;/g,"&")},this.performCookieSync=function(t,r,n,o,i,s,a){if((!a||!s)&&e._Consent.isEnabledForUserConsent(i,e.Identity.getCurrentUser())){var c=document.createElement("img");e.Logger.verbose(ct.InformationMessages.CookieSync),c.onload=function(){o[r.toString()]=(new Date).getTime(),e._Persistence.saveUserCookieSyncDatesToPersistence(n,o)},c.src=t}}}var dt=S.Messages;function lt(e){var t=this;this.initialize=function(){if(e._Store.sessionId){var r=6e4*e._Store.SDKConfig.sessionTimeout;if(new Date>new Date(e._Store.dateLastEventSent.getTime()+r))t.endSession(),t.startNewSession();else{var n=e._Persistence.getPersistence();n&&!n.cu&&(e.Identity.identify(e._Store.SDKConfig.identifyRequest,e._Store.SDKConfig.identityCallback),e._Store.identifyCalled=!0,e._Store.SDKConfig.identityCallback=null)}}else t.startNewSession()},this.getSession=function(){return e.Logger.warning(E("SessionManager.getSession()","SessionManager.getSessionId()")),this.getSessionId()},this.getSessionId=function(){return e._Store.sessionId},this.startNewSession=function(){if(e.Logger.verbose(dt.InformationMessages.StartingNewSession),e._Helpers.canLog()){e._Store.sessionId=e._Helpers.generateUniqueId().toUpperCase();var r=e.Identity.getCurrentUser(),n=r?r.getMPID():null;if(n&&(e._Store.currentSessionMPIDs=[n]),!e._Store.sessionStartDate){var o=new Date;e._Store.sessionStartDate=o,e._Store.dateLastEventSent=o}t.setSessionTimer(),e._Store.identifyCalled||(e.Identity.identify(e._Store.SDKConfig.identifyRequest,e._Store.SDKConfig.identityCallback),e._Store.identifyCalled=!0,e._Store.SDKConfig.identityCallback=null),e._Events.logEvent({messageType:se.MessageType.SessionStart})}else e.Logger.verbose(dt.InformationMessages.AbandonStartSession)},this.endSession=function(r){var n;if(e.Logger.verbose(dt.InformationMessages.StartingEndSession),r)return e._Events.logEvent({messageType:se.MessageType.SessionEnd}),void e._Store.nullifySession();if(e._Helpers.canLog()){var o,i=e._Persistence.getPersistence();if(!i||i.gs&&!i.gs.sid)e.Logger.verbose(dt.InformationMessages.NoSessionToEnd);else if(i.gs.sid&&e._Store.sessionId!==i.gs.sid&&(e._Store.sessionId=i.gs.sid),null===(n=null==i?void 0:i.gs)||void 0===n?void 0:n.les)o=6e4*e._Store.SDKConfig.sessionTimeout,(new Date).getTime()-i.gs.les<o?t.setSessionTimer():(e._Events.logEvent({messageType:se.MessageType.SessionEnd}),e._Store.sessionStartDate=null,e._Store.nullifySession())}else e.Logger.verbose(dt.InformationMessages.AbandonEndSession)},this.setSessionTimer=function(){var r=6e4*e._Store.SDKConfig.sessionTimeout;e._Store.globalTimer=window.setTimeout((function(){t.endSession()}),r)},this.resetSessionTimer=function(){e._Store.webviewBridgeEnabled||(!e._Store.sessionId&&t.startNewSession(),t.clearSessionTimeout(),t.setSessionTimer()),t.startNewSessionIfNeeded()},this.clearSessionTimeout=function(){clearTimeout(e._Store.globalTimer)},this.startNewSessionIfNeeded=function(){if(!e._Store.webviewBridgeEnabled){var r=e._Persistence.getPersistence();!e._Store.sessionId&&r&&(r.sid?e._Store.sessionId=r.sid:t.startNewSession())}}}var gt=S.Messages;function pt(e){var t=this;this.convertTransactionAttributesToProductAction=function(e,t){e.hasOwnProperty("Id")&&(t.TransactionId=e.Id),e.hasOwnProperty("Affiliation")&&(t.Affiliation=e.Affiliation),e.hasOwnProperty("CouponCode")&&(t.CouponCode=e.CouponCode),e.hasOwnProperty("Revenue")&&(t.TotalAmount=this.sanitizeAmount(e.Revenue,"Revenue")),e.hasOwnProperty("Shipping")&&(t.ShippingAmount=this.sanitizeAmount(e.Shipping,"Shipping")),e.hasOwnProperty("Tax")&&(t.TaxAmount=this.sanitizeAmount(e.Tax,"Tax")),e.hasOwnProperty("Step")&&(t.CheckoutStep=e.Step),e.hasOwnProperty("Option")&&(t.CheckoutOptions=e.Option)},this.getProductActionEventName=function(e){switch(e){case se.ProductActionType.AddToCart:return"AddToCart";case se.ProductActionType.AddToWishlist:return"AddToWishlist";case se.ProductActionType.Checkout:return"Checkout";case se.ProductActionType.CheckoutOption:return"CheckoutOption";case se.ProductActionType.Click:return"Click";case se.ProductActionType.Purchase:return"Purchase";case se.ProductActionType.Refund:return"Refund";case se.ProductActionType.RemoveFromCart:return"RemoveFromCart";case se.ProductActionType.RemoveFromWishlist:return"RemoveFromWishlist";case se.ProductActionType.ViewDetail:return"ViewDetail";case se.ProductActionType.Unknown:default:return"Unknown"}},this.getPromotionActionEventName=function(e){return e===se.PromotionActionType.PromotionClick?"PromotionClick":e===se.PromotionActionType.PromotionView?"PromotionView":"Unknown"},this.convertProductActionToEventType=function(t){return t===se.ProductActionType.AddToCart?se.CommerceEventType.ProductAddToCart:t===se.ProductActionType.AddToWishlist?se.CommerceEventType.ProductAddToWishlist:t===se.ProductActionType.Checkout?se.CommerceEventType.ProductCheckout:t===se.ProductActionType.CheckoutOption?se.CommerceEventType.ProductCheckoutOption:t===se.ProductActionType.Click?se.CommerceEventType.ProductClick:t===se.ProductActionType.Purchase?se.CommerceEventType.ProductPurchase:t===se.ProductActionType.Refund?se.CommerceEventType.ProductRefund:t===se.ProductActionType.RemoveFromCart?se.CommerceEventType.ProductRemoveFromCart:t===se.ProductActionType.RemoveFromWishlist?se.CommerceEventType.ProductRemoveFromWishlist:t===se.ProductActionType.Unknown?se.EventType.Unknown:t===se.ProductActionType.ViewDetail?se.CommerceEventType.ProductViewDetail:(e.Logger.error("Could not convert product action type "+t+" to event type"),null)},this.convertPromotionActionToEventType=function(t){return t===se.PromotionActionType.PromotionClick?se.CommerceEventType.PromotionClick:t===se.PromotionActionType.PromotionView?se.CommerceEventType.PromotionView:(e.Logger.error("Could not convert promotion action type "+t+" to event type"),null)},this.generateExpandedEcommerceName=function(e,t){return"eCommerce - "+e+" - "+(t?"Total":"Item")},this.extractProductAttributes=function(e,t){t.CouponCode&&(e["Coupon Code"]=t.CouponCode),t.Brand&&(e.Brand=t.Brand),t.Category&&(e.Category=t.Category),t.Name&&(e.Name=t.Name),t.Sku&&(e.Id=t.Sku),t.Price&&(e["Item Price"]=t.Price),t.Quantity&&(e.Quantity=t.Quantity),t.Position&&(e.Position=t.Position),t.Variant&&(e.Variant=t.Variant),e["Total Product Amount"]=t.TotalAmount||0},this.extractTransactionId=function(e,t){t.TransactionId&&(e["Transaction Id"]=t.TransactionId)},this.extractActionAttributes=function(e,r){t.extractTransactionId(e,r),r.Affiliation&&(e.Affiliation=r.Affiliation),r.CouponCode&&(e["Coupon Code"]=r.CouponCode),r.TotalAmount&&(e["Total Amount"]=r.TotalAmount),r.ShippingAmount&&(e["Shipping Amount"]=r.ShippingAmount),r.TaxAmount&&(e["Tax Amount"]=r.TaxAmount),r.CheckoutOptions&&(e["Checkout Options"]=r.CheckoutOptions),r.CheckoutStep&&(e["Checkout Step"]=r.CheckoutStep)},this.extractPromotionAttributes=function(e,t){t.Id&&(e.Id=t.Id),t.Creative&&(e.Creative=t.Creative),t.Name&&(e.Name=t.Name),t.Position&&(e.Position=t.Position)},this.buildProductList=function(e,t){return t?Array.isArray(t)?t:[t]:e.ShoppingCart.ProductList},this.createProduct=function(t,r,n,o,i,s,a,c,u,d){return d=e._Helpers.sanitizeAttributes(d,t),"string"!=typeof t?(e.Logger.error("Name is required when creating a product"),null):e._Helpers.Validators.isStringOrNumber(r)?e._Helpers.Validators.isStringOrNumber(n)?(n=e._Helpers.parseNumber(n),c&&!e._Helpers.Validators.isNumber(c)&&(e.Logger.error("Position must be a number, it will be set to null."),c=null),{Name:t,Sku:r,Price:n,Quantity:o=e._Helpers.Validators.isStringOrNumber(o)?e._Helpers.parseNumber(o):1,Brand:a,Variant:i,Category:s,Position:c,CouponCode:u,TotalAmount:o*n,Attributes:d}):(e.Logger.error("Price is required when creating a product, and must be a string or a number"),null):(e.Logger.error("SKU is required when creating a product, and must be a string or a number"),null)},this.createPromotion=function(t,r,n,o){return e._Helpers.Validators.isStringOrNumber(t)?{Id:t,Creative:r,Name:n,Position:o}:(e.Logger.error(gt.ErrorMessages.PromotionIdRequired),null)},this.createImpression=function(t,r){return"string"==typeof t?r?{Name:t,Product:r}:(e.Logger.error("Product is required when creating an impression."),null):(e.Logger.error("Name is required when creating an impression."),null)},this.createTransactionAttributes=function(t,r,n,o,i,s){return e._Helpers.Validators.isStringOrNumber(t)?{Id:t,Affiliation:r,CouponCode:n,Revenue:o,Shipping:i,Tax:s}:(e.Logger.error(gt.ErrorMessages.TransactionIdRequired),null)},this.expandProductImpression=function(r){var n=[];return r.ProductImpressions?(r.ProductImpressions.forEach((function(o){o.ProductList&&o.ProductList.forEach((function(i){var s=e._Helpers.extend(!1,{},r.EventAttributes);if(i.Attributes)for(var a in i.Attributes)s[a]=i.Attributes[a];t.extractProductAttributes(s,i),o.ProductImpressionList&&(s["Product Impression List"]=o.ProductImpressionList);var c=e._ServerModel.createEventObject({messageType:se.MessageType.PageEvent,name:t.generateExpandedEcommerceName("Impression"),data:s,eventType:se.EventType.Transaction});n.push(c)}))})),n):n},this.expandCommerceEvent=function(e){return e?t.expandProductAction(e).concat(t.expandPromotionAction(e)).concat(t.expandProductImpression(e)):null},this.expandPromotionAction=function(r){var n=[];return r.PromotionAction?(r.PromotionAction.PromotionList.forEach((function(o){var i=e._Helpers.extend(!1,{},r.EventAttributes);t.extractPromotionAttributes(i,o);var s=e._ServerModel.createEventObject({messageType:se.MessageType.PageEvent,name:t.generateExpandedEcommerceName(se.PromotionActionType.getExpansionName(r.PromotionAction.PromotionActionType)),data:i,eventType:se.EventType.Transaction});n.push(s)})),n):n},this.expandProductAction=function(r){var n=[];if(!r.ProductAction)return n;var o=!1;if(r.ProductAction.ProductActionType===se.ProductActionType.Purchase||r.ProductAction.ProductActionType===se.ProductActionType.Refund){var i=e._Helpers.extend(!1,{},r.EventAttributes);i["Product Count"]=r.ProductAction.ProductList?r.ProductAction.ProductList.length:0,t.extractActionAttributes(i,r.ProductAction),r.CurrencyCode&&(i["Currency Code"]=r.CurrencyCode);var s=e._ServerModel.createEventObject({messageType:se.MessageType.PageEvent,name:t.generateExpandedEcommerceName(se.ProductActionType.getExpansionName(r.ProductAction.ProductActionType),!0),data:i,eventType:se.EventType.Transaction});n.push(s)}else o=!0;var a=r.ProductAction.ProductList;return a?(a.forEach((function(i){var s=e._Helpers.extend(!1,r.EventAttributes,i.Attributes);o?t.extractActionAttributes(s,r.ProductAction):t.extractTransactionId(s,r.ProductAction),t.extractProductAttributes(s,i);var a=e._ServerModel.createEventObject({messageType:se.MessageType.PageEvent,name:t.generateExpandedEcommerceName(se.ProductActionType.getExpansionName(r.ProductAction.ProductActionType)),data:s,eventType:se.EventType.Transaction});n.push(a)})),n):n},this.createCommerceEventObject=function(t,r){var n,o=e._Helpers.extend;return e.Logger.verbose(gt.InformationMessages.StartingLogCommerceEvent),e._Helpers.canLog()?((n=e._ServerModel.createEventObject({messageType:se.MessageType.Commerce,sourceMessageId:null==r?void 0:r.sourceMessageId})).EventName="eCommerce - ",n.CurrencyCode=e._Store.currencyCode,n.ShoppingCart=[],n.CustomFlags=o(n.CustomFlags,t),n):(e.Logger.verbose(gt.InformationMessages.AbandonLogEvent),null)},this.sanitizeAmount=function(t,r){if(!e._Helpers.Validators.isStringOrNumber(t)){var n=[r,"must be of type number. A",d(t),"was passed. Converting to 0"].join(" ");return e.Logger.warning(n),0}return e._Helpers.parseNumber(t)}}function vt(e,t,r){var n=this,o=t._Helpers,i=o.createMainStorageName,s=o.createProductStorageName,a=t._NativeSdkHelpers.isWebviewEnabled,c={isEnabled:!0,sessionAttributes:{},currentSessionMPIDs:[],consentState:null,sessionId:null,isFirstRun:null,clientId:null,deviceId:null,devToken:null,serverSettings:{},dateLastEventSent:null,sessionStartDate:null,currentPosition:null,isTracking:!1,watchPositionId:null,cartProducts:[],eventQueue:[],currencyCode:null,globalTimer:null,context:null,configurationLoaded:!1,identityCallInFlight:!1,SDKConfig:{},nonCurrentUserMPIDs:{},identifyCalled:!1,isLoggedIn:!1,cookieSyncDates:{},integrationAttributes:{},requireDelay:!0,isLocalStorageAvailable:null,storageName:null,prodStorageName:null,activeForwarders:[],kits:{},sideloadedKits:[],configuredForwarders:[],pixelConfigurations:[],wrapperSDKInfo:{name:"none",version:null,isInfoSet:!1},persistenceData:{gs:{}}};for(var u in c)this[u]=c[u];if(this.devToken=r||null,this.integrationDelayTimeoutStart=Date.now(),this.SDKConfig=function(e){var t={};for(var r in S.DefaultConfig)S.DefaultConfig.hasOwnProperty(r)&&(t[r]=S.DefaultConfig[r]);if(e)for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);for(var r in S.DefaultBaseUrls)t[r]=S.DefaultBaseUrls[r];return t}(e),e){e.hasOwnProperty("flags")||(this.SDKConfig.flags={}),this.SDKConfig.flags=ft(e),e.deviceId&&(this.deviceId=e.deviceId),this.SDKConfig.isDevelopmentMode=!!e.hasOwnProperty("isDevelopmentMode")&&x(e.isDevelopmentMode);var l=mt(e,this.SDKConfig.flags,r);for(var g in l)this.SDKConfig[g]=l[g];if(e.hasOwnProperty("logLevel")&&(this.SDKConfig.logLevel=e.logLevel),this.SDKConfig.useNativeSdk=!!e.useNativeSdk,this.SDKConfig.kits=e.kits||{},this.SDKConfig.sideloadedKits=e.sideloadedKits||[],this.SDKConfig.isIOS=e.hasOwnProperty("isIOS")?e.isIOS:!(!window.mParticle||!window.mParticle.isIOS)&&window.mParticle.isIOS,this.SDKConfig.useCookieStorage=!!e.hasOwnProperty("useCookieStorage")&&e.useCookieStorage,this.SDKConfig.maxProducts=e.hasOwnProperty("maxProducts")?e.maxProducts:S.DefaultConfig.maxProducts,this.SDKConfig.maxCookieSize=e.hasOwnProperty("maxCookieSize")?e.maxCookieSize:S.DefaultConfig.maxCookieSize,e.hasOwnProperty("appName")&&(this.SDKConfig.appName=e.appName),e.hasOwnProperty("package")&&(this.SDKConfig.package=e.package),this.SDKConfig.integrationDelayTimeout=e.hasOwnProperty("integrationDelayTimeout")?e.integrationDelayTimeout:S.DefaultConfig.integrationDelayTimeout,e.hasOwnProperty("identifyRequest")&&(this.SDKConfig.identifyRequest=e.identifyRequest),e.hasOwnProperty("identityCallback")){var p=e.identityCallback;t._Helpers.Validators.isFunction(p)?this.SDKConfig.identityCallback=e.identityCallback:t.Logger.warning("The optional callback must be a function. You tried entering a(n) "+d(p)+" . Callback not set. Please set your callback again.")}if(e.hasOwnProperty("appVersion")&&(this.SDKConfig.appVersion=e.appVersion),e.hasOwnProperty("appName")&&(this.SDKConfig.appName=e.appName),e.hasOwnProperty("sessionTimeout")&&(this.SDKConfig.sessionTimeout=e.sessionTimeout),e.hasOwnProperty("dataPlan")){this.SDKConfig.dataPlan={PlanVersion:null,PlanId:null};var v=e.dataPlan;v.planId&&(W(v.planId)?this.SDKConfig.dataPlan.PlanId=v.planId:t.Logger.error("Your data plan id must be a string and match the data plan slug format (i.e. under_case_slug)")),v.planVersion&&(j(v.planVersion)?this.SDKConfig.dataPlan.PlanVersion=v.planVersion:t.Logger.error("Your data plan version must be a number"))}else this.SDKConfig.dataPlan={};if(this.SDKConfig.forceHttps=!e.hasOwnProperty("forceHttps")||e.forceHttps,this.SDKConfig.customFlags=e.customFlags||{},this.SDKConfig.minWebviewBridgeVersion=e.hasOwnProperty("minWebviewBridgeVersion")?e.minWebviewBridgeVersion:1,this.SDKConfig.aliasMaxWindow=e.hasOwnProperty("aliasMaxWindow")?e.aliasMaxWindow:S.DefaultConfig.aliasMaxWindow,e.hasOwnProperty("dataPlanOptions")){var f=e.dataPlanOptions;f.hasOwnProperty("dataPlanVersion")&&f.hasOwnProperty("blockUserAttributes")&&f.hasOwnProperty("blockEventAttributes")&&f.hasOwnProperty("blockEvents")&&f.hasOwnProperty("blockUserIdentities")||t.Logger.error('Ensure your config.dataPlanOptions object has the following keys: a "dataPlanVersion" object, and "blockUserAttributes", "blockEventAttributes", "blockEvents", "blockUserIdentities" booleans')}e.hasOwnProperty("onCreateBatch")&&("function"==typeof e.onCreateBatch?this.SDKConfig.onCreateBatch=e.onCreateBatch:(t.Logger.error("config.onCreateBatch must be a function"),this.SDKConfig.onCreateBatch=void 0))}this._getFromPersistence=function(e,t){return e?(n.syncPersistenceData(),n.persistenceData&&n.persistenceData[e]&&n.persistenceData[e][t]?n.persistenceData[e][t]:null):null},this._setPersistence=function(e,r,o){var i;e&&(n.syncPersistenceData(),n.persistenceData&&(n.persistenceData[e]?n.persistenceData[e][r]=o:n.persistenceData[e]=((i={})[r]=o,i),O(n.persistenceData[e][r])&&J(n.persistenceData[e][r])&&delete n.persistenceData[e][r],t._Persistence.savePersistence(n.persistenceData)))},this.hasInvalidIdentifyRequest=function(){var e=n.SDKConfig.identifyRequest;return O(e)&&O(e.userIdentities)&&J(e.userIdentities)||!e},this.getConsentState=function(e){var r=t._Consent.ConsentSerialization.fromMinifiedJsonObject,o=n._getFromPersistence(e,"con");return J(o)?null:r(o)},this.setConsentState=function(e,r){var o=t._Consent.ConsentSerialization.toMinifiedJsonObject;(r||null===r)&&n._setPersistence(e,"con",o(r))},this.getDeviceId=function(){return n.deviceId},this.setDeviceId=function(e){n.deviceId=e,n.persistenceData.gs.das=e,t._Persistence.update()},this.getFirstSeenTime=function(e){return n._getFromPersistence(e,"fst")},this.setFirstSeenTime=function(e,t){if(e){var r=t||(new Date).getTime();n._setPersistence(e,"fst",r)}},this.getLastSeenTime=function(e){if(!e)return null;var r=t.Identity.getCurrentUser();return e===(null==r?void 0:r.getMPID())?(new Date).getTime():n._getFromPersistence(e,"lst")},this.setLastSeenTime=function(e,t){if(e){var r=t||(new Date).getTime();n._setPersistence(e,"lst",r)}},this.syncPersistenceData=function(){var e=t._Persistence.getPersistence();n.persistenceData=t._Helpers.extend({},n.persistenceData,e)},this.getUserAttributes=function(e){return n._getFromPersistence(e,"ua")||{}},this.setUserAttributes=function(e,t){return n._setPersistence(e,"ua",t)},this.getUserIdentities=function(e){return n._getFromPersistence(e,"ui")||{}},this.setUserIdentities=function(e,t){n._setPersistence(e,"ui",t)},this.addMpidToSessionHistory=function(e,t){var r=n.currentSessionMPIDs.indexOf(e);return e&&t!==e&&0>r?void n.currentSessionMPIDs.push(e):void(0<=r&&(n.currentSessionMPIDs=Q(n.currentSessionMPIDs,r)))},this.nullifySession=function(){n.sessionId=null,n.dateLastEventSent=null,n.sessionAttributes={},t._Persistence.update()},this.processConfig=function(e){var o=e.workspaceToken,c=e.requiredWebviewBridgeName;n.SDKConfig.flags=ft(e);var u=mt(e,n.SDKConfig.flags,r);for(var d in u)n.SDKConfig[d]=u[d];o?n.SDKConfig.workspaceToken=o:t.Logger.warning("You should have a workspaceToken on your config object for security purposes."),n.storageName=i(o),n.prodStorageName=s(o),n.SDKConfig.requiredWebviewBridgeName=c||o,n.webviewBridgeEnabled=a(n.SDKConfig.requiredWebviewBridgeName,n.SDKConfig.minWebviewBridgeVersion),n.configurationLoaded=!0}}function ft(e){var t={},r=S.FeatureFlags,n=r.ReportBatching,o=r.EventBatchingIntervalMillis,i=r.OfflineStorage,s=r.DirectUrlRouting,a=r.CacheIdentity,c=r.AudienceAPI,u=r.CaptureIntegrationSpecificIds;return e.flags?(t[n]=e.flags[n]||!1,t[o]=U(e.flags[o])||S.DefaultConfig.uploadInterval,t[i]=e.flags[i]||"0",t[s]="True"===e.flags[s],t[a]="True"===e.flags[a],t[c]="True"===e.flags[c],t[u]="True"===e.flags[u],t):{}}function mt(e,t,r){return r?t.directURLRouting?function(e,t){var r=S.DefaultBaseUrls,n={},o=t.split("-"),i=1>=o.length?"us1":o[0];for(var s in r)if("configUrl"!=s)if(e.hasOwnProperty(s))n[s]=e[s];else{var a=r[s].split(".");n[s]=y([a[0],i],a.slice(1),!0).join(".")}else n[s]=e[s]||r[s];return n}(e,r):function(e){var t=S.DefaultBaseUrls,r={};for(var n in t)r[n]=e[n]||t[n];return r}(e):{}}function ht(e){var t=this,r=e.logLevel||"warning";this.logger=e.hasOwnProperty("logger")?e.logger:new yt,this.verbose=function(e){"none"!==r&&t.logger.verbose&&"verbose"===r&&t.logger.verbose(e)},this.warning=function(e){"none"!==r&&t.logger.warning&&("verbose"===r||"warning"===r)&&t.logger.warning(e)},this.error=function(e){"none"!==r&&t.logger.error&&t.logger.error(e)},this.setLogLevel=function(e){r=e}}function yt(){this.verbose=function(e){console&&console.info&&console.info(e)},this.error=function(e){console&&console.error&&console.error(e)},this.warning=function(e){console&&console.warn&&console.warn(e)}}var St=u.Base64,bt=S.Messages,_t=S.Base64CookieKeys,It=S.SDKv2NonMPIDCookieKeys,Pt=S.StorageNames;function Ct(e){function t(t){var r=e._Store;return t.gs.sid=r.sessionId,t.gs.ie=r.isEnabled,t.gs.sa=r.sessionAttributes,t.gs.ss=r.serverSettings,t.gs.dt=r.devToken,t.gs.les=r.dateLastEventSent?r.dateLastEventSent.getTime():null,t.gs.av=r.SDKConfig.appVersion,t.gs.cgid=r.clientId,t.gs.das=r.deviceId,t.gs.c=r.context,t.gs.ssd=r.sessionStartDate?r.sessionStartDate.getTime():0,t.gs.ia=r.integrationAttributes,t}function r(e){localStorage.removeItem(e)}function n(e,t,r){return o.encodePersistence(JSON.stringify(e))+";expires="+t+";path=/"+r}var o=this;this.useLocalStorage=function(){return!e._Store.SDKConfig.useCookieStorage&&e._Store.isLocalStorageAvailable},this.initializeStorage=function(){try{var t,r,n=o.getLocalStorage(),i=o.getCookie();n||i?e._Store.isFirstRun=!1:(e._Store.isFirstRun=!0,e._Store.mpid=0),e._Store.isLocalStorageAvailable||(e._Store.SDKConfig.useCookieStorage=!0),e._Store.isLocalStorageAvailable?(t=window.localStorage,e._Store.SDKConfig.useCookieStorage?(n?(r=i?e._Helpers.extend(!1,n,i):n,t.removeItem(e._Store.storageName)):i&&(r=i),o.storeDataInMemory(r)):i?(r=n?e._Helpers.extend(!1,n,i):i,o.storeDataInMemory(r),o.expireCookies(e._Store.storageName)):o.storeDataInMemory(n)):o.storeDataInMemory(i);try{if(e._Store.isLocalStorageAvailable){var s=localStorage.getItem(e._Store.prodStorageName);if(s)var a=JSON.parse(St.decode(s));e._Store.mpid&&o.storeProductsInMemory(a,e._Store.mpid)}}catch(t){e._Store.isLocalStorageAvailable&&localStorage.removeItem(e._Store.prodStorageName),e._Store.cartProducts=[],e.Logger.error("Error loading products in initialization: "+t)}for(var c in r)r.hasOwnProperty(c)&&(It[c]||(e._Store.nonCurrentUserMPIDs[c]=r[c]));o.update()}catch(t){o.useLocalStorage()&&e._Store.isLocalStorageAvailable?localStorage.removeItem(e._Store.storageName):o.expireCookies(e._Store.storageName),e.Logger.error("Error initializing storage: "+t)}},this.update=function(){e._Store.webviewBridgeEnabled||(e._Store.SDKConfig.useCookieStorage&&o.setCookie(),o.setLocalStorage())},this.storeProductsInMemory=function(t,r){if(t)try{e._Store.cartProducts=t[r]&&t[r].cp?t[r].cp:[]}catch(t){e.Logger.error(bt.ErrorMessages.CookieParseError)}},this.storeDataInMemory=function(t,r){try{t?(e._Store.mpid=r||(t.cu||0),t.gs=t.gs||{},e._Store.sessionId=t.gs.sid||e._Store.sessionId,e._Store.isEnabled=void 0===t.gs.ie?e._Store.isEnabled:t.gs.ie,e._Store.sessionAttributes=t.gs.sa||e._Store.sessionAttributes,e._Store.serverSettings=t.gs.ss||e._Store.serverSettings,e._Store.devToken=e._Store.devToken||t.gs.dt,e._Store.SDKConfig.appVersion=e._Store.SDKConfig.appVersion||t.gs.av,e._Store.clientId=t.gs.cgid||e._Store.clientId||e._Helpers.generateUniqueId(),e._Store.deviceId=e._Store.deviceId||t.gs.das||e._Helpers.generateUniqueId(),e._Store.integrationAttributes=t.gs.ia||{},e._Store.context=t.gs.c||e._Store.context,e._Store.currentSessionMPIDs=t.gs.csm||e._Store.currentSessionMPIDs,e._Store.isLoggedIn=!0===t.l,t.gs.les&&(e._Store.dateLastEventSent=new Date(t.gs.les)),e._Store.sessionStartDate=t.gs.ssd?new Date(t.gs.ssd):new Date,t=r?t[r]:t[t.cu]):(e.Logger.verbose(bt.InformationMessages.CookieNotFound),e._Store.clientId=e._Store.clientId||e._Helpers.generateUniqueId(),e._Store.deviceId=e._Store.deviceId||e._Helpers.generateUniqueId())}catch(t){e.Logger.error(bt.ErrorMessages.CookieParseError)}},this.determineLocalStorageAvailability=function(e){var t;window.mParticle&&window.mParticle._forceNoLocalStorage&&(e=void 0);try{return e.setItem("mparticle","test"),t="test"===e.getItem("mparticle"),e.removeItem("mparticle"),t&&e}catch(e){return!1}},this.getUserProductsFromLS=function(t){if(!e._Store.isLocalStorageAvailable)return[];var r,n,o=localStorage.getItem(e._Store.prodStorageName);if(o&&(r=St.decode(o)),!t)return[];try{return r&&(n=JSON.parse(r)),r&&n[t]&&n[t].cp&&Array.isArray(n[t].cp)?n[t].cp:[]}catch(e){return[]}},this.getAllUserProductsFromLS=function(){var t,r,n=localStorage.getItem(e._Store.prodStorageName);n&&(t=St.decode(n));try{r=JSON.parse(t)}catch(e){r={}}return r},this.setLocalStorage=function(){if(e._Store.isLocalStorageAvailable){var r=e._Store.storageName,n=o.getAllUserProductsFromLS(),i=o.getLocalStorage()||{},s=e.Identity.getCurrentUser(),a=s?s.getMPID():null,c={cp:n[a]?n[a].cp:[]};if(a){(n=n||{})[a]=c;try{window.localStorage.setItem(encodeURIComponent(e._Store.prodStorageName),St.encode(JSON.stringify(n)))}catch(t){e.Logger.error("Error with setting products on localStorage.")}}if(!e._Store.SDKConfig.useCookieStorage){i.gs=i.gs||{},i.l=e._Store.isLoggedIn?1:0,e._Store.sessionId&&(i.gs.csm=e._Store.currentSessionMPIDs),i.gs.ie=e._Store.isEnabled,a&&(i.cu=a),Object.keys(e._Store.nonCurrentUserMPIDs).length&&(i=e._Helpers.extend({},i,e._Store.nonCurrentUserMPIDs),e._Store.nonCurrentUserMPIDs={}),i=t(i);try{window.localStorage.setItem(encodeURIComponent(r),o.encodePersistence(JSON.stringify(i)))}catch(t){e.Logger.error("Error with setting localStorage item.")}}}},this.getLocalStorage=function(){if(!e._Store.isLocalStorageAvailable)return null;var t,r=e._Store.storageName,n=o.decodePersistence(window.localStorage.getItem(r)),i={};if(n)for(t in n=JSON.parse(n))n.hasOwnProperty(t)&&(i[t]=n[t]);return Object.keys(i).length?i:null},this.expireCookies=function(e){var t,r,n,i=new Date;r=""===(n=o.getCookieDomain())?"":";domain="+n,i.setTime(i.getTime()-864e5),t="; expires="+i.toUTCString(),document.cookie=e+"="+t+"; path=/"+r},this.getCookie=function(){var t,r,n,i,s,a=window.document.cookie.split("; "),c=e._Store.storageName,u=c?void 0:{};for(e.Logger.verbose(bt.InformationMessages.CookieSearch),t=0,r=a.length;t<r;t++){try{i=(n=a[t].split("=")).shift(),s=n.join("=")}catch(t){e.Logger.verbose("Unable to parse cookie: "+i+". Skipping.")}if(c&&c===i){u=e._Helpers.converted(s);break}c||(u[i]=e._Helpers.converted(s))}return u?(e.Logger.verbose(bt.InformationMessages.CookieFound),JSON.parse(o.decodePersistence(u))):null},this.setCookie=function(){var r,n=e.Identity.getCurrentUser();n&&(r=n.getMPID());var i,s,a,c=new Date,u=e._Store.storageName,d=o.getCookie()||{},l=new Date(c.getTime()+24*e._Store.SDKConfig.cookieExpiration*60*60*1e3).toGMTString();s=""===(i=o.getCookieDomain())?"":";domain="+i,d.gs=d.gs||{},e._Store.sessionId&&(d.gs.csm=e._Store.currentSessionMPIDs),r&&(d.cu=r),d.l=e._Store.isLoggedIn?1:0,d=t(d),Object.keys(e._Store.nonCurrentUserMPIDs).length&&(d=e._Helpers.extend({},d,e._Store.nonCurrentUserMPIDs),e._Store.nonCurrentUserMPIDs={}),a=o.reduceAndEncodePersistence(d,l,s,e._Store.SDKConfig.maxCookieSize),e.Logger.verbose(bt.InformationMessages.CookieSet),window.document.cookie=encodeURIComponent(u)+"="+a},this.reduceAndEncodePersistence=function(t,r,o,i){var s,a=t.gs.csm?t.gs.csm:[];if(a.length){var c={};for(var u in t)t.hasOwnProperty(u)&&(It[u]||u===t.cu||(c[u]=1));if(Object.keys(c).length)for(var d in c)(s=n(t,r,o)).length>i&&c.hasOwnProperty(d)&&-1===a.indexOf(d)&&delete t[d];for(var l,g=0;g<a.length&&(s=n(t,r,o)).length>i;g++)t[l=a[g]]?(e.Logger.verbose("Size of new encoded cookie is larger than maxCookieSize setting of "+i+". Removing from cookie the earliest logged in MPID containing: "+JSON.stringify(t[l],0,2)),delete t[l]):e.Logger.error("Unable to save MPID data to cookies because the resulting encoded cookie is larger than the maxCookieSize setting of "+i+". We recommend using a maxCookieSize of 1500.")}else for(var p in t)t.hasOwnProperty(p)&&((s=n(t,r,o)).length>i&&!It[p]&&p!==t.cu&&delete t[p]);return s},this.findPrevCookiesBasedOnUI=function(t){var r,n=e._Persistence.getPersistence();if(t)for(var i in t.userIdentities)if(n&&Object.keys(n).length)for(var s in n)if(n[s].mpid){var a=n[s].ui;for(var c in a)if(i===c&&t.userIdentities[i]===a[c]){r=s;break}}r&&o.storeDataInMemory(n,r)},this.encodePersistence=function(t){for(var r in(t=JSON.parse(t)).gs)t.gs.hasOwnProperty(r)&&(_t[r]?t.gs[r]&&(Array.isArray(t.gs[r])&&t.gs[r].length||e._Helpers.isObject(t.gs[r])&&Object.keys(t.gs[r]).length)?t.gs[r]=St.encode(JSON.stringify(t.gs[r])):delete t.gs[r]:"ie"===r?t.gs[r]=t.gs[r]?1:0:!t.gs[r]&&delete t.gs[r]);for(var n in t)if(t.hasOwnProperty(n)&&!It[n])for(r in t[n])t[n].hasOwnProperty(r)&&_t[r]&&(e._Helpers.isObject(t[n][r])&&Object.keys(t[n][r]).length?t[n][r]=St.encode(JSON.stringify(t[n][r])):delete t[n][r]);return P(JSON.stringify(t))},this.decodePersistence=function(t){try{if(t){if(t=JSON.parse(C(t)),e._Helpers.isObject(t)&&Object.keys(t).length){for(var r in t.gs)t.gs.hasOwnProperty(r)&&(_t[r]?t.gs[r]=JSON.parse(St.decode(t.gs[r])):"ie"===r&&(t.gs[r]=!!t.gs[r]));for(var n in t)if(t.hasOwnProperty(n))if(It[n])"l"===n&&(t[n]=!!t[n]);else for(r in t[n])t[n].hasOwnProperty(r)&&_t[r]&&t[n][r].length&&(t[n][r]=JSON.parse(St.decode(t[n][r])))}return JSON.stringify(t)}}catch(t){e.Logger.error("Problem with decoding cookie",t)}},this.getCookieDomain=function(){if(e._Store.SDKConfig.cookieDomain)return e._Store.SDKConfig.cookieDomain;var t=o.getDomain(document,location.hostname);return""===t?"":"."+t},this.getDomain=function(e,t){var r,n,o=t.split(".");for(r=o.length-1;0<=r;r--)if(n=o.slice(r).join("."),e.cookie="mptest=cookie;domain=."+n+";",-1<e.cookie.indexOf("mptest=cookie"))return e.cookie="mptest=;domain=."+n+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",n;return""},this.getCartProducts=function(t){var r,n=localStorage.getItem(e._Store.prodStorageName);return n&&((r=JSON.parse(St.decode(n)))&&r[t]&&r[t].cp)?r[t].cp:[]},this.setCartProducts=function(t){if(e._Store.isLocalStorageAvailable)try{window.localStorage.setItem(encodeURIComponent(e._Store.prodStorageName),St.encode(JSON.stringify(t)))}catch(t){e.Logger.error("Error with setting products on localStorage.")}},this.saveUserCookieSyncDatesToPersistence=function(e,t){if(t){var r=o.getPersistence();r&&(r[e]?r[e].csd=t:r[e]={csd:t}),o.savePersistence(r)}},this.swapCurrentUser=function(e,t,r){if(e&&t&&e!==t){var n=o.getPersistence();n&&(n.cu=t,n.gs.csm=r,o.savePersistence(n))}},this.savePersistence=function(t){var r,n=o.encodePersistence(JSON.stringify(t)),i=new Date,s=e._Store.storageName,a=new Date(i.getTime()+24*e._Store.SDKConfig.cookieExpiration*60*60*1e3).toGMTString(),c=o.getCookieDomain();if(r=""===c?"":";domain="+c,e._Store.SDKConfig.useCookieStorage){var u=o.reduceAndEncodePersistence(t,a,r,e._Store.SDKConfig.maxCookieSize);window.document.cookie=encodeURIComponent(s)+"="+u}else e._Store.isLocalStorageAvailable&&localStorage.setItem(e._Store.storageName,n)},this.getPersistence=function(){return this.useLocalStorage()?this.getLocalStorage():this.getCookie()},this.getFirstSeenTime=function(e){if(!e)return null;var t=o.getPersistence();return t&&t[e]&&t[e].fst?t[e].fst:null},this.setFirstSeenTime=function(e,t){if(e){t||(t=(new Date).getTime());var r=o.getPersistence();r&&(!r[e]&&(r[e]={}),!r[e].fst&&(r[e].fst=t,o.savePersistence(r)))}},this.getLastSeenTime=function(t){if(!t)return null;if(t===e.Identity.getCurrentUser().getMPID())return(new Date).getTime();var r=o.getPersistence();return r&&r[t]&&r[t].lst?r[t].lst:null},this.setLastSeenTime=function(e,t){if(e){t||(t=(new Date).getTime());var r=o.getPersistence();r&&r[e]&&(r[e].lst=t,o.savePersistence(r))}},this.getDeviceId=function(){return e._Store.deviceId},this.setDeviceId=function(t){e._Store.deviceId=t,o.update()},this.resetPersistence=function(){r(Pt.localStorageName),r(Pt.localStorageNameV3),r(Pt.localStorageNameV4),r(e._Store.prodStorageName),r(e._Store.storageName),r(Pt.localStorageProductsV4),o.expireCookies(Pt.cookieName),o.expireCookies(Pt.cookieNameV2),o.expireCookies(Pt.cookieNameV3),o.expireCookies(Pt.cookieNameV4),o.expireCookies(e._Store.prodStorageName),o.expireCookies(e._Store.storageName),mParticle._isTestEnv&&(r(e._Helpers.createMainStorageName("abcdef")),o.expireCookies(e._Helpers.createMainStorageName("abcdef")),r(e._Helpers.createProductStorageName("abcdef")))},this.forwardingStatsBatches={uploadsTable:{},forwardingStatsEventQueue:[]}}var wt=S.Messages;function At(e){var t=this;this.logEvent=function(t,r){if(e.Logger.verbose(wt.InformationMessages.StartingLogEvent+": "+t.name),e._Helpers.canLog()){var n=e._ServerModel.createEventObject(t);e._APIClient.sendEventToServer(n,r)}else e.Logger.verbose(wt.InformationMessages.AbandonLogEvent)},this.startTracking=function(t){function r(t,r){if(t)try{r?t(r):t()}catch(t){e.Logger.error("Error invoking the callback passed to startTrackingLocation."),e.Logger.error(t)}}if(e._Store.isTracking){var n={coords:{latitude:e._Store.currentPosition.lat,longitude:e._Store.currentPosition.lng}};r(t,n)}else"geolocation"in navigator&&(e._Store.watchPositionId=navigator.geolocation.watchPosition((function(n){e._Store.currentPosition={lat:n.coords.latitude,lng:n.coords.longitude},r(t,n),t=null,e._Store.isTracking=!0}),(function(){r(t),t=null,e._Store.isTracking=!1})))},this.stopTracking=function(){e._Store.isTracking&&(navigator.geolocation.clearWatch(e._Store.watchPositionId),e._Store.currentPosition=null,e._Store.isTracking=!1)},this.logOptOut=function(){e.Logger.verbose(wt.InformationMessages.StartingLogOptOut);var t=e._ServerModel.createEventObject({messageType:se.MessageType.OptOut,eventType:se.EventType.Other});e._APIClient.sendEventToServer(t)},this.logAST=function(){t.logEvent({messageType:se.MessageType.AppStateTransition})},this.logCheckoutEvent=function(r,n,o,i){var s=e._Ecommerce.createCommerceEventObject(i);s&&(s.EventName+=e._Ecommerce.getProductActionEventName(se.ProductActionType.Checkout),s.EventCategory=se.CommerceEventType.ProductCheckout,s.ProductAction={ProductActionType:se.ProductActionType.Checkout,CheckoutStep:r,CheckoutOptions:n,ProductList:[]},t.logCommerceEvent(s,o))},this.logProductActionEvent=function(r,n,o,i,s,a){var c=e._Ecommerce.createCommerceEventObject(i,a),u=Array.isArray(n)?n:[n];u.forEach((function(t){t.TotalAmount&&(t.TotalAmount=e._Ecommerce.sanitizeAmount(t.TotalAmount,"TotalAmount")),t.Position&&(t.Position=e._Ecommerce.sanitizeAmount(t.Position,"Position")),t.Price&&(t.Price=e._Ecommerce.sanitizeAmount(t.Price,"Price")),t.Quantity&&(t.Quantity=e._Ecommerce.sanitizeAmount(t.Quantity,"Quantity"))})),c&&(c.EventCategory=e._Ecommerce.convertProductActionToEventType(r),c.EventName+=e._Ecommerce.getProductActionEventName(r),c.ProductAction={ProductActionType:r,ProductList:u},e._Helpers.isObject(s)&&e._Ecommerce.convertTransactionAttributesToProductAction(s,c.ProductAction),t.logCommerceEvent(c,o,a))},this.logPurchaseEvent=function(r,n,o,i){var s=e._Ecommerce.createCommerceEventObject(i);s&&(s.EventName+=e._Ecommerce.getProductActionEventName(se.ProductActionType.Purchase),s.EventCategory=se.CommerceEventType.ProductPurchase,s.ProductAction={ProductActionType:se.ProductActionType.Purchase},s.ProductAction.ProductList=e._Ecommerce.buildProductList(s,n),e._Ecommerce.convertTransactionAttributesToProductAction(r,s.ProductAction),t.logCommerceEvent(s,o))},this.logRefundEvent=function(r,n,o,i){if(r){var s=e._Ecommerce.createCommerceEventObject(i);s&&(s.EventName+=e._Ecommerce.getProductActionEventName(se.ProductActionType.Refund),s.EventCategory=se.CommerceEventType.ProductRefund,s.ProductAction={ProductActionType:se.ProductActionType.Refund},s.ProductAction.ProductList=e._Ecommerce.buildProductList(s,n),e._Ecommerce.convertTransactionAttributesToProductAction(r,s.ProductAction),t.logCommerceEvent(s,o))}else e.Logger.error(wt.ErrorMessages.TransactionRequired)},this.logPromotionEvent=function(r,n,o,i,s){var a=e._Ecommerce.createCommerceEventObject(i);a&&(a.EventName+=e._Ecommerce.getPromotionActionEventName(r),a.EventCategory=e._Ecommerce.convertPromotionActionToEventType(r),a.PromotionAction={PromotionActionType:r,PromotionList:Array.isArray(n)?n:[n]},t.logCommerceEvent(a,o,s))},this.logImpressionEvent=function(r,n,o,i){var s=e._Ecommerce.createCommerceEventObject(o);s&&(s.EventName+="Impression",s.EventCategory=se.CommerceEventType.ProductImpression,!Array.isArray(r)&&(r=[r]),s.ProductImpressions=[],r.forEach((function(e){s.ProductImpressions.push({ProductImpressionList:e.Name,ProductList:Array.isArray(e.Product)?e.Product:[e.Product]})})),t.logCommerceEvent(s,n,i))},this.logCommerceEvent=function(t,r,n){return e.Logger.verbose(wt.InformationMessages.StartingLogCommerceEvent),t.ProductAction&&null===t.EventCategory?void e.Logger.error("Commerce event not sent.  The mParticle.ProductActionType you passed was invalid. Re-check your code."):(r=e._Helpers.sanitizeAttributes(r,t.EventName),void(e._Helpers.canLog()?(e._Store.webviewBridgeEnabled&&(t.ShoppingCart={}),r&&(t.EventAttributes=r),e._APIClient.sendEventToServer(t,n),e._Persistence.update()):e.Logger.verbose(wt.InformationMessages.AbandonLogEvent)))},this.addEventHandler=function(r,n,o,i,s){var a,c,u=[],d=function(r){e.Logger.verbose("DOM event triggered, handling event"),t.logEvent({messageType:se.MessageType.PageEvent,name:"function"==typeof o?o(a):o,data:"function"==typeof i?i(a):i,eventType:s||se.EventType.Other}),(a.href&&"_blank"!==a.target||a.submit)&&(r.preventDefault?r.preventDefault():r.returnValue=!1,setTimeout((function(){a.href?window.location.href=a.href:a.submit&&a.submit()}),e._Store.SDKConfig.timeout))};if(n)if("string"==typeof n?u=document.querySelectorAll(n):n.nodeType&&(u=[n]),u.length)for(e.Logger.verbose("Found "+u.length+" element"+(1<u.length?"s":"")+", attaching event handlers"),c=0;c<u.length;c++)(a=u[c]).addEventListener?a.addEventListener(r,d,!1):a.attachEvent?a.attachEvent("on"+r,d):a["on"+r]=d;else e.Logger.verbose("No elements found");else e.Logger.error("Can't bind event, selector is required")}}function Et(e,t,r,n,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,o)}function Tt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function s(e){Et(i,n,o,s,a,"next",e)}function a(e){Et(i,n,o,s,a,"throw",e)}s(void 0)}))}}var kt={exports:{}},Dt={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(Dt);var Ot=Dt.exports;!function(e){var t=Ot.default;function r(){e.exports=r=function(){return o},e.exports.__esModule=!0,e.exports.default=e.exports;var n,o={},i=Object.prototype,s=i.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function g(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{g({},"")}catch(n){g=function(e,t,r){return e[t]=r}}function p(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new L(n||[]);return a(i,"_invoke",{value:k(e,r,s)}),i}function v(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=p;var f="suspendedStart",m="suspendedYield",h="executing",y="completed",S={};function b(){}function _(){}function I(){}var P={};g(P,u,(function(){return this}));var C=Object.getPrototypeOf,w=C&&C(C(M([])));w&&w!==i&&s.call(w,u)&&(P=w);var A=I.prototype=b.prototype=Object.create(P);function E(e){["next","throw","return"].forEach((function(t){g(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,r){function n(o,i,a,c){var u=v(e[o],e,i);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==t(l)&&s.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):r.resolve(l).then((function(e){d.value=e,a(d)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,t){function i(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(i,i):i()}})}function k(e,t,r){var o=f;return function(i,s){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw s;return{value:n,done:!0}}for(r.method=i,r.arg=s;;){var a=r.delegate;if(a){var c=D(a,r);if(c){if(c===S)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var u=v(e,t,r);if("normal"===u.type){if(o=r.done?y:m,u.arg===S)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function D(e,t){var r=t.method,o=e.iterator[r];if(o===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,D(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),S;var i=v(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,S;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,S):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,S)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function U(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function M(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(s.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return _.prototype=I,a(A,"constructor",{value:I,configurable:!0}),a(I,"constructor",{value:_,configurable:!0}),_.displayName=g(I,l,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,I):(e.__proto__=I,g(e,l,"GeneratorFunction")),e.prototype=Object.create(A),e},o.awrap=function(e){return{__await:e}},E(T.prototype),g(T.prototype,d,(function(){return this})),o.AsyncIterator=T,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var s=new T(p(e,t,r,n),i);return o.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},E(A),g(A,l,"Generator"),g(A,u,(function(){return this})),g(A,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},o.values=M,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(U),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return a.type="throw",a.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=s.call(i,"catchLoc"),u=s.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,S):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),S},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),U(r),S}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;U(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:M(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),S}},o}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(kt);var Ut=(0,kt.exports)(),Lt=Ut;try{regeneratorRuntime=Ut}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=Ut:Function("r","regeneratorRuntime = r")(Ut)}var Mt=ae(Lt);function Ft(e,t,r,n){var o=this;return{getUserIdentities:function(){var o={},i=r._Store.getUserIdentities(e);for(var s in i)if(i.hasOwnProperty(s)){var a=se.IdentityType.getIdentityName(r._Helpers.parseNumber(s));n&&(!n||n.isIdentityBlocked(a))||(o[a]=i[s])}return{userIdentities:o=r._Helpers.filterUserIdentitiesForForwarders(o,t.userIdentityFilters)}},getMPID:function(){return e},getUserAttributesLists:function(e){var t,i={};for(var s in t=o.getAllUserAttributes())t.hasOwnProperty(s)&&Array.isArray(t[s])&&(n&&(!n||n.isAttributeKeyBlocked(s))||(i[s]=t[s].slice()));return i=r._Helpers.filterUserAttributes(i,e.userAttributeFilters)},getAllUserAttributes:function(){var o={},i=r._Store.getUserAttributes(e);if(i)for(var s in i)i.hasOwnProperty(s)&&(n&&(!n||n.isAttributeKeyBlocked(s))||(Array.isArray(i[s])?o[s]=i[s].slice():o[s]=i[s]));return o=r._Helpers.filterUserAttributes(o,t.userAttributeFilters)}}}var Nt=S.IdentityMethods,Rt=Nt.Modify,xt=Nt.Identify,Vt=Nt.Login,Ht=Nt.Logout;function Kt(e,t){var r=this,n=this;this.forwarderStatsUploader=new $e(e,t).initializeForwarderStatsUploader();var o="setUserAttribute",i="removeUserAttribute";this.initForwarders=function(t,r){var o=e.Identity.getCurrentUser();!e._Store.webviewBridgeEnabled&&e._Store.configuredForwarders&&(e._Store.configuredForwarders.sort((function(e,t){return e.settings.PriorityValue=e.settings.PriorityValue||0,t.settings.PriorityValue=t.settings.PriorityValue||0,-1*(e.settings.PriorityValue-t.settings.PriorityValue)})),e._Store.activeForwarders=e._Store.configuredForwarders.filter((function(i){if(!e._Consent.isEnabledForUserConsent(i.filteringConsentRuleValues,o))return!1;if(!n.isEnabledForUserAttributes(i.filteringUserAttributeValue,o))return!1;if(!n.isEnabledForUnknownUser(i.excludeAnonymousUser,o))return!1;var s=e._Helpers.filterUserIdentities(t,i.userIdentityFilters),a=e._Helpers.filterUserAttributes(o?o.getAllUserAttributes():{},i.userAttributeFilters);return i.initialized||(i.logger=e.Logger,i.init(i.settings,r,!1,null,a,s,e._Store.SDKConfig.appVersion,e._Store.SDKConfig.appName,e._Store.SDKConfig.customFlags,e._Store.clientId),i.initialized=!0),!0})))},this.isEnabledForUserAttributes=function(t,r){if(!t||!e._Helpers.isObject(t)||!Object.keys(t).length)return!0;var n,o,i;if(!r)return!1;i=r.getAllUserAttributes();var s=!1;try{if(i&&e._Helpers.isObject(i)&&Object.keys(i).length)for(var a in i)if(i.hasOwnProperty(a)&&(n=tt.hashAttributeConditionalForwarding(a),o=tt.hashAttributeConditionalForwarding(i[a]),n===t.userAttributeName&&o===t.userAttributeValue)){s=!0;break}return!t||t.includeOnMatch===s}catch(e){return!0}},this.isEnabledForUnknownUser=function(e,t){return!!(t&&t.isLoggedIn()||!e)},this.applyToForwarders=function(t,r){e._Store.activeForwarders.length&&e._Store.activeForwarders.forEach((function(n){if(n[t])try{var o=n[t](r);o&&e.Logger.verbose(o)}catch(t){e.Logger.verbose(t)}}))},this.sendEventToForwarders=function(t){var r,n,o,i=function(t,r){t.UserIdentities&&t.UserIdentities.length&&t.UserIdentities.forEach((function(n,o){e._Helpers.inArray(r,tt.hashUserIdentity(n.Type))&&(t.UserIdentities.splice(o,1),0<o&&o--)}))},s=function(t,r){var n;if(r)for(var o in t.EventAttributes)t.EventAttributes.hasOwnProperty(o)&&(n=tt.hashEventAttributeKey(t.EventCategory,t.EventName,o),e._Helpers.inArray(r,n)&&delete t.EventAttributes[o])},a=function(t,r){return!!(t&&t.length&&e._Helpers.inArray(t,r))},c=[se.MessageType.PageEvent,se.MessageType.PageView,se.MessageType.Commerce];if(!e._Store.webviewBridgeEnabled&&e._Store.activeForwarders){n=tt.hashEventName(t.EventName,t.EventCategory),o=tt.hashEventType(t.EventCategory);for(var u=0;u<e._Store.activeForwarders.length;u++){if(-1<c.indexOf(t.EventDataType)&&e._Store.activeForwarders[u].filteringEventAttributeValue&&e._Store.activeForwarders[u].filteringEventAttributeValue.eventAttributeName&&e._Store.activeForwarders[u].filteringEventAttributeValue.eventAttributeValue){var d=null;if(t.EventAttributes)for(var l in t.EventAttributes){var g;if((g=tt.hashAttributeConditionalForwarding(l))===e._Store.activeForwarders[u].filteringEventAttributeValue.eventAttributeName&&(d={name:g,value:tt.hashAttributeConditionalForwarding(t.EventAttributes[l])}),d)break}var p=null!==d&&d.value===e._Store.activeForwarders[u].filteringEventAttributeValue.eventAttributeValue;if(!(!0===e._Store.activeForwarders[u].filteringEventAttributeValue.includeOnMatch?p:!p))continue}if((r={},r=e._Helpers.extend(!0,r,t),t.EventDataType!==se.MessageType.PageEvent||!a(e._Store.activeForwarders[u].eventNameFilters,n)&&!a(e._Store.activeForwarders[u].eventTypeFilters,o))&&((t.EventDataType!==se.MessageType.Commerce||!a(e._Store.activeForwarders[u].eventTypeFilters,o))&&(t.EventDataType!==se.MessageType.PageView||!a(e._Store.activeForwarders[u].screenNameFilters,n))&&(r.EventAttributes&&(t.EventDataType===se.MessageType.PageEvent?s(r,e._Store.activeForwarders[u].attributeFilters):t.EventDataType===se.MessageType.PageView&&s(r,e._Store.activeForwarders[u].screenAttributeFilters)),i(r,e._Store.activeForwarders[u].userIdentityFilters),r.UserAttributes=e._Helpers.filterUserAttributes(r.UserAttributes,e._Store.activeForwarders[u].userAttributeFilters),e._Store.activeForwarders[u].process))){e.Logger.verbose("Sending message to forwarder: "+e._Store.activeForwarders[u].name);var v=e._Store.activeForwarders[u].process(r);v&&e.Logger.verbose(v)}}}},this.handleForwarderUserAttributes=function(r,n,s){t&&t.isAttributeKeyBlocked(n)||!e._Store.activeForwarders.length||e._Store.activeForwarders.forEach((function(t){if(t[r]&&!e._Helpers.isFilteredUserAttribute(n,t.userAttributeFilters))try{var a;r===o?a=t.setUserAttribute(n,s):r===i&&(a=t.removeUserAttribute(n)),a&&e.Logger.verbose(a)}catch(t){e.Logger.error(t)}}))},this.setForwarderUserIdentities=function(t){e._Store.activeForwarders.forEach((function(r){var n=e._Helpers.filterUserIdentities(t,r.userIdentityFilters);r.setUserIdentity&&n.forEach((function(t){var n=r.setUserIdentity(t.Identity,t.Type);n&&e.Logger.verbose(n)}))}))},this.setForwarderOnUserIdentified=function(r){e._Store.activeForwarders.forEach((function(n){var o=Ft(r.getMPID(),n,e,t);if(n.onUserIdentified){var i=n.onUserIdentified(o);i&&e.Logger.verbose(i)}}))},this.setForwarderOnIdentityComplete=function(r,n){var o;e._Store.activeForwarders.forEach((function(i){var s=Ft(r.getMPID(),i,e,t),a=s.getUserIdentities();n===xt?i.onIdentifyComplete&&((o=i.onIdentifyComplete(s,a))&&e.Logger.verbose(o)):n===Vt?i.onLoginComplete&&((o=i.onLoginComplete(s,a))&&e.Logger.verbose(o)):n===Ht?i.onLogoutComplete&&((o=i.onLogoutComplete(s,a))&&e.Logger.verbose(o)):n===Rt&&i.onModifyComplete&&((o=i.onModifyComplete(s,a))&&e.Logger.verbose(o))}))},this.getForwarderStatsQueue=function(){return e._Persistence.forwardingStatsBatches.forwardingStatsEventQueue},this.setForwarderStatsQueue=function(t){e._Persistence.forwardingStatsBatches.forwardingStatsEventQueue=t},this.processForwarders=function(t,r){t?(this.processUIEnabledKits(t),this.processSideloadedKits(t),n.initForwarders(e._Store.SDKConfig.identifyRequest.userIdentities,r)):e.Logger.warning("No config was passed. Cannot process forwarders")},this.processUIEnabledKits=function(t){var r=this.returnKitConstructors();try{Array.isArray(t.kitConfigs)&&t.kitConfigs.length&&t.kitConfigs.forEach((function(e){n.configureUIEnabledKit(e,r)}))}catch(t){e.Logger.error("MP Kits not configured propertly. Kits may not be initialized. "+t)}},this.returnKitConstructors=function(){var t={};return J(e._Store.SDKConfig.kits)?!J(e._preInit.forwarderConstructors)&&e._preInit.forwarderConstructors.forEach((function(e){if(e.suffix){var r="".concat(e.name,"-").concat(e.suffix);t[r]=e}else t[e.name]=e})):t=e._Store.SDKConfig.kits,t},this.configureUIEnabledKit=function(t,r){var n=null,o=t;for(var i in r){var s=void 0;if(o.suffix&&(s="".concat(o.name,"-").concat(o.suffix)),!(i!==s&&i!==o.name||o.isDebug!==e._Store.SDKConfig.isDevelopmentMode&&o.isSandbox!==e._Store.SDKConfig.isDevelopmentMode)){n=this.returnConfiguredKit(r[i],o),e._Store.configuredForwarders.push(n);break}}},this.processSideloadedKits=function(t){try{if(Array.isArray(t.sideloadedKits)){var r={kits:{}},o=t.sideloadedKits;for(var i in o.forEach((function(e){try{e.kitInstance.register(r);var t=e.kitInstance.name;r.kits[t].filters=e.filterDictionary}catch(t){console.error("Error registering sideloaded kit "+e.kitInstance.name)}})),r.kits){var s=r.kits[i];n.configureSideloadedKit(s)}if(!J(r.kits)){var a=Object.keys(r.kits);e._Store.sideloadedKitsCount=a.length}}}catch(t){e.Logger.error("Sideloaded Kits not configured propertly. Kits may not be initialized. "+t)}},this.configureSideloadedKit=function(t){e._Store.configuredForwarders.push(this.returnConfiguredKit(t,t.filters))},this.returnConfiguredKit=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=new e.constructor;return r.id=t.moduleId,r.isSandbox=t.isDebug||t.isSandbox,r.hasSandbox="true"===t.hasDebugString,r.isVisible=t.isVisible||!0,r.settings=t.settings||{},r.eventNameFilters=t.eventNameFilters||[],r.eventTypeFilters=t.eventTypeFilters||[],r.attributeFilters=t.attributeFilters||[],r.screenNameFilters=t.screenNameFilters||[],r.screenAttributeFilters=t.screenAttributeFilters||[],r.userIdentityFilters=t.userIdentityFilters||[],r.userAttributeFilters=t.userAttributeFilters||[],r.filteringEventAttributeValue=t.filteringEventAttributeValue||{},r.filteringUserAttributeValue=t.filteringUserAttributeValue||{},r.eventSubscriptionId=t.eventSubscriptionId||null,r.filteringConsentRuleValues=t.filteringConsentRuleValues||{},r.excludeAnonymousUser=t.excludeAnonymousUser||!1,r},this.configurePixel=function(t){(t.isDebug===e._Store.SDKConfig.isDevelopmentMode||t.isProduction!==e._Store.SDKConfig.isDevelopmentMode)&&e._Store.pixelConfigurations.push(t)},this.processPixelConfigs=function(t){try{J(t.pixelConfigs)||t.pixelConfigs.forEach((function(e){n.configurePixel(e)}))}catch(t){e.Logger.error("Cookie Sync configs not configured propertly. Cookie Sync may not be initialized. "+t)}},this.sendSingleForwardingStatsToServer=function(){var t=Tt(Mt.mark((function t(n){var o,i,s,a;return Mt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={method:"post",body:JSON.stringify(n),headers:{Accept:"text/plain;charset=UTF-8","Content-Type":"text/plain;charset=UTF-8"}},t.next=3,r.forwarderStatsUploader.upload(i);case 3:s=t.sent,a=202===s.status?"Successfully sent forwarding stats to mParticle Servers":"Issue with forwarding stats to mParticle Servers, received HTTP Code of "+s.statusText,null==e||null===(o=e.Logger)||void 0===o||o.verbose(a);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}var jt=se.MessageType,qt=se.ApplicationTransitionType;function Bt(e){return e?e.map((function(e){return function(e){return{id:L(e.Sku),nm:L(e.Name),pr:U(e.Price),qt:U(e.Quantity),br:L(e.Brand),va:L(e.Variant),ca:L(e.Category),ps:U(e.Position),cc:L(e.CouponCode),tpa:U(e.TotalAmount),attrs:e.Attributes}}(e)})):[]}function Wt(e){var t=this;this.appendUserInfo=function(t,r){if(r){if(!t)return r.MPID=null,r.ConsentState=null,r.UserAttributes=null,void(r.UserIdentities=null);if(!r.MPID||r.MPID!==t.getMPID()){r.MPID=t.getMPID(),r.ConsentState=t.getConsentState(),r.UserAttributes=t.getAllUserAttributes();var n=t.getUserIdentities().userIdentities,o={};for(var i in n){var s=se.IdentityType.getIdentityType(i);!1!==s&&(o[s]=n[i])}var a=[];if(e._Helpers.isObject(o)&&Object.keys(o).length)for(var c in o){var u={};u.Identity=o[c],u.Type=e._Helpers.parseNumber(c),a.push(u)}r.UserIdentities=a}}},this.convertToConsentStateV2DTO=function(e){if(!e)return null;var t={},r=e.getGDPRConsentState();if(r){var n={};for(var o in t.gdpr=n,r)if(r.hasOwnProperty(o)){var i=r[o];t.gdpr[o]={},"boolean"==typeof i.Consented&&(n[o].c=i.Consented),"number"==typeof i.Timestamp&&(n[o].ts=i.Timestamp),"string"==typeof i.ConsentDocument&&(n[o].d=i.ConsentDocument),"string"==typeof i.Location&&(n[o].l=i.Location),"string"==typeof i.HardwareId&&(n[o].h=i.HardwareId)}}var s=e.getCCPAConsentState();return s&&(t.ccpa={data_sale_opt_out:{c:s.Consented,ts:s.Timestamp,d:s.ConsentDocument,l:s.Location,h:s.HardwareId}}),t},this.createEventObject=function(r,n){var o={},i={},s=r.messageType===se.MessageType.OptOut?!e._Store.isEnabled:null;if(e._Store.sessionId||r.messageType===se.MessageType.OptOut||e._Store.webviewBridgeEnabled){var a=f({},r.customFlags);if(e._Helpers.getFeatureFlag&&e._Helpers.getFeatureFlag(S.FeatureFlags.CaptureIntegrationSpecificIds)){e._IntegrationCapture.capture();var c=e._IntegrationCapture.getClickIdsAsCustomFlags();a=f(f({},c),a)}i=r.hasOwnProperty("toEventAPIObject")?r.toEventAPIObject():{EventName:r.name||r.messageType,EventCategory:r.eventType,EventAttributes:e._Helpers.sanitizeAttributes(r.data,r.name),SourceMessageId:r.sourceMessageId||e._Helpers.generateUniqueId(),EventDataType:r.messageType,CustomFlags:a,UserAttributeChanges:r.userAttributeChanges,UserIdentityChanges:r.userIdentityChanges},r.messageType!==se.MessageType.SessionEnd&&(e._Store.dateLastEventSent=new Date),o={Store:e._Store.serverSettings,SDKVersion:S.sdkVersion,SessionId:e._Store.sessionId,SessionStartDate:e._Store.sessionStartDate?e._Store.sessionStartDate.getTime():0,Debug:e._Store.SDKConfig.isDevelopmentMode,Location:e._Store.currentPosition,OptOut:s,ExpandedEventCount:0,AppVersion:e.getAppVersion(),AppName:e.getAppName(),Package:e._Store.SDKConfig.package,ClientGeneratedId:e._Store.clientId,DeviceId:e._Store.deviceId,IntegrationAttributes:e._Store.integrationAttributes,CurrencyCode:e._Store.currencyCode,DataPlan:e._Store.SDKConfig.dataPlan?e._Store.SDKConfig.dataPlan:{}},i.EventDataType===jt.AppStateTransition&&(i.IsFirstRun=e._Store.isFirstRun,i.LaunchReferral=window.location.href||null),i.CurrencyCode=e._Store.currencyCode;var u=n||e.Identity.getCurrentUser();return t.appendUserInfo(u,i),r.messageType===se.MessageType.SessionEnd&&(i.SessionLength=e._Store.dateLastEventSent.getTime()-e._Store.sessionStartDate.getTime(),i.currentSessionMPIDs=e._Store.currentSessionMPIDs,i.EventAttributes=e._Store.sessionAttributes,e._Store.currentSessionMPIDs=[],e._Store.sessionStartDate=null),o.Timestamp=e._Store.dateLastEventSent.getTime(),e._Helpers.extend({},i,o)}return null},this.convertEventToV2DTO=function(r){var n={n:r.EventName,et:r.EventCategory,ua:r.UserAttributes,ui:r.UserIdentities,ia:r.IntegrationAttributes,str:r.Store,attrs:r.EventAttributes,sdk:r.SDKVersion,sid:r.SessionId,sl:r.SessionLength,ssd:r.SessionStartDate,dt:r.EventDataType,dbg:r.Debug,ct:r.Timestamp,lc:r.Location,o:r.OptOut,eec:r.ExpandedEventCount,av:r.AppVersion,cgid:r.ClientGeneratedId,das:r.DeviceId,mpid:r.MPID,smpids:r.currentSessionMPIDs};r.DataPlan&&r.DataPlan.PlanId&&(n.dp_id=r.DataPlan.PlanId,r.DataPlan.PlanVersion&&(n.dp_v=r.DataPlan.PlanVersion));var o=t.convertToConsentStateV2DTO(r.ConsentState);return o&&(n.con=o),r.EventDataType===jt.AppStateTransition&&(n.fr=r.IsFirstRun,n.iu=!1,n.at=qt.AppInit,n.lr=r.LaunchReferral,n.attrs=null),r.CustomFlags&&function(e,t){var r=[];for(var n in t.flags={},e.CustomFlags)r=[],e.CustomFlags.hasOwnProperty(n)&&(Array.isArray(e.CustomFlags[n])?e.CustomFlags[n].forEach((function(e){B(e)&&r.push(e.toString())})):B(e.CustomFlags[n])&&r.push(e.CustomFlags[n].toString()),r.length&&(t.flags[n]=r))}(r,n),r.EventDataType===jt.Commerce?(n.cu=r.CurrencyCode,r.ShoppingCart&&(n.sc={pl:Bt(r.ShoppingCart.ProductList)}),r.ProductAction?n.pd={an:r.ProductAction.ProductActionType,cs:e._Helpers.parseNumber(r.ProductAction.CheckoutStep),co:r.ProductAction.CheckoutOptions,pl:Bt(r.ProductAction.ProductList),ti:r.ProductAction.TransactionId,ta:r.ProductAction.Affiliation,tcc:r.ProductAction.CouponCode,tr:e._Helpers.parseNumber(r.ProductAction.TotalAmount),ts:e._Helpers.parseNumber(r.ProductAction.ShippingAmount),tt:e._Helpers.parseNumber(r.ProductAction.TaxAmount)}:r.PromotionAction?n.pm={an:r.PromotionAction.PromotionActionType,pl:r.PromotionAction.PromotionList.map((function(e){return{id:e.Id,nm:e.Name,cr:e.Creative,ps:e.Position?e.Position:0}}))}:r.ProductImpressions&&(n.pi=r.ProductImpressions.map((function(e){return{pil:e.ProductImpressionList,pl:Bt(e.ProductList)}})))):r.EventDataType===jt.Profile&&(n.pet=r.ProfileMessageType),n}}function zt(e){this.startForwardingStatsTimer=function(){mParticle._forwardingStatsTimer=setInterval((function(){!function(){var t=e._Forwarders.getForwarderStatsQueue(),r=e._Persistence.forwardingStatsBatches.uploadsTable,n=Date.now();for(var o in t.length&&(r[n]={uploading:!1,data:t},e._Forwarders.setForwarderStatsQueue([])),r)!function(t){if(r.hasOwnProperty(t)&&!1===r[t].uploading){var n=e._Helpers.createXHR((function(){4===n.readyState&&(200===n.status||202===n.status?(e.Logger.verbose("Successfully sent  "+n.statusText+" from server"),delete r[t]):"4"===n.status.toString()[0]?429!==n.status&&delete r[t]:r[t].uploading=!1)})),o=r[t].data;r[t].uploading=!0,e._APIClient.sendBatchForwardingStatsToServer(o,n)}}(o)}()}),e._Store.SDKConfig.forwarderStatsTimeout)}}var Jt=S.IdentityMethods,Qt=Jt.Identify,Gt=Jt.Modify,Yt=Jt.Login,Xt=Jt.Logout,$t="x-mp-max-age",Zt=function(e,t,r,n,o){if(!o){var i=ir(null==n?void 0:n.cacheMaxAge);e===Yt||e===Qt?er(e,t,i,r,n):(e===Gt||e===Xt)&&r.purge()}},er=function(e,t,r,n,o){var i=o.responseText,s=o.status,a=n.retrieve()||{},c=T(tr(e,t)),u=i.mpid,d=i.is_logged_in;a[c]={responseText:JSON.stringify({mpid:u,is_logged_in:d}),status:s,expireTimestamp:r},n.store(a)},tr=function(e,t){var r="".concat(e,":").concat("device_application_stamp","=").concat(t.device_application_stamp,";"),n="";if(Object.keys(t).length){var o=[];for(var i in t){if("device_application_stamp"===i)continue;o[se.IdentityType.getIdentityType(i)]=t[i]}n=o.reduce((function(e,t,r){var n=se.IdentityType.getIdentityName(r);return"".concat(e).concat(n,"=").concat(t,";")}),r)}return n},rr=function(e,t){var r={};if(O(null==e?void 0:e.userIdentities))for(var n in e.userIdentities)r[n]=e.userIdentities[n];return r.device_application_stamp=t,r},nr=function(e){var t=e.retrieve()||{},r=(new Date).getTime();for(var n in t)t[n].expireTimestamp<r&&delete t[n];e.store(t)},or=function(e,t,r,n,o,i,s){var a=function(e,t,r){var n=null==r?void 0:r.retrieve();if(!n)return!1;var o=T(tr(e,t));return!(!n.hasOwnProperty(o)||n[o].expireTimestamp<(new Date).getTime())}(s,e,t);if(a){var c=function(e,t,r){var n=T(tr(e,t)),o=r.retrieve(),i=o?o[n]:null;return{responseText:sr(i.responseText),expireTimestamp:i.expireTimestamp,status:i.status}}(s,e,t);return r(c,n,o,i,s,e,!0),!0}return!1},ir=function(e){return void 0===e&&(e=86400),(new Date).getTime()+1e3*e},sr=function(e){return e?JSON.parse(e):{}},ar=function(){function e(e,t,r){this.url="",this.logger=r,this.url="https://".concat(e).concat(t,"/audience"),this.userAudienceAPI=window.fetch?new Ge(this.url):new Ye(this.url)}return e.prototype.sendGetUserAudienceRequest=function(e,t){return m(this,void 0,void 0,(function(){var r,n,o,i,s,a;return h(this,(function(c){switch(c.label){case 0:this.logger.verbose("Fetching user audiences from server"),r={method:"GET",headers:{Accept:"*/*"}},n="".concat(this.url,"?mpid=").concat(e),c.label=1;case 1:return c.trys.push([1,6,,7]),[4,this.userAudienceAPI.upload(r,n)];case 2:return 200<=(o=c.sent()).status&&300>o.status?(this.logger.verbose("User Audiences successfully received"),[4,o.json()]):[3,4];case 3:i=c.sent(),s={currentAudienceMemberships:null==i?void 0:i.audience_memberships};try{t(s)}catch(e){throw new Error("Error invoking callback on user audience response.")}return[3,5];case 4:throw 401===o.status?new Error("`HTTP error status ${userAudiencePromise.status} while retrieving User Audiences - please verify your API key.`"):403===o.status?new Error("`HTTP error status ${userAudiencePromise.status} while retrieving User Audiences - please verify your workspace is enabled for audiences.`"):new Error("Uncaught HTTP Error ".concat(o.status,"."));case 5:return[3,7];case 6:return a=c.sent(),this.logger.error("Error retrieving audiences. ".concat(a)),[3,7];case 7:return[2]}}))}))},e}();var cr=void 0,ur=function(e){return J(e)||e.forEach((function(e){q(e)?e():Array.isArray(e)&&dr(e)})),[]},dr=function(e){var t=e,r=t.splice(0,1)[0];if("undefined"!=typeof window&&window.mParticle&&window.mParticle[t[0]])window.mParticle[r].apply(cr,t);else{var n=r.split(".");try{for(var o=window.mParticle,i=0,s=n;i<s.length;i++)o=o[s[i]];o.apply(cr,t)}catch(e){throw new Error("Unable to compute proper mParticle function "+e)}}},lr=S.Messages,gr=S.HTTPCodes,pr=S.FeatureFlags,vr=S.IdentityMethods,fr=lr.ErrorMessages,mr=pr.CacheIdentity,hr=vr.Identify,yr=vr.Modify,Sr=vr.Login,br=vr.Logout;function _r(e){var t=e._Helpers,r=t.getFeatureFlag,n=t.extend,o=this;this.idCache=null,this.audienceManager=null,this.IdentityRequest={preProcessIdentityRequest:function(t,r,n){e.Logger.verbose(lr.InformationMessages.StartingLogEvent+": "+n);var o=e._Helpers.Validators.validateIdentities(t,n);if(!o.valid)return e.Logger.error("ERROR: "+o.error),{valid:!1,error:o.error};if(r&&!e._Helpers.Validators.isFunction(r)){var i="The optional callback must be a function. You tried entering a(n) "+d(r);return e.Logger.error(i),{valid:!1,error:i}}return{valid:!0}},createIdentityRequest:function(t,r,n,o,i,s,a){return{client_sdk:{platform:r,sdk_vendor:n,sdk_version:o},context:s,environment:e._Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:e._Helpers.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),previous_mpid:a||null,known_identities:rr(t,i)}},createModifyIdentityRequest:function(t,r,n,o,i,s){return{client_sdk:{platform:n,sdk_vendor:o,sdk_version:i},context:s,environment:e._Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:e._Helpers.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),identity_changes:this.createIdentityChanges(t,r)}},createIdentityChanges:function(e,t){var r,n=[];if(t&&O(t)&&e&&O(e))for(r in t)n.push({old_value:e[r]||null,new_value:t[r],identity_type:r});return n},combineUserIdentities:function(e,t){var r={},o=n({},e,t);for(var i in o){var s=se.IdentityType.getIdentityType(i);!1!==s&&0<=s&&(r[se.IdentityType.getIdentityType(i)]=o[i])}return r},createAliasNetworkRequest:function(t){return{request_id:e._Helpers.generateUniqueId(),request_type:"alias",environment:e._Store.SDKConfig.isDevelopmentMode?"development":"production",api_key:e._Store.devToken,data:{destination_mpid:t.destinationMpid,source_mpid:t.sourceMpid,start_unixtime_ms:t.startTime,end_unixtime_ms:t.endTime,scope:t.scope,device_application_stamp:e._Store.deviceId}}},convertAliasToNative:function(e){return{DestinationMpid:e.destinationMpid,SourceMpid:e.sourceMpid,StartUnixtimeMs:e.startTime,EndUnixtimeMs:e.endTime}},convertToNative:function(e){var t=[];if(e&&e.userIdentities){for(var r in e.userIdentities)e.userIdentities.hasOwnProperty(r)&&t.push({Type:se.IdentityType.getIdentityType(r),Identity:e.userIdentities[r]});return{UserIdentities:t}}}},this.IdentityAPI={HTTPCodes:gr,identify:function(t,r){var n,i=e.Identity.getCurrentUser(),s=e._Identity.IdentityRequest.preProcessIdentityRequest(t,r,hr);if(i&&(n=i.getMPID()),s.valid){var a=e._Identity.IdentityRequest.createIdentityRequest(t,S.platform,S.sdkVendor,S.sdkVersion,e._Store.deviceId,e._Store.context,n);if(e._Helpers.getFeatureFlag(S.FeatureFlags.CacheIdentity))if(or(a.known_identities,o.idCache,o.parseIdentityResponse,n,r,t,hr))return;e._Helpers.canLog()?e._Store.webviewBridgeEnabled?(e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.Identify,JSON.stringify(e._Identity.IdentityRequest.convertToNative(t))),e._Helpers.invokeCallback(r,gr.nativeIdentityRequest,"Identify request sent to native sdk")):e._IdentityAPIClient.sendIdentityRequest(a,hr,r,t,o.parseIdentityResponse,n,a.known_identities):(e._Helpers.invokeCallback(r,gr.loggingDisabledOrMissingAPIKey,lr.InformationMessages.AbandonLogEvent),e.Logger.verbose(lr.InformationMessages.AbandonLogEvent))}else e._Helpers.invokeCallback(r,gr.validationIssue,s.error),e.Logger.verbose(s)},logout:function(t,r){var n,i=e.Identity.getCurrentUser(),s=e._Identity.IdentityRequest.preProcessIdentityRequest(t,r,br);if(i&&(n=i.getMPID()),s.valid){var a,c=e._Identity.IdentityRequest.createIdentityRequest(t,S.platform,S.sdkVendor,S.sdkVersion,e._Store.deviceId,e._Store.context,n);e._Helpers.canLog()?e._Store.webviewBridgeEnabled?(e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.Logout,JSON.stringify(e._Identity.IdentityRequest.convertToNative(t))),e._Helpers.invokeCallback(r,gr.nativeIdentityRequest,"Logout request sent to native sdk")):(e._IdentityAPIClient.sendIdentityRequest(c,br,r,t,o.parseIdentityResponse,n),(a=e._ServerModel.createEventObject({messageType:se.MessageType.Profile})).ProfileMessageType=se.ProfileMessageType.Logout,e._Store.activeForwarders.length&&e._Store.activeForwarders.forEach((function(e){e.logOut&&e.logOut(a)}))):(e._Helpers.invokeCallback(r,gr.loggingDisabledOrMissingAPIKey,lr.InformationMessages.AbandonLogEvent),e.Logger.verbose(lr.InformationMessages.AbandonLogEvent))}else e._Helpers.invokeCallback(r,gr.validationIssue,s.error),e.Logger.verbose(s)},login:function(t,r){var n,i=e.Identity.getCurrentUser(),s=e._Identity.IdentityRequest.preProcessIdentityRequest(t,r,Sr);if(i&&(n=i.getMPID()),s.valid){var a=e._Identity.IdentityRequest.createIdentityRequest(t,S.platform,S.sdkVendor,S.sdkVersion,e._Store.deviceId,e._Store.context,n);if(e._Helpers.getFeatureFlag(S.FeatureFlags.CacheIdentity))if(or(a.known_identities,o.idCache,o.parseIdentityResponse,n,r,t,Sr))return;e._Helpers.canLog()?e._Store.webviewBridgeEnabled?(e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.Login,JSON.stringify(e._Identity.IdentityRequest.convertToNative(t))),e._Helpers.invokeCallback(r,gr.nativeIdentityRequest,"Login request sent to native sdk")):e._IdentityAPIClient.sendIdentityRequest(a,Sr,r,t,o.parseIdentityResponse,n,a.known_identities):(e._Helpers.invokeCallback(r,gr.loggingDisabledOrMissingAPIKey,lr.InformationMessages.AbandonLogEvent),e.Logger.verbose(lr.InformationMessages.AbandonLogEvent))}else e._Helpers.invokeCallback(r,gr.validationIssue,s.error),e.Logger.verbose(s)},modify:function(t,r){var n,i=e.Identity.getCurrentUser(),s=e._Identity.IdentityRequest.preProcessIdentityRequest(t,r,yr);i&&(n=i.getMPID());var a=t&&t.userIdentities?t.userIdentities:{};if(s.valid){var c=e._Identity.IdentityRequest.createModifyIdentityRequest(i?i.getUserIdentities().userIdentities:{},a,S.platform,S.sdkVendor,S.sdkVersion,e._Store.context);e._Helpers.canLog()?e._Store.webviewBridgeEnabled?(e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.Modify,JSON.stringify(e._Identity.IdentityRequest.convertToNative(t))),e._Helpers.invokeCallback(r,gr.nativeIdentityRequest,"Modify request sent to native sdk")):e._IdentityAPIClient.sendIdentityRequest(c,yr,r,t,o.parseIdentityResponse,n,c.known_identities):(e._Helpers.invokeCallback(r,gr.loggingDisabledOrMissingAPIKey,lr.InformationMessages.AbandonLogEvent),e.Logger.verbose(lr.InformationMessages.AbandonLogEvent))}else e._Helpers.invokeCallback(r,gr.validationIssue,s.error),e.Logger.verbose(s)},getCurrentUser:function(){var t;return e._Store?(t=e._Store.mpid)?(t=e._Store.mpid.slice(),o.mParticleUser(t,e._Store.isLoggedIn)):e._Store.webviewBridgeEnabled?o.mParticleUser():null:null},getUser:function(t){var r=e._Persistence.getPersistence();return r&&r[t]&&!S.SDKv2NonMPIDCookieKeys.hasOwnProperty(t)?o.mParticleUser(t):null},getUsers:function(){var t=e._Persistence.getPersistence(),r=[];if(t)for(var n in t)S.SDKv2NonMPIDCookieKeys.hasOwnProperty(n)||r.push(o.mParticleUser(n));return r.sort((function(e,t){return(e.getLastSeenTime()||0)>(t.getLastSeenTime()||0)?-1:1})),r},aliasUsers:function(t,r){var n;if(t.destinationMpid&&t.sourceMpid||(n=lr.ValidationMessages.AliasMissingMpid),t.destinationMpid===t.sourceMpid&&(n=lr.ValidationMessages.AliasNonUniqueMpid),t.startTime&&t.endTime||(n=lr.ValidationMessages.AliasMissingTime),t.startTime>t.endTime&&(n=lr.ValidationMessages.AliasStartBeforeEndTime),n)return e.Logger.warning(n),void e._Helpers.invokeAliasCallback(r,gr.validationIssue,n);if(e._Helpers.canLog())if(e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.Alias,JSON.stringify(e._Identity.IdentityRequest.convertAliasToNative(t))),e._Helpers.invokeAliasCallback(r,gr.nativeIdentityRequest,"Alias request sent to native sdk");else{e.Logger.verbose(lr.InformationMessages.StartingAliasRequest+": "+t.sourceMpid+" -> "+t.destinationMpid);var o=e._Identity.IdentityRequest.createAliasNetworkRequest(t);e._IdentityAPIClient.sendAliasRequest(o,r)}else e._Helpers.invokeAliasCallback(r,gr.loggingDisabledOrMissingAPIKey,lr.InformationMessages.AbandonAliasUsers),e.Logger.verbose(lr.InformationMessages.AbandonAliasUsers)},createAliasRequest:function(t,r){try{if(!r||!t)return e.Logger.error("'destinationUser' and 'sourceUser' must both be present"),null;var n=t.getFirstSeenTime();n||e.Identity.getUsers().forEach((function(e){e.getFirstSeenTime()&&(!n||e.getFirstSeenTime()<n)&&(n=e.getFirstSeenTime())}));var o=(new Date).getTime()-24*e._Store.SDKConfig.aliasMaxWindow*60*60*1e3,i=t.getLastSeenTime()||(new Date).getTime();return n<o&&(i<(n=o)&&e.Logger.warning("Source User has not been seen in the last "+e._Store.SDKConfig.maxAliasWindow+" days, Alias Request will likely fail")),{destinationMpid:r.getMPID(),sourceMpid:t.getMPID(),startTime:n,endTime:i}}catch(r){return e.Logger.error("There was a problem with creating an alias request: "+r),null}}},this.mParticleUser=function(t,r){var n=this;return{getUserIdentities:function(){var r={},n=e._Store.getUserIdentities(t);for(var o in n)n.hasOwnProperty(o)&&(r[se.IdentityType.getIdentityName(e._Helpers.parseNumber(o))]=n[o]);return{userIdentities:r}},getMPID:function(){return t},setUserTag:function(t){return e._Helpers.Validators.isValidKeyValue(t)?void this.setUserAttribute(t,null):void e.Logger.error(lr.ErrorMessages.BadKey)},removeUserTag:function(t){return e._Helpers.Validators.isValidKeyValue(t)?void this.removeUserAttribute(t):void e.Logger.error(lr.ErrorMessages.BadKey)},setUserAttribute:function(r,o){if(e._SessionManager.resetSessionTimer(),e._Helpers.canLog()){if(!e._Helpers.Validators.isValidAttributeValue(o))return void e.Logger.error(lr.ErrorMessages.BadAttribute);if(!e._Helpers.Validators.isValidKeyValue(r))return void e.Logger.error(lr.ErrorMessages.BadKey);if(e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.SetUserAttribute,JSON.stringify({key:r,value:o}));else{var i,s,a=this.getAllUserAttributes(),c=e._Helpers.findKeyInObject(a,r);c?(s=!1,i=a[c],delete a[c]):s=!0,a[r]=o,e._Store.setUserAttributes(t,a),n.sendUserAttributeChangeEvent(r,o,i,s,!1,this),e._Forwarders.initForwarders(n.IdentityAPI.getCurrentUser().getUserIdentities(),e._APIClient.prepareForwardingStats),e._Forwarders.handleForwarderUserAttributes("setUserAttribute",r,o)}}},setUserAttributes:function(t){if(e._SessionManager.resetSessionTimer(),O(t)){if(e._Helpers.canLog())for(var r in t)t.hasOwnProperty(r)&&this.setUserAttribute(r,t[r])}else e.Logger.error("Must pass an object into setUserAttributes. You passed a "+d(t))},removeUserAttribute:function(r){var o,i;if(e._SessionManager.resetSessionTimer(),e._Helpers.Validators.isValidKeyValue(r))if(e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.RemoveUserAttribute,JSON.stringify({key:r,value:null}));else{o=e._Persistence.getPersistence(),i=this.getAllUserAttributes();var s=e._Helpers.findKeyInObject(i,r);s&&(r=s);var a=i[r]?i[r].toString():null;delete i[r],o&&o[t]&&(o[t].ua=i,e._Persistence.savePersistence(o,t)),n.sendUserAttributeChangeEvent(r,null,a,!1,!0,this),e._Forwarders.initForwarders(n.IdentityAPI.getCurrentUser().getUserIdentities(),e._APIClient.prepareForwardingStats),e._Forwarders.handleForwarderUserAttributes("removeUserAttribute",r,null)}else e.Logger.error(lr.ErrorMessages.BadKey)},setUserAttributeList:function(r,o){if(e._SessionManager.resetSessionTimer(),e._Helpers.Validators.isValidKeyValue(r))if(Array.isArray(o)){var i=o.slice();if(e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.SetUserAttributeList,JSON.stringify({key:r,value:i}));else{var s,a,c,u=this.getAllUserAttributes(),l=e._Helpers.findKeyInObject(u,r);if(l?(a=!1,s=u[l],delete u[l]):a=!0,u[r]=i,e._Store.setUserAttributes(t,u),s&&Array.isArray(s)){if(o.length!==s.length)c=!0;else for(var g=0;g<o.length;g++)if(s[g]!==o[g]){c=!0;break}}else c=!0;c&&n.sendUserAttributeChangeEvent(r,o,s,a,!1,this),e._Forwarders.initForwarders(n.IdentityAPI.getCurrentUser().getUserIdentities(),e._APIClient.prepareForwardingStats),e._Forwarders.handleForwarderUserAttributes("setUserAttribute",r,i)}}else e.Logger.error("The value you passed in to setUserAttributeList must be an array. You passed in a "+("undefined"==typeof value?"undefined":d(value)));else e.Logger.error(lr.ErrorMessages.BadKey)},removeAllUserAttributes:function(){var t;if(e._SessionManager.resetSessionTimer(),e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.RemoveAllUserAttributes);else if(t=this.getAllUserAttributes(),e._Forwarders.initForwarders(n.IdentityAPI.getCurrentUser().getUserIdentities(),e._APIClient.prepareForwardingStats),t)for(var r in t)t.hasOwnProperty(r)&&e._Forwarders.handleForwarderUserAttributes("removeUserAttribute",r,null),this.removeUserAttribute(r)},getUserAttributesLists:function(){var e,t={};for(var r in e=this.getAllUserAttributes())e.hasOwnProperty(r)&&Array.isArray(e[r])&&(t[r]=e[r].slice());return t},getAllUserAttributes:function(){var r={},n=(0,e._Store.getUserAttributes)(t);if(n)for(var o in n)n.hasOwnProperty(o)&&(r[o]=Array.isArray(n[o])?n[o].slice():n[o]);return r},getCart:function(){return e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart() will be removed in future releases"),n.mParticleUserCart(t)},getConsentState:function(){return e._Store.getConsentState(t)},setConsentState:function(r){e._Store.setConsentState(t,r),e._Forwarders.initForwarders(this.getUserIdentities().userIdentities,e._APIClient.prepareForwardingStats),e._CookieSyncManager.attemptCookieSync(null,this.getMPID())},isLoggedIn:function(){return r},getLastSeenTime:function(){return e._Persistence.getLastSeenTime(t)},getFirstSeenTime:function(){return e._Persistence.getFirstSeenTime(t)},getUserAudiences:function(r){return e._Helpers.getFeatureFlag(pr.AudienceAPI)?(null===n.audienceManager&&(n.audienceManager=new ar(e._Store.SDKConfig.userAudienceUrl,e._Store.devToken,e.Logger,t)),void n.audienceManager.sendGetUserAudienceRequest(t,r)):void e.Logger.error(fr.AudienceAPINotEnabled)}}},this.mParticleUserCart=function(t){return{add:function(r,n){var o,i,s;e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().add() will be removed in future releases"),(s=Array.isArray(r)?r.slice():[r]).forEach((function(t){t.Attributes=e._Helpers.sanitizeAttributes(t.Attributes)})),e._Store.webviewBridgeEnabled?e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.AddToCart,JSON.stringify(s)):(e._SessionManager.resetSessionTimer(),i=(i=e._Persistence.getUserProductsFromLS(t)).concat(s),!0===n&&e._Events.logProductActionEvent(se.ProductActionType.AddToCart,s),i.length>e._Store.SDKConfig.maxProducts&&(e.Logger.verbose("The cart contains "+i.length+" items. Only "+e._Store.SDKConfig.maxProducts+" can currently be saved in cookies."),i=i.slice(-e._Store.SDKConfig.maxProducts)),(o=e._Persistence.getAllUserProductsFromLS())[t].cp=i,e._Persistence.setCartProducts(o))},remove:function(r,n){e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().remove() will be removed in future releases");var o,i,s=-1,a=null;e._Store.webviewBridgeEnabled?e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.RemoveFromCart,JSON.stringify(r)):(e._SessionManager.resetSessionTimer(),(i=e._Persistence.getUserProductsFromLS(t))&&(i.forEach((function(e,t){e.Sku===r.Sku&&(s=t,a=e)})),-1<s&&(i.splice(s,1),!0===n&&e._Events.logProductActionEvent(se.ProductActionType.RemoveFromCart,a))),(o=e._Persistence.getAllUserProductsFromLS())[t].cp=i,e._Persistence.setCartProducts(o))},clear:function(){var r;e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().clear() will be removed in future releases"),e._Store.webviewBridgeEnabled?e._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.ClearCart):(e._SessionManager.resetSessionTimer(),(r=e._Persistence.getAllUserProductsFromLS())&&r[t]&&r[t].cp&&(r[t].cp=[],r[t].cp=[],e._Persistence.setCartProducts(r)))},getCartProducts:function(){return e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().getCartProducts() will be removed in future releases"),e._Persistence.getCartProducts(t)}}},this.parseIdentityResponse=function(t,n,i,s,a,c,u){var d,l,g,p=e.Identity.getUser(n),v=p?p.getMPID():null,f=p?p.getUserIdentities().userIdentities:{},m={};e._Store.identityCallInFlight=!1;try{var h,y,S;if(e.Logger.verbose('Parsing "'+a+'" identity response from server'),l=null!==(h=t.responseText)&&void 0!==h?h:null,e._Store.isLoggedIn=(null===(y=l)||void 0===y?void 0:y.is_logged_in)||!1,function(e,t){return!e||e.getMPID()&&t.mpid&&t.mpid!==e.getMPID()}(p,l)&&(e._Store.mpid=l.mpid,p&&e._Persistence.setLastSeenTime(n),d=!e._Persistence.getFirstSeenTime(l.mpid),e._Persistence.setFirstSeenTime(l.mpid)),t.status===b){r(mr)&&Zt(a,c,o.idCache,t,u);var _=o.IdentityAPI.getUser(l.mpid),I=_?_.getUserIdentities().userIdentities:{};a===yr?(m=e._Identity.IdentityRequest.combineUserIdentities(f,s.userIdentities),e._Store.setUserIdentities(n,m)):(a===hr&&p&&l.mpid===v&&e._Persistence.setFirstSeenTime(l.mpid),e._Store.addMpidToSessionHistory(l.mpid,n),e._CookieSyncManager.attemptCookieSync(n,l.mpid,d),e._Persistence.swapCurrentUser(n,l.mpid,e._Store.currentSessionMPIDs),s&&!J(s.userIdentities)&&(m=o.IdentityRequest.combineUserIdentities(I,s.userIdentities)),e._Store.setUserIdentities(l.mpid,m),e._Persistence.update(),e._Store.syncPersistenceData(),e._Persistence.findPrevCookiesBasedOnUI(s),e._Store.context=l.context||e._Store.context),function(e,t,r,n){if(r&&r.onUserAlias&&q(r.onUserAlias))try{n.warning(E("onUserAlias")),r.onUserAlias(e,t)}catch(t){n.error("There was an error with your onUserAlias function - "+t)}}(p,g=e.Identity.getCurrentUser(),s,e.Logger);var P=e._Persistence.getPersistence();g&&(e._Persistence.storeDataInMemory(P,g.getMPID()),o.reinitForwardersOnUserChange(p,g),o.setForwarderCallbacks(g,a));var C=function(e){var t={};for(var r in e)t[X(U(r))]=e[r];return t}(m),w=a===yr?f:I;o.sendUserIdentityChangeEvent(C,a,l.mpid,w)}if(i){var A=0===t.status?gr.noHttpCoverage:t.status;e._Helpers.invokeCallback(i,A,l||null,g)}else l&&!J(l.errors)&&e.Logger.error("Received HTTP response code of "+t.status+" - "+l.errors[0].message);e.Logger.verbose("Successfully parsed Identity Response"),null===(S=e._APIClient)||void 0===S||S.processQueuedEvents()}catch(r){i&&e._Helpers.invokeCallback(i,t.status,l||null),e.Logger.error("Error parsing JSON response from Identity server: "+r)}e._Store.isInitialized=!0,e._preInit.readyQueue=ur(e._preInit.readyQueue)},this.sendUserIdentityChangeEvent=function(t,r,n,i){if(n||r===yr){var s=this.IdentityAPI.getUser(n);for(var a in t)if(i[a]!==t[a]){var c,u=!i[a],d=o.createUserIdentityChange(a,t[a],i[a],u,s);null===(c=e._APIClient)||void 0===c||c.sendEventToServer(d)}}},this.createUserIdentityChange=function(t,r,n,o,i){return e._ServerModel.createEventObject({messageType:se.MessageType.UserIdentityChange,userIdentityChanges:{New:{IdentityType:t,Identity:r,CreatedThisBatch:o},Old:{IdentityType:t,Identity:n,CreatedThisBatch:!1}},userInMemory:i})},this.sendUserAttributeChangeEvent=function(t,r,n,i,s,a){var c,u=o.createUserAttributeChange(t,r,n,i,s,a);u&&(null===(c=e._APIClient)||void 0===c||c.sendEventToServer(u))},this.createUserAttributeChange=function(t,r,n,o,i,s){var a;return void 0===n&&(n=null),r!==n&&(a=e._ServerModel.createEventObject({messageType:se.MessageType.UserAttributeChange,userAttributeChanges:{UserAttributeName:t,New:r,Old:n,Deleted:i,IsNewAttribute:o}},s)),a},this.reinitForwardersOnUserChange=function(t,r){var n;(function(e,t){return!e||t.getMPID()!==e.getMPID()||e.isLoggedIn()!==t.isLoggedIn()})(t,r)&&(null===(n=e._Forwarders)||void 0===n||n.initForwarders(r.getUserIdentities().userIdentities,e._APIClient.prepareForwardingStats))},this.setForwarderCallbacks=function(t,r){var n,o,i;null===(n=e._Forwarders)||void 0===n||n.setForwarderUserIdentities(t.getUserIdentities().userIdentities),null===(o=e._Forwarders)||void 0===o||o.setForwarderOnIdentityComplete(t,r),null===(i=e._Forwarders)||void 0===i||i.setForwarderOnUserIdentified(t)}}var Ir=S.CCPAPurpose;function Pr(e){var t=this;this.isEnabledForUserConsent=function(e,t){if(!e||!e.values||!e.values.length)return!0;if(!t)return!1;var r,n={},o=t.getConsentState();if(o){var i=o.getGDPRConsentState();if(i)for(var s in i)i.hasOwnProperty(s)&&(r=tt.hashConsentPurposeConditionalForwarding("1",s),n[r]=i[s].Consented);var a=o.getCCPAConsentState();a&&(r=tt.hashConsentPurposeConditionalForwarding("2",Ir),n[r]=a.Consented)}var c=e.values.some((function(e){var t=e.consentPurpose,r=e.hasConsented;return!!n.hasOwnProperty(t)&&n[t]===r}));return e.includeOnMatch===c},this.createPrivacyConsent=function(t,r,n,o,i){return"boolean"==typeof t?r&&isNaN(r)?(e.Logger.error("Timestamp must be a valid number when constructing a Consent object."),null):n&&"string"!=typeof n?(e.Logger.error("Document must be a valid string when constructing a Consent object."),null):o&&"string"!=typeof o?(e.Logger.error("Location must be a valid string when constructing a Consent object."),null):i&&"string"!=typeof i?(e.Logger.error("Hardware ID must be a valid string when constructing a Consent object."),null):{Consented:t,Timestamp:r||Date.now(),ConsentDocument:n,Location:o,HardwareId:i}:(e.Logger.error("Consented boolean is required when constructing a Consent object."),null)},this.ConsentSerialization={toMinifiedJsonObject:function(e){var t,r={};if(e){var n=e.getGDPRConsentState();if(n)for(var o in r.gdpr={},n)if(n.hasOwnProperty(o)){var i=n[o];r.gdpr[o]={},"boolean"==typeof i.Consented&&(r.gdpr[o].c=i.Consented),"number"==typeof i.Timestamp&&(r.gdpr[o].ts=i.Timestamp),"string"==typeof i.ConsentDocument&&(r.gdpr[o].d=i.ConsentDocument),"string"==typeof i.Location&&(r.gdpr[o].l=i.Location),"string"==typeof i.HardwareId&&(r.gdpr[o].h=i.HardwareId)}var s=e.getCCPAConsentState();s&&(r.ccpa=((t={})[Ir]={},t),"boolean"==typeof s.Consented&&(r.ccpa[Ir].c=s.Consented),"number"==typeof s.Timestamp&&(r.ccpa[Ir].ts=s.Timestamp),"string"==typeof s.ConsentDocument&&(r.ccpa[Ir].d=s.ConsentDocument),"string"==typeof s.Location&&(r.ccpa[Ir].l=s.Location),"string"==typeof s.HardwareId&&(r.ccpa[Ir].h=s.HardwareId))}return r},fromMinifiedJsonObject:function(e){var r=t.createConsentState();if(e.gdpr)for(var n in e.gdpr)if(e.gdpr.hasOwnProperty(n)){var o=t.createPrivacyConsent(e.gdpr[n].c,e.gdpr[n].ts,e.gdpr[n].d,e.gdpr[n].l,e.gdpr[n].h);r.addGDPRConsentState(n,o)}if(e.ccpa&&e.ccpa.hasOwnProperty(Ir)){var i=t.createPrivacyConsent(e.ccpa[Ir].c,e.ccpa[Ir].ts,e.ccpa[Ir].d,e.ccpa[Ir].l,e.ccpa[Ir].h);r.setCCPAConsentState(i)}return r}},this.createConsentState=function(r){function n(e){if("string"!=typeof e)return null;var t=e.trim();return t.length?t.toLowerCase():null}function o(){return delete s[Ir],this}var i={},s={};if(r){var a=t.createConsentState();return a.setGDPRConsentState(r.getGDPRConsentState()),a.setCCPAConsentState(r.getCCPAConsentState()),a}return{setGDPRConsentState:function(e){if(e){if(O(e))for(var t in i={},e)e.hasOwnProperty(t)&&this.addGDPRConsentState(t,e[t])}else i={};return this},addGDPRConsentState:function(r,o){var s=n(r);if(!s)return e.Logger.error("Purpose must be a string."),this;if(!O(o))return e.Logger.error("Invoked with a bad or empty consent object."),this;var a=t.createPrivacyConsent(o.Consented,o.Timestamp,o.ConsentDocument,o.Location,o.HardwareId);return a&&(i[s]=a),this},setCCPAConsentState:function(r){if(!O(r))return e.Logger.error("Invoked with a bad or empty CCPA consent object."),this;var n=t.createPrivacyConsent(r.Consented,r.Timestamp,r.ConsentDocument,r.Location,r.HardwareId);return n&&(s[Ir]=n),this},getCCPAConsentState:function(){return s[Ir]},getGDPRConsentState:function(){return Object.assign({},i)},removeGDPRConsentState:function(e){var t=n(e);return t?(delete i[t],this):this},removeCCPAState:function(){return e.Logger.warning("removeCCPAState is deprecated and will be removed in a future release; use removeCCPAConsentState instead"),o()},removeCCPAConsentState:o}}}var Cr={ScreenView:"screen_view",CustomEvent:"custom_event",Commerce:"commerce",UserAttributes:"user_attributes",UserIdentities:"user_identities",ProductAction:"product_action",PromotionAction:"promotion_action",ProductImpression:"product_impression"},wr=function(){function e(e,t){var r,n,o,i,s,a,c,u,d,l,g,p,v,f,m,h=this;if(this.dataPlanMatchLookups={},this.blockEvents=!1,this.blockEventAttributes=!1,this.blockUserAttributes=!1,this.blockUserIdentities=!1,this.kitBlockingEnabled=!1,!e||e.document){this.kitBlockingEnabled=!0,this.mpInstance=t,this.blockEvents=null===(o=null===(n=null===(r=null==e?void 0:e.document)||void 0===r?void 0:r.dtpn)||void 0===n?void 0:n.blok)||void 0===o?void 0:o.ev,this.blockEventAttributes=null===(a=null===(s=null===(i=null==e?void 0:e.document)||void 0===i?void 0:i.dtpn)||void 0===s?void 0:s.blok)||void 0===a?void 0:a.ea,this.blockUserAttributes=null===(d=null===(u=null===(c=null==e?void 0:e.document)||void 0===c?void 0:c.dtpn)||void 0===u?void 0:u.blok)||void 0===d?void 0:d.ua,this.blockUserIdentities=null===(p=null===(g=null===(l=null==e?void 0:e.document)||void 0===l?void 0:l.dtpn)||void 0===g?void 0:g.blok)||void 0===p?void 0:p.id;var y=null===(m=null===(f=null===(v=null==e?void 0:e.document)||void 0===v?void 0:v.dtpn)||void 0===f?void 0:f.vers)||void 0===m?void 0:m.version_document,S=null==y?void 0:y.data_points;if(y)try{0<(null==S?void 0:S.length)&&S.forEach((function(e){return h.addToMatchLookups(e)}))}catch(e){this.mpInstance.Logger.error("There was an issue with the data plan: "+e)}}else this.kitBlockingEnabled=!1}return e.prototype.addToMatchLookups=function(e){var t,r,n;if(e.match&&e.validator){var o=this.generateMatchKey(e.match),i=this.getPlannedProperties(e.match.type,e.validator);this.dataPlanMatchLookups[o]=i,((null===(t=null==e?void 0:e.match)||void 0===t?void 0:t.type)===Cr.ProductImpression||(null===(r=null==e?void 0:e.match)||void 0===r?void 0:r.type)===Cr.ProductAction||(null===(n=null==e?void 0:e.match)||void 0===n?void 0:n.type)===Cr.PromotionAction)&&(o=this.generateProductAttributeMatchKey(e.match),i=this.getProductProperties(e.match.type,e.validator),this.dataPlanMatchLookups[o]=i)}else this.mpInstance.Logger.warning("Data Plan Point is not valid' + ".concat(e))},e.prototype.generateMatchKey=function(e){var t=e.criteria||"";switch(e.type){case Cr.CustomEvent:var r=t;return[Cr.CustomEvent,r.custom_event_type,r.event_name].join(":");case Cr.ScreenView:return[Cr.ScreenView,"",t.screen_name].join(":");case Cr.ProductAction:case Cr.PromotionAction:case Cr.ProductImpression:return[e.type,t.action].join(":");case Cr.UserIdentities:case Cr.UserAttributes:return[e.type].join(":");default:return null}},e.prototype.generateProductAttributeMatchKey=function(e){var t=e.criteria||"";switch(e.type){case Cr.ProductAction:case Cr.PromotionAction:return[e.type,t.action,"ProductAttributes"].join(":");case Cr.ProductImpression:return[e.type,"ProductAttributes"].join(":");default:return null}},e.prototype.getPlannedProperties=function(e,t){var r,n,o,i,s,a,c,u,d,l;switch(e){case Cr.CustomEvent:case Cr.ScreenView:case Cr.ProductAction:case Cr.PromotionAction:case Cr.ProductImpression:if(d=null===(i=null===(o=null===(n=null===(r=null==t?void 0:t.definition)||void 0===r?void 0:r.properties)||void 0===n?void 0:n.data)||void 0===o?void 0:o.properties)||void 0===i?void 0:i.custom_attributes){if(!0===d.additionalProperties||void 0===d.additionalProperties)return!0;for(var g={},p=0,v=Object.keys(d.properties);p<v.length;p++)g[v[p]]=!0;return g}return!1!==(null===(c=null===(a=null===(s=null==t?void 0:t.definition)||void 0===s?void 0:s.properties)||void 0===a?void 0:a.data)||void 0===c?void 0:c.additionalProperties)||{};case Cr.UserAttributes:case Cr.UserIdentities:if(!0===(l=null===(u=null==t?void 0:t.definition)||void 0===u?void 0:u.additionalProperties)||void 0===l)return!0;g={};for(var f=t.definition.properties,m=0,h=Object.keys(f);m<h.length;m++)g[h[m]]=!0;return g;default:return null}},e.prototype.getProductProperties=function(e,t){var r,n,o,i,s,a,c,u,d,l,g,p,v,f,m,h,y,S,b,_;switch(e){case Cr.ProductImpression:if(!1===(null==(_=null===(l=null===(d=null===(u=null===(c=null===(a=null===(s=null===(i=null===(o=null===(n=null===(r=null==t?void 0:t.definition)||void 0===r?void 0:r.properties)||void 0===n?void 0:n.data)||void 0===o?void 0:o.properties)||void 0===i?void 0:i.product_impressions)||void 0===s?void 0:s.items)||void 0===a?void 0:a.properties)||void 0===c?void 0:c.products)||void 0===u?void 0:u.items)||void 0===d?void 0:d.properties)||void 0===l?void 0:l.custom_attributes)?void 0:_.additionalProperties)){for(var I={},P=0,C=Object.keys(null==_?void 0:_.properties);P<C.length;P++)I[C[P]]=!0;return I}return!0;case Cr.ProductAction:case Cr.PromotionAction:if((_=null===(b=null===(S=null===(y=null===(h=null===(m=null===(f=null===(v=null===(p=null===(g=null==t?void 0:t.definition)||void 0===g?void 0:g.properties)||void 0===p?void 0:p.data)||void 0===v?void 0:v.properties)||void 0===f?void 0:f.product_action)||void 0===m?void 0:m.properties)||void 0===h?void 0:h.products)||void 0===y?void 0:y.items)||void 0===S?void 0:S.properties)||void 0===b?void 0:b.custom_attributes)&&!1===_.additionalProperties){I={};for(var w=0,A=Object.keys(null==_?void 0:_.properties);w<A.length;w++)I[A[w]]=!0;return I}return!0;default:return null}},e.prototype.getMatchKey=function(e){switch(e.event_type){case Ae.EventTypeEnum.screenView:var t=e;return t.data?["screen_view","",t.data.screen_name].join(":"):null;case Ae.EventTypeEnum.commerceEvent:var r=e,n=[];if(r&&r.data){var o=r.data,i=o.product_action,s=o.product_impressions,a=o.promotion_action;i?(n.push(Cr.ProductAction),n.push(i.action)):a?(n.push(Cr.PromotionAction),n.push(a.action)):s&&n.push(Cr.ProductImpression)}return n.join(":");case Ae.EventTypeEnum.customEvent:var c=e;return c.data?["custom_event",c.data.custom_event_type,c.data.event_name].join(":"):null;default:return null}},e.prototype.getProductAttributeMatchKey=function(e){if(e.event_type===Ae.EventTypeEnum.commerceEvent){var t=[],r=e.data,n=r.product_action,o=r.product_impressions,i=r.promotion_action;return n?(t.push(Cr.ProductAction),t.push(n.action),t.push("ProductAttributes")):i?(t.push(Cr.PromotionAction),t.push(i.action),t.push("ProductAttributes")):o&&(t.push(Cr.ProductImpression),t.push("ProductAttributes")),t.join(":")}return null},e.prototype.createBlockedEvent=function(e){try{return e&&(e=this.transformEventAndEventAttributes(e)),e&&e.EventDataType===se.MessageType.Commerce&&(e=this.transformProductAttributes(e)),e&&(e=this.transformUserAttributes(e),e=this.transformUserIdentities(e)),e}catch(t){return e}},e.prototype.transformEventAndEventAttributes=function(e){var t=f({},e),r=Le(t),n=this.getMatchKey(r),o=this.dataPlanMatchLookups[n];if(this.blockEvents&&!o)return null;if(this.blockEventAttributes){if(!0===o)return t;if(o){for(var i,s=0,a=Object.keys(t.EventAttributes);s<a.length;s++)o[i=a[s]]||delete t.EventAttributes[i];return t}return t}return t},e.prototype.transformProductAttributes=function(e){function t(e,t){t.forEach((function(t){for(var r,n=0,o=Object.keys(t.Attributes);n<o.length;n++)r=o[n],e[r]||delete t.Attributes[r]}))}var r,n=f({},e),o=Le(n),i=this.getProductAttributeMatchKey(o),s=this.dataPlanMatchLookups[i];if(this.blockEvents&&!s)return null;if(this.blockEventAttributes){if(!0===s)return n;if(s){switch(e.EventCategory){case se.CommerceEventType.ProductImpression:n.ProductImpressions.forEach((function(e){t(s,null==e?void 0:e.ProductList)}));break;case se.CommerceEventType.ProductPurchase:t(s,null===(r=n.ProductAction)||void 0===r?void 0:r.ProductList);break;default:this.mpInstance.Logger.warning("Product Not Supported ")}return n}return n}return n},e.prototype.transformUserAttributes=function(e){var t=f({},e);if(this.blockUserAttributes){var r=this.dataPlanMatchLookups.user_attributes;if(this.mpInstance._Helpers.isObject(r))for(var n,o=0,i=Object.keys(t.UserAttributes);o<i.length;o++)r[n=i[o]]||delete t.UserAttributes[n]}return t},e.prototype.isAttributeKeyBlocked=function(e){if(!this.blockUserAttributes)return!1;var t=this.dataPlanMatchLookups.user_attributes;return!("boolean"==typeof t&&t)&&"object"===d(t)&&!0!==t[e]},e.prototype.isIdentityBlocked=function(e){if(!this.blockUserIdentities)return!1;if(!this.blockUserIdentities)return!1;var t=this.dataPlanMatchLookups.user_identities;return!0!==t&&!t[e]},e.prototype.transformUserIdentities=function(e){var t,r=this,n=f({},e);if(this.blockUserIdentities){var o=this.dataPlanMatchLookups.user_identities;this.mpInstance._Helpers.isObject(o)&&(null===(t=null==n?void 0:n.UserIdentities)||void 0===t?void 0:t.length)&&n.UserIdentities.forEach((function(e,t){var i=se.IdentityType.getIdentityName(r.mpInstance._Helpers.parseNumber(e.Type));o[i]||n.UserIdentities.splice(t,1)}))}return n},e}(),Ar=function(e,t,r,n){var o=["env=".concat(n?"1":"0")],i=r||{},s=i.planId,a=i.planVersion;return s&&o.push("plan_id=".concat(s)),a&&o.push("plan_version=".concat(a)),"".concat(e+t+"/config","?").concat(o.join("&"))};function Er(e,t,r){var n=this,o="https://"+r._Store.SDKConfig.configUrl,i=t.isDevelopmentMode,s=t.dataPlan,a=Ar(o,e,s,i),c=window.fetch?new Ge(a):new Ye(a);this.getSDKConfiguration=function(){return m(n,void 0,void 0,(function(){var e,n,o,i,s,a;return h(this,(function(u){switch(u.label){case 0:e={method:"get",headers:{Accept:"text/plain;charset=UTF-8","Content-Type":"text/plain;charset=UTF-8"},body:null},u.label=1;case 1:return u.trys.push([1,6,,7]),[4,c.upload(e)];case 2:return 200!==(n=u.sent()).status?[3,5]:(null===(i=null==r?void 0:r.Logger)||void 0===i||i.verbose("Successfully received configuration from server"),n.json?[4,n.json()]:[3,4]);case 3:return[2,u.sent()];case 4:return o=n,[2,JSON.parse(o.responseText)];case 5:return null===(s=null==r?void 0:r.Logger)||void 0===s||s.verbose("Issue with receiving configuration from server, received HTTP Code of "+n.statusText),[3,7];case 6:return u.sent(),null===(a=null==r?void 0:r.Logger)||void 0===a||a.error("Error getting forwarder configuration from mParticle servers."),[3,7];case 7:return[2,t]}}))}))}}var Tr=S.HTTPCodes,kr=S.Messages;function Dr(e,t,r){return m(this,void 0,void 0,(function(){var n,o,i,s,a,c,u,d,l,g,p,v,f,m,y,S;return h(this,(function(h){switch(h.label){case 0:n=e.Logger,o=n.verbose,i=n.error,s=e._Helpers.invokeAliasCallback,a=e._Store.SDKConfig.aliasUrl,c=e._Store.devToken,o(kr.InformationMessages.SendAliasHttp),u="https://".concat(a).concat(c,"/Alias"),d=window.fetch?new Ge(u):new Ye(u),l={method:"post",headers:{Accept:"text/plain;charset=UTF-8","Content-Type":"application/json"},body:JSON.stringify(t)},h.label=1;case 1:return h.trys.push([1,9,,10]),[4,d.upload(l)];case 2:if(g=h.sent(),p=void 0,v=void 0,!g.json)return[3,7];h.label=3;case 3:return h.trys.push([3,5,,6]),[4,g.json()];case 4:return v=h.sent(),[3,6];case 5:return h.sent(),o("The request has no response body"),[3,6];case 6:return[3,8];case 7:v=(f=g).responseText?JSON.parse(f.responseText):"",h.label=8;case 8:switch(m=void 0,g.status){case b:case _:p="Successfully sent forwarding stats to mParticle Servers";break;default:(null==v?void 0:v.message)&&(m=v.message),p="Issue with sending Alias Request to mParticle Servers, received HTTP Code of "+g.status}return o(p),s(r,g.status,m),[3,10];case 9:return y=h.sent(),i("Error sending alias request to mParticle servers. "+(S=y)),s(r,Tr.noHttpCoverage,S.message),[3,10];case 10:return[2]}}))}))}var Or=S.HTTPCodes,Ur=S.Messages,Lr=S.IdentityMethods.Modify;function Mr(e){this.sendAliasRequest=function(){var t=Tt(Mt.mark((function t(r,n){return Mt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Dr(e,r,n);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),this.sendIdentityRequest=function(){var t=Tt(Mt.mark((function t(r,n,o,i,s,a,c){var u,d,l,g,p,v,f,m,h,y,S;return Mt.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=e.Logger,d=u.verbose,l=u.error,g=e._Helpers.invokeCallback,d(Ur.InformationMessages.SendIdentityBegin),r){t.next=6;break}return l(Ur.ErrorMessages.APIRequestEmpty),t.abrupt("return");case 6:if(d(Ur.InformationMessages.SendIdentityHttp),!e._Store.identityCallInFlight){t.next=10;break}return g(o,Or.activeIdentityRequest,"There is currently an Identity request processing. Please wait for this to return before requesting again"),t.abrupt("return");case 10:return p=a||null,v=this.getUploadUrl(n,a),f=window.fetch?new Ge(v):new Ye(v),m={method:"post",headers:{Accept:"text/plain;charset=UTF-8","Content-Type":"application/json","x-mp-key":e._Store.devToken},body:JSON.stringify(r)},t.prev=14,e._Store.identityCallInFlight=!0,t.next=18,f.upload(m);case 18:if(!(h=t.sent).json){t.next=26;break}return t.next=22,h.json();case 22:S=t.sent,y=this.getIdentityResponseFromFetch(h,S),t.next=27;break;case 26:y=this.getIdentityResponseFromXHR(h);case 27:d("Received Identity Response from server: "+JSON.stringify(y.responseText)),s(y,p,o,i,n,c,!1),t.next=36;break;case 31:t.prev=31,t.t0=t.catch(14),e._Store.identityCallInFlight=!1,g(o,Or.noHttpCoverage,t.t0),l("Error sending identity request to servers - "+t.t0);case 36:case"end":return t.stop()}}),t,this,[[14,31]])})));return function(){return t.apply(this,arguments)}}(),this.getUploadUrl=function(t,r){var n=e._Helpers.createServiceUrl(e._Store.SDKConfig.identityUrl);return t===Lr?n+r+"/"+t:n+t},this.getIdentityResponseFromFetch=function(e,t){return{status:e.status,responseText:t,cacheMaxAge:parseInt(e.headers.get($t))||0,expireTimestamp:0}},this.getIdentityResponseFromXHR=function(e){return{status:e.status,responseText:e.responseText?JSON.parse(e.responseText):{},cacheMaxAge:U(e.getResponseHeader($t)||""),expireTimestamp:0}}}var Fr="custom_flags",Nr="partner_identities",Rr={fbclid:{mappedKey:"Facebook.ClickId",processor:function(e,t,r){if(!e||!t)return"";var n=null==t?void 0:t.split("//");if(!n)return"";var o=1;3<=n[1].split("/")[0].split(".").length&&(o=2);var i=r||Date.now();return"fb.".concat(o,".").concat(i,".").concat(e)},output:Fr},_fbp:{mappedKey:"Facebook.BrowserId",output:Fr},_fbc:{mappedKey:"Facebook.ClickId",output:Fr},gclid:{mappedKey:"GoogleEnhancedConversions.Gclid",output:Fr},gbraid:{mappedKey:"GoogleEnhancedConversions.Gbraid",output:Fr},wbraid:{mappedKey:"GoogleEnhancedConversions.Wbraid",output:Fr},ttclid:{mappedKey:"TikTok.Callback",output:Fr},_ttp:{mappedKey:"tiktok_cookie_id",output:Nr}},xr=function(){function e(){this.initialTimestamp=Date.now(),this.filteredPartnerIdentityMappings=this.filterMappings(Nr),this.filteredCustomFlagMappings=this.filterMappings(Fr)}return e.prototype.capture=function(){var e=this.captureQueryParams()||{},t=this.captureCookies()||{};e.fbclid&&t._fbc&&delete t._fbc,this.clickIds=f(f(f({},this.clickIds),e),t)},e.prototype.captureCookies=function(){var e=function(e){var t="undefined"==typeof window?[]:window.document.cookie.split(";").map((function(e){return e.trim()}));return function(e,t){for(var r={},n=0,o=e;n<o.length;n++){var i=o[n].split("="),s=i[0],a=i[1];(!t||t.includes(s))&&(r[s]=a)}return r}(t,e)}(Object.keys(Rr));return this.applyProcessors(e)},e.prototype.captureQueryParams=function(){var e=this.getQueryParams();return this.applyProcessors(e,Y(),this.initialTimestamp)},e.prototype.getQueryParams=function(){return function(e,t){void 0===t&&(t=[]);var r,n={};if(!e)return n;if("undefined"!=typeof URL&&"undefined"!=typeof URLSearchParams){var o=new URL(e);r=new URLSearchParams(o.search)}else r=G(e);return J(t)?r.forEach((function(e,t){n[t]=e})):t.forEach((function(e){var t=r.get(e);t&&(n[e]=t)})),n}(Y(),Object.keys(Rr))},e.prototype.getClickIdsAsCustomFlags=function(){return this.getClickIds(this.clickIds,this.filteredCustomFlagMappings)},e.prototype.getClickIdsAsPartnerIdentities=function(){return this.getClickIds(this.clickIds,this.filteredPartnerIdentityMappings)},e.prototype.getClickIds=function(e,t){var r,n={};if(!e)return n;for(var o=0,i=Object.entries(e);o<i.length;o++){var s=i[o],a=s[0],c=s[1],u=null===(r=t[a])||void 0===r?void 0:r.mappedKey;J(u)||(n[u]=c)}return n},e.prototype.applyProcessors=function(e,t,r){for(var n,o={},i=0,s=Object.entries(e);i<s.length;i++){var a=s[i],c=a[0],u=a[1],d=null===(n=Rr[c])||void 0===n?void 0:n.processor;o[c]=d?d(u,t,r):u}return o},e.prototype.filterMappings=function(e){return Object.fromEntries(Object.entries(Rr).filter((function(t){return t[1].output===e})))},e}(),Vr=S.Messages,Hr=S.HTTPCodes,Kr=S.FeatureFlags,jr=Kr.ReportBatching,qr=Kr.CaptureIntegrationSpecificIds,Br=Vr.InformationMessages.StartingInitialization;function Wr(e){var t=this;this._instanceName=e,this._NativeSdkHelpers=new at(this),this._SessionManager=new lt(this),this._Persistence=new Ct(this),this._Helpers=new nt(this),this._Events=new At(this),this._CookieSyncManager=new ut(this),this._ServerModel=new Wt(this),this._Ecommerce=new pt(this),this._ForwardingStatsUploader=new zt(this),this._Consent=new Pr(this),this._IdentityAPIClient=new Mr(this),this._preInit={readyQueue:[],integrationDelays:{},forwarderConstructors:[]},this._IntegrationCapture=new xr,this.IdentityType=se.IdentityType,this.EventType=se.EventType,this.CommerceEventType=se.CommerceEventType,this.PromotionType=se.PromotionActionType,this.ProductActionType=se.ProductActionType,this._Identity=new _r(this),this.Identity=this._Identity.IdentityAPI,this.generateHash=this._Helpers.generateHash,this.getDeviceId=this._Persistence.getDeviceId,"undefined"!=typeof window&&window.mParticle&&window.mParticle.config&&window.mParticle.config.hasOwnProperty("rq")&&(this._preInit.readyQueue=window.mParticle.config.rq),this.init=function(e,t){var r=this;(t||console.warn("You did not pass a config object to init(). mParticle will not initialize properly"),function(e,t,r){e.Logger=new ht(r),e._Store=new vt(r,e,t),window.mParticle.Store=e._Store,e.Logger.verbose(Br);try{e._Store.isLocalStorageAvailable=e._Persistence.determineLocalStorageAvailability(window.localStorage)}catch(t){e.Logger.warning("localStorage is not available, using cookies if available"),e._Store.isLocalStorageAvailable=!1}}(this,e,t),t)?!t.hasOwnProperty("requestConfig")||t.requestConfig?new Er(e,t,this).getSDKConfiguration().then((function(n){var o=r._Helpers.extend({},t,n);zr(e,o,r)})):zr(e,t,this):console.error("No config available on the window, please pass a config object to mParticle.init()")},this.setLogLevel=function(e){t.Logger.setLogLevel(e)},this.reset=function(e){try{e._Persistence.resetPersistence(),e._Store&&delete e._Store}catch(e){console.error("Cannot reset mParticle",e)}},this._resetForTests=function(e,t,r){r._Store&&delete r._Store,r._Store=new vt(e,r),r._Store.isLocalStorageAvailable=r._Persistence.determineLocalStorageAvailability(window.localStorage),r._Events.stopTracking(),t||r._Persistence.resetPersistence(),r._Persistence.forwardingStatsBatches.uploadsTable={},r._Persistence.forwardingStatsBatches.forwardingStatsEventQueue=[],r._preInit={readyQueue:[],pixelConfigurations:[],integrationDelays:{},forwarderConstructors:[],isDevelopmentMode:!1}},this.ready=function(e){t.isInitialized()&&"function"==typeof e?e():t._preInit.readyQueue.push(e)},this.getEnvironment=function(){return t._Store.SDKConfig.isDevelopmentMode?se.Environment.Development:se.Environment.Production},this.getVersion=function(){return S.sdkVersion},this.setAppVersion=function(e){Jr((function(){t.setAppVersion(e)}),t)||(t._Store.SDKConfig.appVersion=e,t._Persistence.update())},this.setDeviceId=function(e){Jr((function(){t.setDeviceId(e)}),t)||this._Store.setDeviceId(e)},this.isInitialized=function(){return!!t._Store&&t._Store.isInitialized},this.getAppName=function(){return t._Store.SDKConfig.appName},this.setAppName=function(e){Jr((function(){t.setAppName(e)}),t)||(t._Store.SDKConfig.appName=e)},this.getAppVersion=function(){return t._Store.SDKConfig.appVersion},this.stopTrackingLocation=function(){t._SessionManager.resetSessionTimer(),t._Events.stopTracking()},this.startTrackingLocation=function(e){q(e)||t.Logger.warning("Warning: Location tracking is triggered, but not including a callback into the `startTrackingLocation` may result in events logged too quickly and not being associated with a location."),t._SessionManager.resetSessionTimer(),t._Events.startTracking(e)},this.setPosition=function(e,r){Jr((function(){t.setPosition(e,r)}),t)||(t._SessionManager.resetSessionTimer(),"number"==typeof e&&"number"==typeof r?t._Store.currentPosition={lat:e,lng:r}:t.Logger.error("Position latitude and/or longitude must both be of type number"))},this.startNewSession=function(){t._SessionManager.startNewSession()},this.endSession=function(){t._SessionManager.endSession(!0)},this.logBaseEvent=function(e,r){if(!Jr((function(){t.logBaseEvent(e,r)}),t))return t._SessionManager.resetSessionTimer(),"string"!=typeof e.name?void t.Logger.error(Vr.ErrorMessages.EventNameInvalidType):(e.eventType||(e.eventType=se.EventType.Unknown),t._Helpers.canLog()?void t._Events.logEvent(e,r):void t.Logger.error(Vr.ErrorMessages.LoggingDisabled))},this.logEvent=function(e,r,n,o,i){if(!Jr((function(){t.logEvent(e,r,n,o,i)}),t))return t._SessionManager.resetSessionTimer(),"string"!=typeof e?void t.Logger.error(Vr.ErrorMessages.EventNameInvalidType):(r||(r=se.EventType.Unknown),t._Helpers.isEventType(r)?t._Helpers.canLog()?void t._Events.logEvent({messageType:se.MessageType.PageEvent,name:e,data:n,eventType:r,customFlags:o},i):void t.Logger.error(Vr.ErrorMessages.LoggingDisabled):void t.Logger.error("Invalid event type: "+r+", must be one of: \n"+JSON.stringify(se.EventType)))},this.logError=function(e,r){if(!Jr((function(){t.logError(e,r)}),t)&&(t._SessionManager.resetSessionTimer(),e)){"string"==typeof e&&(e={message:e});var n={m:e.message?e.message:e,s:"Error",t:e.stack||null};if(r){var o=t._Helpers.sanitizeAttributes(r,n.m);for(var i in o)n[i]=o[i]}t._Events.logEvent({messageType:se.MessageType.CrashReport,name:e.name?e.name:"Error",data:n,eventType:se.EventType.Other})}},this.logLink=function(e,r,n,o){t._Events.addEventHandler("click",e,r,o,n)},this.logForm=function(e,r,n,o){t._Events.addEventHandler("submit",e,r,o,n)},this.logPageView=function(e,r,n,o){if(!Jr((function(){t.logPageView(e,r,n,o)}),t)){if(t._SessionManager.resetSessionTimer(),t._Helpers.canLog()){if(t._Helpers.Validators.isStringOrNumber(e)||(e="PageView"),r){if(!t._Helpers.isObject(r))return void t.Logger.error("The attributes argument must be an object. A "+d(r)+" was entered. Please correct and retry.")}else r={hostname:window.location.hostname,title:window.document.title};if(n&&!t._Helpers.isObject(n))return void t.Logger.error("The customFlags argument must be an object. A "+d(n)+" was entered. Please correct and retry.")}t._Events.logEvent({messageType:se.MessageType.PageView,name:e,data:r,eventType:se.EventType.Unknown,customFlags:n},o)}},this.upload=function(){if(t._Helpers.canLog())if(t._Store.webviewBridgeEnabled)t._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.Upload);else{var e;null===(e=t._APIClient)||void 0===e||null===(e=e.uploader)||void 0===e||e.prepareAndUpload(!1,!1)}},this.Consent={createCCPAConsent:t._Consent.createPrivacyConsent,createGDPRConsent:t._Consent.createPrivacyConsent,createConsentState:t._Consent.createConsentState},this.eCommerce={Cart:{add:function(e,r){t.Logger.warning("Deprecated function eCommerce.Cart.add() will be removed in future releases");var n,o=t.Identity.getCurrentUser();o&&(n=o.getMPID()),t._Identity.mParticleUserCart(n).add(e,r)},remove:function(e,r){t.Logger.warning("Deprecated function eCommerce.Cart.remove() will be removed in future releases");var n,o=t.Identity.getCurrentUser();o&&(n=o.getMPID()),t._Identity.mParticleUserCart(n).remove(e,r)},clear:function(){t.Logger.warning("Deprecated function eCommerce.Cart.clear() will be removed in future releases");var e,r=t.Identity.getCurrentUser();r&&(e=r.getMPID()),t._Identity.mParticleUserCart(e).clear()}},setCurrencyCode:function(e){return Jr((function(){t.eCommerce.setCurrencyCode(e)}),t)?void 0:"string"==typeof e?(t._SessionManager.resetSessionTimer(),void(t._Store.currencyCode=e)):void t.Logger.error("Code must be a string")},createProduct:function(e,r,n,o,i,s,a,c,u,d){return t._Ecommerce.createProduct(e,r,n,o,i,s,a,c,u,d)},createPromotion:function(e,r,n,o){return t._Ecommerce.createPromotion(e,r,n,o)},createImpression:function(e,r){return t._Ecommerce.createImpression(e,r)},createTransactionAttributes:function(e,r,n,o,i,s){return t._Ecommerce.createTransactionAttributes(e,r,n,o,i,s)},logCheckout:function(e,r,n,o){return t.Logger.warning("mParticle.logCheckout is deprecated, please use mParticle.logProductAction instead"),t._Store.isInitialized?(t._SessionManager.resetSessionTimer(),void t._Events.logCheckoutEvent(e,r,n,o)):void t.ready((function(){t.eCommerce.logCheckout(e,r,n,o)}))},logProductAction:function(e,r,n,o,i,s){Jr((function(){t.eCommerce.logProductAction(e,r,n,o,i,s)}),t)||(t._SessionManager.resetSessionTimer(),t._Events.logProductActionEvent(e,r,n,o,i,s))},logPurchase:function(e,r,n,o,i){return t.Logger.warning("mParticle.logPurchase is deprecated, please use mParticle.logProductAction instead"),t._Store.isInitialized?e&&r?(t._SessionManager.resetSessionTimer(),void t._Events.logPurchaseEvent(e,r,o,i)):void t.Logger.error(Vr.ErrorMessages.BadLogPurchase):void t.ready((function(){t.eCommerce.logPurchase(e,r,n,o,i)}))},logPromotion:function(e,r,n,o,i){Jr((function(){t.eCommerce.logPromotion(e,r,n,o,i)}),t)||(t._SessionManager.resetSessionTimer(),t._Events.logPromotionEvent(e,r,n,o,i))},logImpression:function(e,r,n,o){Jr((function(){t.eCommerce.logImpression(e,r,n,o)}),t)||(t._SessionManager.resetSessionTimer(),t._Events.logImpressionEvent(e,r,n,o))},logRefund:function(e,r,n,o,i){return t.Logger.warning("mParticle.logRefund is deprecated, please use mParticle.logProductAction instead"),t._Store.isInitialized?(t._SessionManager.resetSessionTimer(),void t._Events.logRefundEvent(e,r,o,i)):void t.ready((function(){t.eCommerce.logRefund(e,r,n,o,i)}))},expandCommerceEvent:function(e){return t._Ecommerce.expandCommerceEvent(e)}},this.setSessionAttribute=function(e,r){if(!Jr((function(){t.setSessionAttribute(e,r)}),t)&&t._Helpers.canLog()){if(!t._Helpers.Validators.isValidAttributeValue(r))return void t.Logger.error(Vr.ErrorMessages.BadAttribute);if(!t._Helpers.Validators.isValidKeyValue(e))return void t.Logger.error(Vr.ErrorMessages.BadKey);if(t._Store.webviewBridgeEnabled)t._NativeSdkHelpers.sendToNative(S.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:e,value:r}));else{var n=t._Helpers.findKeyInObject(t._Store.sessionAttributes,e);n&&(e=n),t._Store.sessionAttributes[e]=r,t._Persistence.update(),t._Forwarders.applyToForwarders("setSessionAttribute",[e,r])}}},this.setOptOut=function(e){Jr((function(){t.setOptOut(e)}),t)||(t._SessionManager.resetSessionTimer(),t._Store.isEnabled=!e,t._Events.logOptOut(),t._Persistence.update(),t._Store.activeForwarders.length&&t._Store.activeForwarders.forEach((function(r){if(r.setOptOut){var n=r.setOptOut(e);n&&t.Logger.verbose(n)}})))},this.setIntegrationAttribute=function(e,r){if(!Jr((function(){t.setIntegrationAttribute(e,r)}),t)){if("number"!=typeof e)return void t.Logger.error("integrationId must be a number");if(null===r)t._Store.integrationAttributes[e]={};else{if(!t._Helpers.isObject(r))return void t.Logger.error("Attrs must be an object with keys and values. You entered a "+d(r));if(0===Object.keys(r).length)t._Store.integrationAttributes[e]={};else for(var n in r){if("string"!=typeof n){t.Logger.error("Keys must be strings, you entered a "+d(n));continue}if("string"!=typeof r[n]){t.Logger.error("Values for integration attributes must be strings. You entered a "+d(r[n]));continue}t._Helpers.isObject(t._Store.integrationAttributes[e])||(t._Store.integrationAttributes[e]={}),t._Store.integrationAttributes[e][n]=r[n]}}t._Persistence.update()}},this.getIntegrationAttributes=function(e){return t._Store.integrationAttributes[e]?t._Store.integrationAttributes[e]:{}},this.addForwarder=function(e){t._preInit.forwarderConstructors.push(e)},this.configurePixel=function(e){t._Forwarders.configurePixel(e)},this._getActiveForwarders=function(){return t._Store.activeForwarders},this._getIntegrationDelays=function(){return t._preInit.integrationDelays},this._setIntegrationDelay=function(e,r){if(t._preInit.integrationDelays[e]=r,!0!==r){var n=Object.keys(t._preInit.integrationDelays);if(0!==n.length){var o=n.some((function(e){return!0===t._preInit.integrationDelays[e]}));o||t._APIClient.processQueuedEvents()}}},this._setWrapperSDKInfo=function(e,r){Jr((function(){t._setWrapperSDKInfo(e,r)}),t)||(void 0===t._Store.wrapperSDKInfo||!t._Store.wrapperSDKInfo.isInfoSet)&&(t._Store.wrapperSDKInfo={name:e,version:r,isInfoSet:!0})}}function zr(e,t,r){var n=function(e,t){var r,n,o,i;return e.dataPlanOptions&&(t.Logger.verbose("Customer provided data plan found"),i=e.dataPlanOptions,n={document:{dtpn:{vers:i.dataPlanVersion,blok:{ev:i.blockEvents,ea:i.blockEventAttributes,ua:i.blockUserAttributes,id:i.blockUserIdentities}}}}),n||(e.dataPlan&&e.dataPlan.document?e.dataPlan.document.error_message?o=e.dataPlan.document.error_message:(t.Logger.verbose("Data plan found from mParticle.js"),n=e.dataPlan):e.dataPlanResult&&(e.dataPlanResult.error_message?o=e.dataPlanResult.error_message:(t.Logger.verbose("Data plan found from /config"),n={document:e.dataPlanResult}))),o&&t.Logger.error(o),n&&(r=new wr(n,t)),r}(t,r);if(r._APIClient=new $e(r,n),r._Forwarders=new Kt(r,n),r._Store.processConfig(t),r._Identity.idCache=function(e){return new ze("".concat(e._Store.storageName,"-id-cache"),{logger:e.Logger})}(r),nr(r._Identity.idCache),r._Store.webviewBridgeEnabled)r._NativeSdkHelpers.initializeSessionAttributes(e);else{r._Persistence.initializeStorage(),r._Store.syncPersistenceData();var o=r.Identity.getCurrentUser(),i=o?o.getMPID():null,s=o?o.getUserIdentities().userIdentities:{};r._Store.SDKConfig.identifyRequest=r._Store.hasInvalidIdentifyRequest()?{userIdentities:s}:r._Store.SDKConfig.identifyRequest,r._Helpers.getFeatureFlag(jr)&&r._ForwardingStatsUploader.startForwardingStatsTimer(),r._Helpers.getFeatureFlag(qr)&&r._IntegrationCapture.capture(),r._Forwarders.processForwarders(t,r._APIClient.prepareForwardingStats),r._Forwarders.processPixelConfigs(t),r._SessionManager.initialize(),r._Events.logAST(),function(e,t,r,n){!e._Store.identifyCalled&&e._Store.SDKConfig.identityCallback&&t&&r&&e._Store.SDKConfig.identityCallback({httpCode:Hr.activeSession,getUser:function(){return e._Identity.mParticleUser(r)},getPreviousUser:function(){var t=e.Identity.getUsers(),n=t.shift(),o=n.getMPID();return n&&o===r&&(n=t.shift()),n||null},body:{mpid:r,is_logged_in:e._Store.isLoggedIn,matched_identities:n,context:null,is_ephemeral:!1}})}(r,o,i,s)}(r._Store.mpid&&!r._Store.identifyCalled||r._Store.webviewBridgeEnabled)&&(r._Store.isInitialized=!0,r._preInit.readyQueue=ur(r._preInit.readyQueue)),r._Store.isFirstRun&&(r._Store.isFirstRun=!1)}function Jr(e,t){return!t.isInitialized()&&(t.ready((function(){e()})),!0)}var Qr=function(){return null},Gr=function(){function e(){}return e.prototype.getMPInstance=function(){return{_Helpers:{sanitizeAttributes:window.mParticle.getInstance()._Helpers.sanitizeAttributes,generateHash:function(){return"mockHash"},generateUniqueId:function(){return"mockId"},extend:window.mParticle.getInstance()._Helpers.extend,createServiceUrl:Qr,parseNumber:Qr,isObject:Qr,Validators:null},_resetForTests:Qr,_APIClient:null,MPSideloadedKit:null,_Consent:null,_Events:null,_Forwarders:null,_NativeSdkHelpers:null,_Persistence:null,_preInit:null,Consent:null,_ServerModel:null,_SessionManager:null,_Store:{sessionId:"mockSessionId",sideloadedKits:[],devToken:"test_dev_token",isFirstRun:!0,isEnabled:!0,sessionAttributes:{},currentSessionMPIDs:[],consentState:null,clientId:null,deviceId:null,serverSettings:{},dateLastEventSent:null,sessionStartDate:null,currentPosition:null,isTracking:!1,watchPositionId:null,cartProducts:[],eventQueue:[],currencyCode:null,globalTimer:null,context:null,configurationLoaded:!1,identityCallInFlight:!1,nonCurrentUserMPIDs:{},identifyCalled:!1,isLoggedIn:!1,cookieSyncDates:{},integrationAttributes:{},requireDelay:!0,isLocalStorageAvailable:null,integrationDelayTimeoutStart:null,storageName:null,prodStorageName:null,activeForwarders:[],kits:{},configuredForwarders:[],pixelConfigurations:[],wrapperSDKInfo:{name:"none",version:null,isInfoSet:!1},SDKConfig:{isDevelopmentMode:!1,onCreateBatch:Qr}},config:null,eCommerce:null,Identity:{getCurrentUser:Qr,IdentityAPI:{},identify:Qr,login:Qr,logout:Qr,modify:Qr},Logger:{verbose:Qr,error:Qr,warning:Qr},ProductActionType:null,ServerModel:null,addForwarder:Qr,generateHash:Qr,getAppVersion:Qr,getAppName:Qr,getInstance:Qr,getDeviceId:Qr,init:Qr,logBaseEvent:Qr,logEvent:Qr,logLevel:"none",setPosition:Qr,upload:Qr}},e.prototype.createSDKEventFunction=function(e){return new Wt(this.getMPInstance()).createEventObject(e)},e.prototype.returnBatch=function(e){var t=this,r=this.getMPInstance();return Te("0",Array.isArray(e)?e.map((function(e){return t.createSDKEventFunction(e)})):[this.createSDKEventFunction(e)],r)},e}(),Yr=function(){function e(e){this.filterDictionary={eventTypeFilters:[],eventNameFilters:[],screenNameFilters:[],screenAttributeFilters:[],userIdentityFilters:[],userAttributeFilters:[],attributeFilters:[],consentRegulationFilters:[],consentRegulationPurposeFilters:[],messageTypeFilters:[],messageTypeStateFilters:[],filteringEventAttributeValue:{},filteringUserAttributeValue:{},filteringConsentRuleValues:{}},this.kitInstance=e}return e.prototype.addEventTypeFilter=function(e){var t=tt.hashEventType(e);this.filterDictionary.eventTypeFilters.push(t)},e.prototype.addEventNameFilter=function(e,t){var r=tt.hashEventName(t,e);this.filterDictionary.eventNameFilters.push(r)},e.prototype.addEventAttributeFilter=function(e,t,r){var n=tt.hashEventAttributeKey(e,t,r);this.filterDictionary.attributeFilters.push(n)},e.prototype.addScreenNameFilter=function(e){var t=tt.hashEventName(e,n.Unknown);this.filterDictionary.screenNameFilters.push(t)},e.prototype.addScreenAttributeFilter=function(e,t){var r=tt.hashEventAttributeKey(n.Unknown,e,t);this.filterDictionary.screenAttributeFilters.push(r)},e.prototype.addUserIdentityFilter=function(e){var t=tt.hashUserIdentity(e);this.filterDictionary.userIdentityFilters.push(t)},e.prototype.addUserAttributeFilter=function(e){var t=tt.hashUserAttribute(e);this.filterDictionary.userAttributeFilters.push(t)},e}();Array.prototype.forEach||(Array.prototype.forEach=u.forEach),Array.prototype.map||(Array.prototype.map=u.map),Array.prototype.filter||(Array.prototype.filter=u.filter),Array.isArray||(Array.prototype.isArray=u.isArray);var Xr=new function(){var e=this;this.Store={},this._instances={},this.IdentityType=se.IdentityType,this.EventType=se.EventType,this.CommerceEventType=se.CommerceEventType,this.PromotionType=se.PromotionActionType,this.ProductActionType=se.ProductActionType,this.MPSideloadedKit=Yr,"undefined"!=typeof window&&(this.isIOS=!(!window.mParticle||!window.mParticle.isIOS)&&window.mParticle.isIOS,this.config=window.mParticle&&window.mParticle.config?window.mParticle.config:{}),this.init=function(t,r,n){!r&&window.mParticle&&window.mParticle.config&&(console.warn("You did not pass a config object to mParticle.init(). Attempting to use the window.mParticle.config if it exists. Please note that in a future release, this may not work and mParticle will not initialize properly"),r=window.mParticle?window.mParticle.config:{}),n=(n&&0!==n.length?n:S.DefaultInstance).toLowerCase();var o=e._instances[n];void 0===o&&(o=new Wr(t),e._instances[n]=o),o.init(t,r,n)},this.getInstance=function(t){var r;return t?(r=e._instances[t.toLowerCase()])||(console.log("You tried to initialize an instance named "+t+". This instance does not exist. Check your instance name or initialize a new instance with this name before calling it."),null):(t=S.DefaultInstance,(r=e._instances[t])||(r=new Wr(t),e._instances[S.DefaultInstance]=r),r)},this.getDeviceId=function(){return e.getInstance().getDeviceId()},this.setDeviceId=function(t){return e.getInstance().setDeviceId(t)},this.isInitialized=function(){return e.getInstance().isInitialized()},this.startNewSession=function(){e.getInstance().startNewSession()},this.endSession=function(){e.getInstance().endSession()},this.setLogLevel=function(t){e.getInstance().setLogLevel(t)},this.ready=function(t){e.getInstance().ready(t)},this.setAppVersion=function(t){e.getInstance().setAppVersion(t)},this.getAppName=function(){return e.getInstance().getAppName()},this.setAppName=function(t){e.getInstance().setAppName(t)},this.getAppVersion=function(){return e.getInstance().getAppVersion()},this.getEnvironment=function(){return e.getInstance().getEnvironment()},this.stopTrackingLocation=function(){e.getInstance().stopTrackingLocation()},this.startTrackingLocation=function(t){e.getInstance().startTrackingLocation(t)},this.setPosition=function(t,r){e.getInstance().setPosition(t,r)},this.startNewSession=function(){e.getInstance().startNewSession()},this.endSession=function(){e.getInstance().endSession()},this.logBaseEvent=function(t,r){e.getInstance().logBaseEvent(t,r)},this.logEvent=function(t,r,n,o,i){e.getInstance().logEvent(t,r,n,o,i)},this.logError=function(t,r){e.getInstance().logError(t,r)},this.logLink=function(t,r,n,o){e.getInstance().logLink(t,r,n,o)},this.logForm=function(t,r,n,o){e.getInstance().logForm(t,r,n,o)},this.logPageView=function(t,r,n,o){e.getInstance().logPageView(t,r,n,o)},this.upload=function(){e.getInstance().upload()},this.eCommerce={Cart:{add:function(t,r){e.getInstance().eCommerce.Cart.add(t,r)},remove:function(t,r){e.getInstance().eCommerce.Cart.remove(t,r)},clear:function(){e.getInstance().eCommerce.Cart.clear()}},setCurrencyCode:function(t){e.getInstance().eCommerce.setCurrencyCode(t)},createProduct:function(t,r,n,o,i,s,a,c,u,d){return e.getInstance().eCommerce.createProduct(t,r,n,o,i,s,a,c,u,d)},createPromotion:function(t,r,n,o){return e.getInstance().eCommerce.createPromotion(t,r,n,o)},createImpression:function(t,r){return e.getInstance().eCommerce.createImpression(t,r)},createTransactionAttributes:function(t,r,n,o,i,s){return e.getInstance().eCommerce.createTransactionAttributes(t,r,n,o,i,s)},logCheckout:function(t,r,n,o){e.getInstance().eCommerce.logCheckout(t,r,n,o)},logProductAction:function(t,r,n,o,i,s){e.getInstance().eCommerce.logProductAction(t,r,n,o,i,s)},logPurchase:function(t,r,n,o,i){e.getInstance().eCommerce.logPurchase(t,r,n,o,i)},logPromotion:function(t,r,n,o,i){e.getInstance().eCommerce.logPromotion(t,r,n,o,i)},logImpression:function(t,r,n,o){e.getInstance().eCommerce.logImpression(t,r,n,o)},logRefund:function(t,r,n,o,i){e.getInstance().eCommerce.logRefund(t,r,n,o,i)},expandCommerceEvent:function(t){return e.getInstance().eCommerce.expandCommerceEvent(t)}},this.setSessionAttribute=function(t,r){e.getInstance().setSessionAttribute(t,r)},this.setOptOut=function(t){e.getInstance().setOptOut(t)},this.setIntegrationAttribute=function(t,r){e.getInstance().setIntegrationAttribute(t,r)},this.getIntegrationAttributes=function(t){return e.getInstance().getIntegrationAttributes(t)},this.Identity={HTTPCodes:S.HTTPCodes,aliasUsers:function(t,r){e.getInstance().Identity.aliasUsers(t,r)},createAliasRequest:function(t,r){return e.getInstance().Identity.createAliasRequest(t,r)},getCurrentUser:function(){return e.getInstance().Identity.getCurrentUser()},getUser:function(t){return e.getInstance().Identity.getUser(t)},getUsers:function(){return e.getInstance().Identity.getUsers()},identify:function(t,r){e.getInstance().Identity.identify(t,r)},login:function(t,r){e.getInstance().Identity.login(t,r)},logout:function(t,r){e.getInstance().Identity.logout(t,r)},modify:function(t,r){e.getInstance().Identity.modify(t,r)}},this.sessionManager={getSession:function(){return e.getInstance()._SessionManager.getSession()}},this.Consent={createConsentState:function(){return e.getInstance().Consent.createConsentState()},createGDPRConsent:function(t,r,n,o,i){return e.getInstance().Consent.createGDPRConsent(t,r,n,o,i)},createCCPAConsent:function(t,r,n,o,i){return e.getInstance().Consent.createGDPRConsent(t,r,n,o,i)}},this.reset=function(){e.getInstance().reset(e.getInstance())},this._resetForTests=function(t,r){"boolean"==typeof r?e.getInstance()._resetForTests(t,r,e.getInstance()):e.getInstance()._resetForTests(t,!1,e.getInstance())},this.configurePixel=function(t){e.getInstance().configurePixel(t)},this._setIntegrationDelay=function(t,r){e.getInstance()._setIntegrationDelay(t,r)},this._getIntegrationDelays=function(){return e.getInstance()._getIntegrationDelays()},this.getVersion=function(){return e.getInstance().getVersion()},this.generateHash=function(t){return e.getInstance().generateHash(t)},this.addForwarder=function(t){e.getInstance().addForwarder(t)},this._getActiveForwarders=function(){return e.getInstance()._getActiveForwarders()},this._setWrapperSDKInfo=function(t,r){e.getInstance()._setWrapperSDKInfo(t,r)}};"undefined"!=typeof window&&(window.mParticle=Xr,window.mParticle._BatchValidator=new Gr)}}]);